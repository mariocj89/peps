<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">PEP:</th><td class="field-body">496</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">Environment Markers</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">$Revision$</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference external" href="https://hg.python.org/peps/file/tip/pep-0496.txt">$Date$</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">James Polley &lt;jp&#32;&#97;t&#32;jamezpolley.com&gt;</td>
</tr>
<tr class="field"><th class="field-name">BDFL-Delegate:</th><td class="field-body">Nick Coghlan &lt;ncoghlan&#32;&#97;t&#32;gmail.com&gt;</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Rejected</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Informational</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference external" href="/dev/peps/pep-0012">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">03-Jul-2015</td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#pep-status" id="id4">PEP Status</a></li>
<li><a class="reference internal" href="#abstract" id="id5">Abstract</a></li>
<li><a class="reference internal" href="#rationale" id="id6">Rationale</a></li>
<li><a class="reference internal" href="#examples" id="id7">Examples</a></li>
<li><a class="reference internal" href="#micro-language" id="id8">Micro-language</a><ul>
<li><a class="reference internal" href="#strings" id="id9">Strings</a></li>
<li><a class="reference internal" href="#version-numbers" id="id10">Version numbers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#references" id="id11">References</a></li>
<li><a class="reference internal" href="#copyright" id="id12">Copyright</a></li>
</ul>
</div>
<div class="section" id="pep-status">
<h1><a class="toc-backref" href="#id4">PEP Status</a></h1>
<p>After this PEP was initially drafted, <a class="reference external" href="/dev/peps/pep-0508">PEP 508</a> was developed and submitted to
fully specify the dependency declaration syntax, including environment markers.
As a result, this PEP ended up being rejected in favour of the more comprehensive
<a class="reference external" href="/dev/peps/pep-0508">PEP 508</a>.</p>
</div>
<div class="section" id="abstract">
<h1><a class="toc-backref" href="#id5">Abstract</a></h1>
<p>An <strong>environment marker</strong> describes a condition about the current execution
environment. They are used to indicate when certain dependencies are only
required in particular environments, and to indicate supported platforms
for distributions with additional constraints beyond the availability of a
Python runtime.</p>
<p>Environment markers were first specified in PEP-0345 <a class="footnote-reference" href="#pep345" id="id1">[1]</a>. PEP-0426
<a class="footnote-reference" href="#pep426" id="id2">[2]</a> (which would replace PEP-0345) proposed extensions to the markers.
When 2.7.10 was released, even these extensions became insufficient due to
their reliance on simple lexical comparisons, and thus this PEP has been born.</p>
</div>
<div class="section" id="rationale">
<h1><a class="toc-backref" href="#id6">Rationale</a></h1>
<p>Many Python packages are written with portability in mind.</p>
<p>For many packages this means they aim to support a wide range of
Python releases. If they depend on libraries such as <tt class="docutils literal">argparse</tt> -
which started as external libraries, but later got incorporated into
core - specifying a single set of requirements is difficult, as the
set of required packages differs depending on the version of Python in
use.</p>
<p>For other packages, designing for portability means supporting
multiple operating systems. However, the significant differences
between them may mean that particular dependencies are only needed on
particular platforms (relying on <tt class="docutils literal">pywin32</tt> only on Windows, for
example)&quot;</p>
<p>Environment Markers attempt to provide more flexibility in a list of
requirements by allowing the developer to list requirements that are
specific to a particular environment.</p>
</div>
<div class="section" id="examples">
<h1><a class="toc-backref" href="#id7">Examples</a></h1>
<p>Here are some examples of such markers inside a requirements.txt:</p>
<pre class="literal-block">
pywin32 &gt;=1.0 ; sys_platform == 'win32'
unittest2 &gt;=2.0,&lt;3.0 ; python_version == '2.4' or python_version == '2.5'
backports.ssl_match_hostname &gt;= 3.4 ; python_version &lt; '2.7.9' or (python_version &gt;= '3.0' and python_version &lt; '3.4')
</pre>
<p>And here's an example of some conditional metadata included in
setup.py for a distribution that requires PyWin32 both at runtime and
buildtime when using Windows:</p>
<pre class="literal-block">
setup(
  install_requires=[&quot;pywin32 &gt; 1.0 : sys.platform == 'win32'&quot;],
  setup_requires=[&quot;pywin32 &gt; 1.0 : sys.platform == 'win32'&quot;]
  )
</pre>
</div>
<div class="section" id="micro-language">
<h1><a class="toc-backref" href="#id8">Micro-language</a></h1>
<p>The micro-language behind this is as follows. It compares:</p>
<ul class="simple">
<li>strings with the <tt class="docutils literal">==</tt> and <tt class="docutils literal">in</tt> operators (and their opposites)</li>
<li>version numbers with the <tt class="docutils literal">&lt;</tt>, <tt class="docutils literal">&lt;=</tt>, <tt class="docutils literal">&gt;=</tt>, and <tt class="docutils literal">&lt;</tt> operators
in addition to those supported for strings</li>
</ul>
<p>The usual boolean operators <tt class="docutils literal">and</tt> and <tt class="docutils literal">or</tt> can be used to combine
expressions, and parentheses are supported for grouping.</p>
<p>The pseudo-grammar is</p>
<pre class="literal-block">
MARKER: EXPR [(and|or) EXPR]*
EXPR: (&quot;(&quot; MARKER &quot;)&quot;) | (STREXPR|VEREXPR)
STREXPR: STRING [STRCMPOP STREXPR]
STRCMPOP: ==|!=|in|not in
VEREXPR: VERSION [VERCMPOP VEREXPR]
VERCMPOP: (==|!=|&lt;|&gt;|&lt;=|&gt;=)
</pre>
<p><tt class="docutils literal">SUBEXPR</tt> is either a Python string (such as <tt class="docutils literal">'win32'</tt>) or one of
the <tt class="docutils literal">Strings</tt> marker variables listed below.</p>
<p><tt class="docutils literal">VEREXPR</tt> is a PEP-0440 <a class="footnote-reference" href="#pep440" id="id3">[3]</a> version identifier, or one of the
<tt class="docutils literal">Version number</tt> marker variables listed below. Comparisons between
version numbers are done using PEP-0440 semantics.</p>
<div class="section" id="strings">
<h2><a class="toc-backref" href="#id9">Strings</a></h2>
<ul class="simple">
<li><tt class="docutils literal">os_name</tt>: <tt class="docutils literal">os.name</tt></li>
<li><tt class="docutils literal">sys_platform</tt>: <tt class="docutils literal">sys.platform</tt></li>
<li><tt class="docutils literal">platform_release</tt>: <tt class="docutils literal">platform.release()</tt></li>
<li><tt class="docutils literal">implementation_name</tt>: <tt class="docutils literal">sys.implementation.name</tt></li>
<li><tt class="docutils literal">platform_machine</tt>: <tt class="docutils literal">platform.machine()</tt></li>
<li><tt class="docutils literal">platform_python_implementation</tt>: <tt class="docutils literal">platform.python_implementation()</tt></li>
</ul>
<p>If a particular string value is not available (such as <tt class="docutils literal">sys.implementation.name</tt>
in versions of Python prior to 3.3), the corresponding marker
variable MUST be considered equivalent to the empty string.</p>
<p>If a particular version number value is not available (such as
<tt class="docutils literal">sys.implementation.version</tt> in versions of Python prior to 3.3) the
corresponding marker variable MUST be considered equivalent to <tt class="docutils literal">0</tt></p>
</div>
<div class="section" id="version-numbers">
<h2><a class="toc-backref" href="#id10">Version numbers</a></h2>
<ul class="simple">
<li><tt class="docutils literal">python_version</tt>: <tt class="docutils literal"><span class="pre">platform.python_version()[:3]</span></tt></li>
<li><tt class="docutils literal">python_full_version</tt>: see definition below</li>
<li><tt class="docutils literal">platform_version</tt>: <tt class="docutils literal">platform.version()</tt></li>
<li><tt class="docutils literal">implementation_version</tt>: see definition below</li>
</ul>
<p>The <tt class="docutils literal">python_full_version</tt> and <tt class="docutils literal">implementation_version</tt> marker variables
are derived from <tt class="docutils literal">sys.version_info</tt> and <tt class="docutils literal">sys.implementation.version</tt>
respectively, in accordance with the following algorithm:</p>
<pre class="literal-block">
def format_full_version(info):
    version = '{0.major}.{0.minor}.{0.micro}'.format(info)
    kind = info.releaselevel
    if kind != 'final':
        version += kind[0] + str(info.serial)
    return version

python_full_version = format_full_version(sys.version_info)
implementation_version = format_full_version(sys.implementation.version)
</pre>
<p><tt class="docutils literal">python_full_version</tt> will typically correspond to <tt class="docutils literal"><span class="pre">sys.version.split()[0]</span></tt>.</p>
</div>
</div>
<div class="section" id="references">
<h1><a class="toc-backref" href="#id11">References</a></h1>
<table class="docutils footnote" frame="void" id="pep345" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="/dev/peps/pep-0345">PEP 345</a>, Metadata for Python Software Packages 1.2, Jones
(<a class="reference external" href="http://www.python.org/dev/peps/pep-0345">http://www.python.org/dev/peps/pep-0345</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="pep426" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td><a class="reference external" href="/dev/peps/pep-0426">PEP 426</a>, Metadata for Python Software Packages 2.0, Coghlan, Holth, Stufft
(<a class="reference external" href="http://www.python.org/dev/peps/pep-0426">http://www.python.org/dev/peps/pep-0426</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="pep440" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td><a class="reference external" href="/dev/peps/pep-0440">PEP 440</a>, Version Identification and Dependency Specification, Coghlan, Stufft
(<a class="reference external" href="https://www.python.org/dev/peps/pep-0440/">https://www.python.org/dev/peps/pep-0440/</a>)</td></tr>
</tbody>
</table>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id12">Copyright</a></h1>
<p>This document has been placed in the public domain.</p>
<!-- Local Variables:
mode: indented-text
indent-tabs-mode: nil
sentence-end-double-space: t
fill-column: 70
coding: utf-8 -->
</div>

