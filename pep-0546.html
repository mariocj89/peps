<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">PEP:</th><td class="field-body">546</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">Backport ssl.MemoryBIO and ssl.SSLObject to Python 2.7</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">$Revision$</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference external" href="https://hg.python.org/peps/file/tip/pep-0546.txt">$Date$</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">Victor Stinner &lt;victor.stinner&#32;&#97;t&#32;gmail.com&gt;,
Cory Benfield &lt;cory&#32;&#97;t&#32;lukasa.co.uk&gt;,</td>
</tr>
<tr class="field"><th class="field-name">BDFL-Delegate:</th><td class="field-body">Benjamin Peterson &lt;benjamin&#32;&#97;t&#32;python.org&gt;</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Accepted</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Standards Track</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference external" href="/dev/peps/pep-0012">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">30-May-2017</td>
</tr>
<tr class="field"><th class="field-name">Python-Version:</th><td class="field-body">2.7</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body">23-May-2017</td>
</tr>
<tr class="field"><th class="field-name">Resolution:</th><td class="field-body"><a class="reference external" href="https://mail.python.org/pipermail/python-dev/2017-June/148301.html">https://mail.python.org/pipermail/python-dev/2017-June/148301.html</a></td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#abstract" id="id2">Abstract</a></li>
<li><a class="reference internal" href="#rationale" id="id3">Rationale</a><ul>
<li><a class="reference internal" href="#pep-543" id="id4">PEP 543</a></li>
<li><a class="reference internal" href="#requests-pip-and-ensurepip" id="id5">requests, pip and ensurepip</a></li>
<li><a class="reference internal" href="#other-benefits" id="id6">Other Benefits</a></li>
</ul>
</li>
<li><a class="reference internal" href="#concerns" id="id7">Concerns</a><ul>
<li><a class="reference internal" href="#what-about-old-python-2" id="id8">What About Old Python 2?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#changes" id="id9">Changes</a></li>
<li><a class="reference internal" href="#links" id="id10">Links</a></li>
<li><a class="reference internal" href="#discussions" id="id11">Discussions</a></li>
<li><a class="reference internal" href="#copyright" id="id12">Copyright</a></li>
</ul>
</div>
<div class="section" id="abstract">
<h1><a class="toc-backref" href="#id2">Abstract</a></h1>
<p>Backport the ssl.MemoryBIO and ssl.SSLObject classes from Python 3 to Python
2.7 to enhance the overall security of Python 2.7.</p>
</div>
<div class="section" id="rationale">
<h1><a class="toc-backref" href="#id3">Rationale</a></h1>
<p>While Python 2.7 is getting closer to its end-of-support date (scheduled for
2020), it is still used on production systems and the Python community is still
responsible for its security. This PEP will help facilitate the future adoption
of <a class="reference external" href="/dev/peps/pep-0543">PEP 543</a> across all supported Python versions, which will improve security
for both Python 2 and Python 3 users.</p>
<p>This PEP does NOT propose a general exception for backporting new
features to Python 2.7 - every new feature proposed for backporting will
still need to be justified independently. In particular, it will need to
be explained why relying on an independently updated backport on the
Python Package Index instead is not an acceptable solution.</p>
<div class="section" id="pep-543">
<h2><a class="reference external" href="/dev/peps/pep-0543">PEP 543</a></h2>
<p><a class="reference external" href="/dev/peps/pep-0543">PEP 543</a> defines a new TLS API for Python which would enhance Python
security by giving Python applications access to the native TLS implementations
on Windows and macOS, instead of using OpenSSL. A side effect is that it gives
access to the system trust store and certificates installed
locally by system administrators, enabling Python applications to use &quot;company
certificates&quot; without having to modify each application and so to correctly
validate TLS certificates (instead of having to ignore or bypass TLS
certificate validation).</p>
<p>For practical reasons, Cory Benfield would like to first implement an
I/O-less class similar to ssl.MemoryBIO and ssl.SSLObject for
<a class="reference external" href="/dev/peps/pep-0543">PEP 543</a>, and to provide a second class based on the first one to use
sockets or file descriptors.  This design would help to structure the code
to support more backends and simplify testing and auditing, as well as
implementation. Later, optimized classes using directly sockets or file
descriptors may be added for performance.</p>
<p>While <a class="reference external" href="/dev/peps/pep-0543">PEP 543</a> defines an API, the PEP would only make sense if it
comes with at least one complete and good implementation. The first
implementation would ideally be based on the <tt class="docutils literal">ssl</tt> module of the Python
standard library, as this is shipped to all users by default and can be used as
a fallback implementation in the absence of anything more targetted.</p>
<p>If this backport is not performed, the only baseline implementation that could
be used would be pyOpenSSL. This is problematic, however, because of the
interaction with pip, which is shipped with CPython on all supported versions.</p>
</div>
<div class="section" id="requests-pip-and-ensurepip">
<h2><a class="toc-backref" href="#id5">requests, pip and ensurepip</a></h2>
<p>There are plans afoot to look at moving Requests to a more event-loop-y
model. The Requests team does not feel at this time it is possible to abandon
support for Python 2.7, so doing so would require using either Twisted or
Tornado, or writing their own asynchronous abstraction.</p>
<p>For asynchronous code, a MemoryBIO provides substantial advantages over using a
wrapped socket. It reduces the amount of buffering that must be done, works on
IOCP-based reactors as well as select/poll based ones, and also greatly
simplifies the reactor and implementation code. For this reason, Requests is
disinclined to use a wrapped-socket-based implementation. In the absence of a
backport to Python 2.7, Requests is required to use the same solution that
Twisted does: namely, a mandatory dependency on  <a class="reference external" href="https://pypi.python.org/pypi/pyOpenSSL">pyOpenSSL</a>.</p>
<p>The <a class="reference external" href="https://pip.pypa.io/">pip</a> program has to embed all its
dependencies for practical reasons: namely, that it cannot rely on any other
installation method being present. Since pip depends on requests, it means
that it would have to embed a copy of pyOpenSSL. That would imply substantial
usability pain to install pip. Currently, pip doesn't support embedding
C extensions which must be compiled on each platform and so require a C
compiler.</p>
<p>Since Python 2.7.9, Python embeds a copy of pip both for default
installation and for use in virtual environments via the new <tt class="docutils literal">ensurepip</tt>
module. If pip ends up bundling PyOpenSSL, then CPython will end up
bundling PyOpenSSL. Only backporting <tt class="docutils literal">ssl.MemoryBIO</tt> and
<tt class="docutils literal">ssl.SSLObject</tt> would avoid the need to embed pyOpenSSL, and would fix the
bootstrap issue (python -&gt; ensurepip -&gt; pip -&gt; requests -&gt; MemoryBIO).</p>
<p>This situation is less problematic than the barrier to adoption of <a class="reference external" href="/dev/peps/pep-0543">PEP 543</a>, as
naturally Requests does not have to move to an event loop model before it drops
support for Python 2.7. However, it does make it painful for Requests (and pip)
to embrace both asyncio and the <tt class="docutils literal">async</tt> and <tt class="docutils literal">await</tt> keywords for as long as
it continues to support Python 2.</p>
</div>
<div class="section" id="other-benefits">
<h2><a class="toc-backref" href="#id6">Other Benefits</a></h2>
<p>Adopting this PEP would have other smaller ecosystem benefits. For example,
Twisted would be able to reduce its dependency on third-party C extensions.
Additionally, the PyOpenSSL development team would like to sunset the module,
and this backport would free them up to do so in a graceful manner without
leaving their users in the lurch.</p>
<p>Each of these fringe benefits, while small, also provides value to the wider
Python ecosystem.</p>
</div>
</div>
<div class="section" id="concerns">
<h1><a class="toc-backref" href="#id7">Concerns</a></h1>
<p>There are some concerns that people have about this backport.</p>
<div class="section" id="what-about-old-python-2">
<h2><a class="toc-backref" href="#id8">What About Old Python 2?</a></h2>
<p>A number of the Python 2 users in the world are not keeping pace with Python 2
releases. This is most usually because they are using LTS releases that are not
keeping pace with the minor releases of Python 2. These users would not be able
to use the MemoryBIO, and so projects concerned with Python 2 compatibility may
be unable to rely on the MemoryBIO being present on most of their user's
systems.</p>
<p>This concern is reasonable. How critical it is depends on the likelihood of
current users of Python 2 migrating to Python 3, or just trying to use the most
recent Python 2 release. Put another way, at some point libraries will want to
drop Python 2 support: the question is only whether a significant majority of
their Python 2 users have moved to whatever Python 2 release contains this
backport before they do so.</p>
<p>Ultimately, the authors of this PEP believe that the burden of this backport is
sufficiently minimal to justify backporting despite this concern. If it turns
out that migration to newer 2.7 releases is too slow, then the value of the
work will be minimal, but if the migration to newer 2.7 releases is anything
like reasonable then there will be substantial value gained.</p>
</div>
</div>
<div class="section" id="changes">
<h1><a class="toc-backref" href="#id9">Changes</a></h1>
<p>Add <tt class="docutils literal">MemoryBIO</tt> and <tt class="docutils literal">SSLObject</tt> classes to the <tt class="docutils literal">ssl</tt> module of
Python 2.7.</p>
<p>The code will be backported and adapted from the master branch
(Python 3).</p>
<p>The backport also significantly reduced the size of the Python 2/Python
3 difference of the <tt class="docutils literal">_ssl</tt> module, which make maintenance easier.</p>
</div>
<div class="section" id="links">
<h1><a class="toc-backref" href="#id10">Links</a></h1>
<ul class="simple">
<li><a class="reference external" href="/dev/peps/pep-0543">PEP 543</a></li>
<li><a class="reference external" href="https://bugs.python.org/issue22559">[backport] ssl.MemoryBIO</a>: Implementation of this PEP
written by Alex Gaynor (first version written at October 2014)</li>
<li><a class="reference external" href="/dev/peps/pep-0466">PEP 466</a></li>
</ul>
</div>
<div class="section" id="discussions">
<h1><a class="toc-backref" href="#id11">Discussions</a></h1>
<ul class="simple">
<li><a class="reference external" href="https://mail.python.org/pipermail/python-dev/2017-May/147981.html">[Python-Dev] Backport ssl.MemoryBIO on Python 2.7?</a>
(May 2017)</li>
</ul>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id12">Copyright</a></h1>
<p>This document has been placed in the public domain.</p>
<!-- Local Variables:
mode: indented-text
indent-tabs-mode: nil
sentence-end-double-space: t
fill-column: 70
coding: utf-8
End: -->
</div>

