<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">PEP:</th><td class="field-body">229</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">Using Distutils to Build Python</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">$Revision$</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference external" href="https://hg.python.org/peps/file/tip/pep-0229.txt">$Date$</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">A.M. Kuchling &lt;amk&#32;&#97;t&#32;amk.ca&gt;</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Final</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Standards Track</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference external" href="/dev/peps/pep-0012">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">16-Nov-2000</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id2">Introduction</a></li>
<li><a class="reference internal" href="#proposal" id="id3">Proposal</a></li>
<li><a class="reference internal" href="#implementation" id="id4">Implementation</a></li>
<li><a class="reference internal" href="#unresolved-issues" id="id5">Unresolved Issues</a></li>
<li><a class="reference internal" href="#copyright" id="id6">Copyright</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h1><a class="toc-backref" href="#id2">Introduction</a></h1>
<p>The <tt class="docutils literal">Modules/Setup</tt> mechanism has some flaws:</p>
<ul class="simple">
<li>People have to remember to uncomment bits of <tt class="docutils literal">Modules/Setup</tt> in
order to get all the possible modules.</li>
<li>Moving <tt class="docutils literal">Setup</tt> to a new version of Python is tedious; new modules
have been added, so you can't just copy the older version, but
have to reconcile the two versions.</li>
<li>Users have to figure out where the needed libraries, such as
<tt class="docutils literal">zlib</tt>, are installed.</li>
</ul>
</div>
<div class="section" id="proposal">
<h1><a class="toc-backref" href="#id3">Proposal</a></h1>
<p>Use the Distutils to build the modules that come with Python.</p>
<p>The changes can be broken up into several pieces:</p>
<ol class="arabic">
<li><p class="first">The Distutils needs some Python modules to be able to build
modules.  Currently I believe the minimal list is <tt class="docutils literal">posix</tt>, <tt class="docutils literal">_sre</tt>,
and <tt class="docutils literal">string</tt>.</p>
<p>These modules will have to be built before the Distutils can be
used, so they'll simply be hardwired into <tt class="docutils literal">Modules/Makefile</tt> and
be automatically built.</p>
</li>
<li><p class="first">A top-level setup.py script will be written that checks the
libraries installed on the system and compiles as many modules
as possible.</p>
</li>
<li><p class="first"><tt class="docutils literal">Modules/Setup</tt> will be kept and settings in it will override
<tt class="docutils literal">setup.py</tt>'s usual behavior, so you can disable a module known
to be buggy, or specify particular compilation or linker flags.
However, in the common case where <tt class="docutils literal">setup.py</tt> works correctly,
everything in <tt class="docutils literal">Setup</tt> will remain commented out.  The other
<tt class="docutils literal">Setup.*</tt> become unnecessary, since nothing will be generating
<tt class="docutils literal">Setup</tt> automatically.</p>
</li>
</ol>
<p>The patch was checked in for Python 2.1, and has been subsequently
modified.</p>
</div>
<div class="section" id="implementation">
<h1><a class="toc-backref" href="#id4">Implementation</a></h1>
<p>Patch #102588 on SourceForge contains the proposed patch.
Currently the patch tries to be conservative and to change as few
files as possible, in order to simplify backing out the patch.
For example, no attempt is made to rip out the existing build
mechanisms.  Such simplifications can wait for later in the beta
cycle, when we're certain the patch will be left in, or they can
wait for Python 2.2.</p>
<p>The patch makes the following changes:</p>
<ul class="simple">
<li>Makes some required changes to distutils/sysconfig (these will
be checked in separately)</li>
<li>In the top-level <tt class="docutils literal">Makefile.in</tt>, the &quot;sharedmods&quot; target simply
runs <tt class="docutils literal"><span class="pre">&quot;./python</span> setup.py build&quot;</tt>, and &quot;sharedinstall&quot; runs
<tt class="docutils literal"><span class="pre">&quot;./python</span> setup.py install&quot;</tt>.  The &quot;clobber&quot; target also deletes
the <tt class="docutils literal">build/</tt> subdirectory where Distutils puts its output.</li>
<li><tt class="docutils literal">Modules/Setup.config.in</tt> only contains entries for the <tt class="docutils literal">gc</tt> and <tt class="docutils literal">thread</tt>
modules; the <tt class="docutils literal">readline</tt>, <tt class="docutils literal">curses</tt>, and <tt class="docutils literal">db</tt> modules are removed because
it's now <tt class="docutils literal">setup.py</tt>'s job to handle them.</li>
<li><tt class="docutils literal">Modules/Setup.dist</tt> now contains entries for only 3 modules --
<tt class="docutils literal">_sre</tt>, <tt class="docutils literal">posix</tt>, and <tt class="docutils literal">strop</tt>.</li>
<li>The <tt class="docutils literal">configure</tt> script builds <tt class="docutils literal">setup.cfg</tt> from <tt class="docutils literal">setup.cfg.in</tt>.  This
is needed for two reasons: to make building in subdirectories
work, and to get the configured installation prefix.</li>
<li>Adds <tt class="docutils literal">setup.py</tt> to the top directory of the source tree.  <tt class="docutils literal">setup.py</tt>
is the largest piece of the puzzle, though not the most
complicated.  <tt class="docutils literal">setup.py</tt> contains a subclass of the <tt class="docutils literal">BuildExt</tt>
class, and extends it with a <tt class="docutils literal">detect_modules()</tt> method that does
the work of figuring out when modules can be compiled, and adding
them to the 'exts' list.</li>
</ul>
</div>
<div class="section" id="unresolved-issues">
<h1><a class="toc-backref" href="#id5">Unresolved Issues</a></h1>
<p>Do we need to make it possible to disable the 3 hard-wired modules
without manually hacking the Makefiles?  [Answer: No.]</p>
<p>The Distutils always compile modules as shared libraries.  How do
we support compiling them statically into the resulting Python
binary?</p>
<p>[Answer: building a Python binary with the Distutils should be
feasible, though no one has implemented it yet.  This should be
done someday, but isn't a pressing priority as messing around with
the top-level <tt class="docutils literal">Makefile.pre.in</tt> is good enough.]</p>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id6">Copyright</a></h1>
<p>This document has been placed in the public domain.</p>
<!-- Local Variables:
mode: indented-text
indent-tabs-mode: nil
End: -->
</div>

