<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">PEP:</th><td class="field-body">215</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">String Interpolation</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">$Revision$</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference external" href="https://hg.python.org/peps/file/tip/pep-0215.txt">$Date$</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">ping&#32;&#97;t&#32;zesty.ca (Ka-Ping Yee)</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Superseded</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Standards Track</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference external" href="/dev/peps/pep-0012">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">24-Jul-2000</td>
</tr>
<tr class="field"><th class="field-name">Python-Version:</th><td class="field-body">2.1</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body"></td>
</tr>
<tr class="field"><th class="field-name">Superseded-By:</th><td class="field-body">292</td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#abstract" id="id3">Abstract</a></li>
<li><a class="reference internal" href="#copyright" id="id4">Copyright</a></li>
<li><a class="reference internal" href="#specification" id="id5">Specification</a></li>
<li><a class="reference internal" href="#examples" id="id6">Examples</a></li>
<li><a class="reference internal" href="#discussion" id="id7">Discussion</a></li>
<li><a class="reference internal" href="#security-issues" id="id8">Security Issues</a></li>
<li><a class="reference internal" href="#implementation" id="id9">Implementation</a></li>
<li><a class="reference internal" href="#references" id="id10">References</a></li>
</ul>
</div>
<div class="section" id="abstract">
<h1><a class="toc-backref" href="#id3">Abstract</a></h1>
<p>This document proposes a string interpolation feature for Python
to allow easier string formatting.  The suggested syntax change
is the introduction of a '$' prefix that triggers the special
interpretation of the '$' character within a string, in a manner
reminiscent to the variable interpolation found in Unix shells,
awk, Perl, or Tcl.</p>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id4">Copyright</a></h1>
<p>This document is in the public domain.</p>
</div>
<div class="section" id="specification">
<h1><a class="toc-backref" href="#id5">Specification</a></h1>
<p>Strings may be preceded with a '$' prefix that comes before the
leading single or double quotation mark (or triplet) and before
any of the other string prefixes ('r' or 'u').  Such a string is
processed for interpolation after the normal interpretation of
backslash-escapes in its contents.  The processing occurs just
before the string is pushed onto the value stack, each time the
string is pushed.  In short, Python behaves exactly as if '$'
were a unary operator applied to the string.  The operation
performed is as follows:</p>
<p>The string is scanned from start to end for the '$' character
(<tt class="docutils literal">\x24</tt> in 8-bit strings or <tt class="docutils literal">\u0024</tt> in Unicode strings).  If there
are no '$' characters present, the string is returned unchanged.</p>
<p>Any '$' found in the string, followed by one of the two kinds of
expressions described below, is replaced with the value of the
expression as evaluated in the current namespaces.  The value is
converted with <tt class="docutils literal">str()</tt> if the containing string is an 8-bit string,
or with <tt class="docutils literal">unicode()</tt> if it is a Unicode string.</p>
<ol class="arabic simple">
<li>A Python identifier optionally followed by any number of
trailers, where a trailer consists of:
- a dot and an identifier,
- an expression enclosed in square brackets, or
- an argument list enclosed in parentheses
(This is exactly the pattern expressed in the Python grammar
by &quot;<tt class="docutils literal">NAME trailer*</tt>&quot;, using the definitions in <tt class="docutils literal">Grammar/Grammar</tt>.)</li>
<li>Any complete Python expression enclosed in curly braces.</li>
</ol>
<p>Two dollar-signs (&quot;$$&quot;) are replaced with a single &quot;$&quot;.</p>
</div>
<div class="section" id="examples">
<h1><a class="toc-backref" href="#id6">Examples</a></h1>
<p>Here is an example of an interactive session exhibiting the
expected behaviour of this feature.</p>
<pre class="literal-block">
&gt;&gt;&gt; a, b = 5, 6
&gt;&gt;&gt; print $'a = $a, b = $b'
a = 5, b = 6
&gt;&gt;&gt; $u'uni${a}ode'
u'uni5ode'
&gt;&gt;&gt; print $'\$a'
5
&gt;&gt;&gt; print $r'\$a'
\5
&gt;&gt;&gt; print $'$$$a.$b'
$5.6
&gt;&gt;&gt; print $'a + b = ${a + b}'
a + b = 11
&gt;&gt;&gt; import sys
&gt;&gt;&gt; print $'References to $a: $sys.getrefcount(a)'
References to 5: 15
&gt;&gt;&gt; print $&quot;sys = $sys, sys = $sys.modules['sys']&quot;
sys = &lt;module 'sys' (built-in)&gt;, sys = &lt;module 'sys' (built-in)&gt;
&gt;&gt;&gt; print $'BDFL = $sys.copyright.split()[4].upper()'
BDFL = GUIDO
</pre>
</div>
<div class="section" id="discussion">
<h1><a class="toc-backref" href="#id7">Discussion</a></h1>
<p>'$' is chosen as the interpolation character within the
string for the sake of familiarity, since it is already used
for this purpose in many other languages and contexts.</p>
<p>It is then natural to choose '$' as a prefix, since it is a
mnemonic for the interpolation character.</p>
<p>Trailers are permitted to give this interpolation mechanism
even more power than the interpolation available in most other
languages, while the expression to be interpolated remains
clearly visible and free of curly braces.</p>
<p>'$' works like an operator and could be implemented as an
operator, but that prevents the compile-time optimization
and presents security issues.  So, it is only allowed as a
string prefix.</p>
</div>
<div class="section" id="security-issues">
<h1><a class="toc-backref" href="#id8">Security Issues</a></h1>
<p>&quot;$&quot; has the power to eval, but only to eval a literal.  As
described here (a string prefix rather than an operator), it
introduces no new security issues since the expressions to be
evaluated must be literally present in the code.</p>
</div>
<div class="section" id="implementation">
<h1><a class="toc-backref" href="#id9">Implementation</a></h1>
<p>The <tt class="docutils literal">Itpl</tt> module at <a class="footnote-reference" href="#id2" id="id1">[1]</a> provides a
prototype of this feature.  It uses the <tt class="docutils literal">tokenize</tt> module to find
the end of an expression to be interpolated, then calls <tt class="docutils literal">eval()</tt>
on the expression each time a value is needed.  In the prototype,
the expression is parsed and compiled again each time it is
evaluated.</p>
<p>As an optimization, interpolated strings could be compiled
directly into the corresponding bytecode; that is,</p>
<pre class="literal-block">
$'a = $a, b = $b'
</pre>
<p>could be compiled as though it were the expression</p>
<pre class="literal-block">
('a = ' + str(a) + ', b = ' + str(b))
</pre>
<p>so that it only needs to be compiled once.</p>
</div>
<div class="section" id="references">
<h1><a class="toc-backref" href="#id10">References</a></h1>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="http://www.lfw.org/python/Itpl.py">http://www.lfw.org/python/Itpl.py</a></td></tr>
</tbody>
</table>
<!-- Local Variables:
mode: indented-text
indent-tabs-mode: nil
End: -->
</div>

