<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">PEP:</th><td class="field-body">486</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">Make the Python Launcher aware of virtual environments</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">$Revision$</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference external" href="https://hg.python.org/peps/file/tip/pep-0486.txt">$Date$</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">Paul Moore &lt;p.f.moore&#32;&#97;t&#32;gmail.com&gt;</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Final</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Standards Track</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference external" href="/dev/peps/pep-0012">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">12-Feb-2015</td>
</tr>
<tr class="field"><th class="field-name">Python-Version:</th><td class="field-body">3.5</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body">12-Feb-2015</td>
</tr>
<tr class="field"><th class="field-name">Resolution:</th><td class="field-body"><a class="reference external" href="https://mail.python.org/pipermail/python-dev/2015-February/138579.html">https://mail.python.org/pipermail/python-dev/2015-February/138579.html</a></td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#abstract" id="id3">Abstract</a></li>
<li><a class="reference internal" href="#rationale" id="id4">Rationale</a></li>
<li><a class="reference internal" href="#implementation" id="id5">Implementation</a></li>
<li><a class="reference internal" href="#impact-on-script-launching" id="id6">Impact on Script Launching</a></li>
<li><a class="reference internal" href="#exclusions" id="id7">Exclusions</a></li>
<li><a class="reference internal" href="#reference-implementation" id="id8">Reference Implementation</a></li>
<li><a class="reference internal" href="#references" id="id9">References</a></li>
<li><a class="reference internal" href="#copyright" id="id10">Copyright</a></li>
</ul>
</div>
<div class="section" id="abstract">
<h1><a class="toc-backref" href="#id3">Abstract</a></h1>
<p>The Windows installers for Python include a launcher that locates the
correct Python interpreter to run (see <a class="reference external" href="/dev/peps/pep-0397">PEP 397</a>).  However, the
launcher is not aware of virtual environments (virtualenv <a class="footnote-reference" href="#id2" id="id1">[1]</a> or <a class="reference external" href="/dev/peps/pep-0405">PEP
405</a> based), and so cannot be used to run commands from the active
virtualenv.</p>
<p>This PEP proposes making the launcher &quot;virtualenv aware&quot;.  This means
that when run without specifying an explicit Python interpreter to
use, the launcher will use the currently active virtualenv, if any,
before falling back to the configured default Python.</p>
</div>
<div class="section" id="rationale">
<h1><a class="toc-backref" href="#id4">Rationale</a></h1>
<p>Windows users with multiple copies of Python installed need a means of
selecting which one to use.  The Python launcher provides this
facility by means of a <tt class="docutils literal">py</tt> command that can be used to run either a
configured &quot;default&quot; Python or a specific interpreter, by means of
command line arguments.  So typical usage would be:</p>
<pre class="literal-block">
# Run the Python interactive interpreter
py

# Execute an installed module
py -m pip install pytest
py -m pytest
</pre>
<p>When using virtual environments, the <tt class="docutils literal">py</tt> launcher is unaware that a
virtualenv is active, and will continue to use the system Python.  So
different command invocations are needed to run the same commands in a
virtualenv:</p>
<pre class="literal-block">
# Run the Python interactive interpreter
python

# Execute an installed module (these could use python -m,
# which is longer to type but is a little more similar to the
# launcher approach)
pip install pytest
py.test
</pre>
<p>Having to use different commands is error-prone, and in many cases
the error is difficult to spot immediately. The PEP proposes making
the <tt class="docutils literal">py</tt> command usable with virtual environments, so that the first
form of command can be used in all cases.</p>
</div>
<div class="section" id="implementation">
<h1><a class="toc-backref" href="#id5">Implementation</a></h1>
<p>Both <tt class="docutils literal">virtualenv</tt> and the core <tt class="docutils literal">venv</tt> module set an environment
variable <tt class="docutils literal">VIRTUAL_ENV</tt> when activating a virtualenv.  This PEP
proposes that the launcher checks for the <tt class="docutils literal">VIRTUAL_ENV</tt> environment
variable whenever it would run the &quot;default&quot; Python interpreter for
the system (i.e., when no specific version flags such as <tt class="docutils literal">py <span class="pre">-2.7</span></tt>
are used) and if present, run the Python interpreter for the
virtualenv rather than the default system Python.</p>
<p>The &quot;default&quot; Python interpreter referred to above is (as per <a class="reference external" href="/dev/peps/pep-0397">PEP 397</a>)
either the latest version of Python installed on the system, or
a version configured via the <tt class="docutils literal">py.ini</tt> configuration file.  When the
user specifies an explicit Python version on the command line, this
will always be used (as at present).</p>
</div>
<div class="section" id="impact-on-script-launching">
<h1><a class="toc-backref" href="#id6">Impact on Script Launching</a></h1>
<p>As well as interactive use, the launcher is used as the Windows file
association for Python scripts.  In that case, a &quot;shebang&quot; (<tt class="docutils literal">#!</tt>)
line at the start of the script is used to identify the interpreter to
run.  A fully-qualified path can be used, or a version-specific Python
(<tt class="docutils literal">python3</tt> or <tt class="docutils literal">python2</tt>, or even <tt class="docutils literal">python3.5</tt>), or the generic
<tt class="docutils literal">python</tt>, which means to use the default interpreter.</p>
<p>The launcher also looks for the specific shebang line
<tt class="docutils literal"><span class="pre">#!/usr/bin/env</span> python</tt>. On Unix, the <tt class="docutils literal">env</tt> program searches for a
command on <tt class="docutils literal">$PATH</tt> and runs the command so located. Similarly, with
this shebang line, the launcher will look for a copy of <tt class="docutils literal">python.exe</tt>
on the user's current <tt class="docutils literal">%PATH%</tt> and will run that copy.</p>
<p>As activating a virtualenv means that it is added to <tt class="docutils literal">PATH</tt>, no
special handling is needed to run scripts with the active virtualenv -
they just need to use the <tt class="docutils literal"><span class="pre">#!/usr/bin/env</span> python</tt> shebang line,
exactly as on Unix. (If there is no activated virtualenv, and no
<tt class="docutils literal">python.exe</tt> on <tt class="docutils literal">PATH</tt>, the launcher will look for a default
Python exactly as if the shebang line had said <tt class="docutils literal">#!python</tt>).</p>
</div>
<div class="section" id="exclusions">
<h1><a class="toc-backref" href="#id7">Exclusions</a></h1>
<p>The PEP makes no attempt to promote the use of the launcher for
running Python on Windows.  Most existing documentation assumes the
user of <tt class="docutils literal">python</tt> as the command to run Python, and (for example)
<tt class="docutils literal">pip</tt> to run an installed Python command.  This documentation is not
expected to change, and users who choose to manage their <tt class="docutils literal">PATH</tt>
environment variable can continue to use this form.  The focus of this
PEP is purely on allowing users who prefer to use the launcher when
dealing with their system Python installations, to be able to continue
to do so when using virtual environments.</p>
</div>
<div class="section" id="reference-implementation">
<h1><a class="toc-backref" href="#id8">Reference Implementation</a></h1>
<p>A patch implementing the proposed behaviour is available at
<a class="reference external" href="http://bugs.python.org/issue23465">http://bugs.python.org/issue23465</a></p>
</div>
<div class="section" id="references">
<h1><a class="toc-backref" href="#id9">References</a></h1>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="https://virtualenv.pypa.io/">https://virtualenv.pypa.io/</a></td></tr>
</tbody>
</table>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id10">Copyright</a></h1>
<p>This document has been placed in the public domain.</p>
<!-- Local Variables:
mode: indented-text
indent-tabs-mode: nil
sentence-end-double-space: t
fill-column: 70
coding: utf-8
End: -->
</div>

