<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">PEP:</th><td class="field-body">3145</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">Asynchronous I/O For subprocess.Popen</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">$Revision$</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference external" href="https://hg.python.org/peps/file/tip/pep-3145.txt">$Date$</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">(James) Eric Pruitt, Charles R. McCreary, Josiah Carlson</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Withdrawn</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Standards Track</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference external" href="/dev/peps/pep-0012">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">04-Aug-2009</td>
</tr>
<tr class="field"><th class="field-name">Python-Version:</th><td class="field-body">3.2</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#abstract" id="id24">Abstract</a></li>
<li><a class="reference internal" href="#pep-deferral" id="id25">PEP Deferral</a></li>
<li><a class="reference internal" href="#pep-withdrawal" id="id26">PEP Withdrawal</a></li>
<li><a class="reference internal" href="#motivation" id="id27">Motivation</a></li>
<li><a class="reference internal" href="#rationale" id="id28">Rationale</a></li>
<li><a class="reference internal" href="#reference-implementation" id="id29">Reference Implementation</a></li>
<li><a class="reference internal" href="#references" id="id30">References</a></li>
<li><a class="reference internal" href="#copyright" id="id31">Copyright</a></li>
</ul>
</div>
<div class="section" id="abstract">
<h1><a class="toc-backref" href="#id24">Abstract</a></h1>
<p>In its present form, the <tt class="docutils literal">subprocess.Popen</tt> implementation is prone to
dead-locking and blocking of the parent Python script while waiting on data
from the child process. This PEP proposes to make
<tt class="docutils literal">subprocess.Popen</tt> more asynchronous to help alleviate these
problems.</p>
</div>
<div class="section" id="pep-deferral">
<h1><a class="toc-backref" href="#id25">PEP Deferral</a></h1>
<p>Further exploration of the concepts covered in this PEP has been deferred
at least until after <a class="reference external" href="/dev/peps/pep-3156">PEP 3156</a> has been resolved.</p>
</div>
<div class="section" id="pep-withdrawal">
<h1><a class="toc-backref" href="#id26">PEP Withdrawal</a></h1>
<p>This can be dealt with in the bug tracker.  A specific proposal is
attached to <a class="footnote-reference" href="#id23" id="id1">[11]</a>.</p>
</div>
<div class="section" id="motivation">
<h1><a class="toc-backref" href="#id27">Motivation</a></h1>
<p>A search for &quot;python asynchronous subprocess&quot; will turn up numerous
accounts of people wanting to execute a child process and communicate with
it from time to time reading only the data that is available instead of
blocking to wait for the program to produce data <a class="footnote-reference" href="#id13" id="id2">[1]</a> <a class="footnote-reference" href="#id14" id="id3">[2]</a> <a class="footnote-reference" href="#id15" id="id4">[3]</a>.  The current
behavior of the <tt class="docutils literal">subprocess</tt> module is that when a user sends or receives
data via the stdin, stderr and stdout file objects, dead locks are common
and documented <a class="footnote-reference" href="#id16" id="id5">[4]</a> <a class="footnote-reference" href="#id17" id="id6">[5]</a>.  While communicate can be used to alleviate some of
the buffering issues, it will still cause the parent process to block while
attempting to read data when none is available to be read from the child
process.</p>
</div>
<div class="section" id="rationale">
<h1><a class="toc-backref" href="#id28">Rationale</a></h1>
<p>There is a documented need for asynchronous, non-blocking functionality in
<tt class="docutils literal">subprocess.Popen</tt> <a class="footnote-reference" href="#id18" id="id7">[6]</a> <a class="footnote-reference" href="#id19" id="id8">[7]</a> <a class="footnote-reference" href="#id14" id="id9">[2]</a> <a class="footnote-reference" href="#id15" id="id10">[3]</a>.  Inclusion of the code would improve the
utility of the Python standard library that can be used on Unix based and
Windows builds of Python.  Practically every I/O object in Python has a
file-like wrapper of some sort.  Sockets already act as such and for
strings there is <tt class="docutils literal">StringIO</tt>.  Popen can be made to act like a file by simply
using the methods attached to the <tt class="docutils literal">subprocess.Popen.stderr</tt>, stdout and
stdin file-like objects.  But when using the read and write methods of
those options, you do not have the benefit of asynchronous I/O.  In the
proposed solution the wrapper wraps the asynchronous methods to mimic a
file object.</p>
</div>
<div class="section" id="reference-implementation">
<h1><a class="toc-backref" href="#id29">Reference Implementation</a></h1>
<p>I have been maintaining a Google Code repository that contains all of my
changes including tests and documentation <a class="footnote-reference" href="#id21" id="id11">[9]</a> as well as blog detailing
the problems I have come across in the development process <a class="footnote-reference" href="#id22" id="id12">[10]</a>.</p>
<p>I have been working on implementing non-blocking asynchronous I/O in the
<tt class="docutils literal">subprocess</tt> module as well as a wrapper class for <tt class="docutils literal">subprocess.Popen</tt>
that makes it so that an executed process can take the place of a file by
duplicating all of the methods and attributes that file objects have.</p>
<p>There are two base functions that have been added to the <tt class="docutils literal">subprocess.Popen</tt>
class: <tt class="docutils literal">Popen.send</tt> and <tt class="docutils literal">Popen._recv</tt>, each with two separate implementations,
one for Windows and one for Unix-based systems.  The Windows
implementation uses ctypes to access the functions needed to control pipes
in the kernel 32 DLL in an asynchronous manner.  On Unix based systems,
the Python interface for file control serves the same purpose.  The
different implementations of <tt class="docutils literal">Popen.send</tt> and <tt class="docutils literal">Popen._recv</tt> have identical
arguments to make code that uses these functions work across multiple
platforms.</p>
<p>When calling the <tt class="docutils literal">Popen._recv</tt> function, it requires the pipe name be
passed as an argument so there exists the <tt class="docutils literal">Popen.recv</tt> function that passes
selects stdout as the pipe for <tt class="docutils literal">Popen._recv</tt> by default. <tt class="docutils literal">Popen.recv_err</tt>
selects stderr as the pipe by default. <tt class="docutils literal">Popen.recv</tt> and <tt class="docutils literal">Popen.recv_err</tt>
are much easier to read and understand than <tt class="docutils literal"><span class="pre">Popen._recv('stdout'</span> <span class="pre">...)</span></tt> and
<tt class="docutils literal"><span class="pre">Popen._recv('stderr'</span> <span class="pre">...)</span></tt> respectively.</p>
<p>Since the <tt class="docutils literal">Popen._recv</tt> function does not wait on data to be produced
before returning a value, it may return empty bytes. <tt class="docutils literal">Popen.asyncread</tt>
handles this issue by returning all data read over a given time
interval.</p>
<p>The <tt class="docutils literal">ProcessIOWrapper</tt> class uses the <tt class="docutils literal">asyncread</tt> and <tt class="docutils literal">asyncwrite</tt> functions to
allow a process to act like a file so that there are no blocking issues
that can arise from using the stdout and stdin file objects produced from
a <tt class="docutils literal">subprocess.Popen</tt> call.</p>
</div>
<div class="section" id="references">
<h1><a class="toc-backref" href="#id30">References</a></h1>
<table class="docutils footnote" frame="void" id="id13" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[1]</a></td><td>[ python-Feature Requests-1191964 ] asynchronous Subprocess
<a class="reference external" href="https://mail.python.org/pipermail/python-bugs-list/2006-December/">https://mail.python.org/pipermail/python-bugs-list/2006-December/</a>
036524.html</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id14" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[2]</td><td><em>(<a class="fn-backref" href="#id3">1</a>, <a class="fn-backref" href="#id9">2</a>)</em> Daily Life in an Ivory Basement : /feb-07/problems-with-subprocess
<a class="reference external" href="http://ivory.idyll.org/blog/feb-07/problems-with-subprocess">http://ivory.idyll.org/blog/feb-07/problems-with-subprocess</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id15" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[3]</td><td><em>(<a class="fn-backref" href="#id4">1</a>, <a class="fn-backref" href="#id10">2</a>)</em> How can I run an external command asynchronously from Python? - Stack
Overflow
<a class="reference external" href="http://stackoverflow.com/questions/636561/how-can-i-run-an-external">http://stackoverflow.com/questions/636561/how-can-i-run-an-external</a>-
command-asynchronously-from-python</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id16" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[4]</a></td><td>18.1. subprocess - Subprocess management - Python v2.6.2 documentation
<a class="reference external" href="http://docs.python.org/library/subprocess.html#subprocess.Popen.wait">http://docs.python.org/library/subprocess.html#subprocess.Popen.wait</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id17" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[5]</a></td><td>18.1. subprocess - Subprocess management - Python v2.6.2 documentation
<a class="reference external" href="http://docs.python.org/library/subprocess.html#subprocess.Popen.kill">http://docs.python.org/library/subprocess.html#subprocess.Popen.kill</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id18" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[6]</a></td><td>Issue 1191964: asynchronous Subprocess - Python tracker
<a class="reference external" href="http://bugs.python.org/issue1191964">http://bugs.python.org/issue1191964</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id19" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id8">[7]</a></td><td>Module to allow Asynchronous subprocess use on Windows and Posix
platforms - ActiveState Code
<a class="reference external" href="http://code.activestate.com/recipes/440554/">http://code.activestate.com/recipes/440554/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id20" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[8]</td><td>subprocess.rst - subprocdev - Project Hosting on Google Code
<a class="reference external" href="http://code.google.com/p/subprocdev/source/browse/doc/subprocess.rst?spec=svn2c925e935cad0166d5da85e37c742d8e7f609de5&amp;r=2c925e935cad0166d5da85e37c742d8e7f609de5#437">http://code.google.com/p/subprocdev/source/browse/doc/subprocess.rst?spec=svn2c925e935cad0166d5da85e37c742d8e7f609de5&amp;r=2c925e935cad0166d5da85e37c742d8e7f609de5#437</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id21" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id11">[9]</a></td><td>subprocdev - Project Hosting on Google Code
<a class="reference external" href="http://code.google.com/p/subprocdev">http://code.google.com/p/subprocdev</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id22" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id12">[10]</a></td><td>Python Subprocess Dev
<a class="reference external" href="http://subdev.blogspot.com/">http://subdev.blogspot.com/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id23" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[11]</a></td><td><a class="reference external" href="https://bugs.python.org/issue18823">https://bugs.python.org/issue18823</a> -- Idle: use pipes instead of
sockets to talk with user subprocess</td></tr>
</tbody>
</table>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id31">Copyright</a></h1>
<p>This P.E.P. is licensed under the Open Publication License;
<a class="reference external" href="http://www.opencontent.org/openpub/">http://www.opencontent.org/openpub/</a>.</p>
</div>

