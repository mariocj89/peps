<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">PEP:</th><td class="field-body">561</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">Distributing and Packaging Type Information</td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">Ethan Smith &lt;ethan&#32;&#97;t&#32;ethanhs.me&gt;</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Draft</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Standards Track</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference external" href="/dev/peps/pep-0012">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">09-Sep-2017</td>
</tr>
<tr class="field"><th class="field-name">Python-Version:</th><td class="field-body">3.7</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body">10-Sep-2017, 12-Sep-2017, 06-Oct-2017, 26-Oct-2017</td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#abstract" id="id10">Abstract</a></li>
<li><a class="reference internal" href="#rationale" id="id11">Rationale</a></li>
<li><a class="reference internal" href="#definition-of-terms" id="id12">Definition of Terms</a></li>
<li><a class="reference internal" href="#specification" id="id13">Specification</a><ul>
<li><a class="reference internal" href="#packaging-type-information" id="id14">Packaging Type Information</a><ul>
<li><a class="reference internal" href="#stub-only-packages" id="id15">Stub Only Packages</a></li>
</ul>
</li>
<li><a class="reference internal" href="#type-checker-module-resolution-order" id="id16">Type Checker Module Resolution Order</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementation" id="id17">Implementation</a></li>
<li><a class="reference internal" href="#acknowledgements" id="id18">Acknowledgements</a></li>
<li><a class="reference internal" href="#version-history" id="id19">Version History</a></li>
<li><a class="reference internal" href="#references" id="id20">References</a></li>
<li><a class="reference internal" href="#copyright" id="id21">Copyright</a></li>
</ul>
</div>
<div class="section" id="abstract">
<h1><a class="toc-backref" href="#id10">Abstract</a></h1>
<p><a class="reference external" href="/dev/peps/pep-0484">PEP 484</a> introduced type hinting to Python, with goals of making typing
gradual and easy to adopt. Currently, typing information must be distributed
manually. This PEP provides a standardized means to leverage existing tooling
to package and distribute type information with minimal work and an ordering
for type checkers to resolve modules and collect this information for type
checking.</p>
</div>
<div class="section" id="rationale">
<h1><a class="toc-backref" href="#id11">Rationale</a></h1>
<p>Currently, package authors wish to distribute code that has inline type
information. Additionally, maintainers would like to distribute stub files
to keep Python 2 compatibility while using newer annotation syntax. However,
there is no standard method to distribute packages with type information.
Also, if one wished to ship stub files privately the only method available
would be via setting <tt class="docutils literal">MYPYPATH</tt> or the equivalent to manually point to
stubs. If the package can be released publicly, it can be added to
typeshed <a class="footnote-reference" href="#id7" id="id1">[1]</a>. However, this does not scale and becomes a burden on the
maintainers of typeshed. In addition, it ties bug fixes in stubs to releases
of the tool using typeshed.</p>
<p><a class="reference external" href="/dev/peps/pep-0484">PEP 484</a> has a brief section on distributing typing information. In this
section <a class="footnote-reference" href="#id8" id="id2">[2]</a> the PEP recommends using <tt class="docutils literal">shared/typehints/pythonX.Y/</tt> for
shipping stub files. However, manually adding a path to stub files for each
third party library does not scale. The simplest approach people have taken
is to add <tt class="docutils literal"><span class="pre">site-packages</span></tt> to their <tt class="docutils literal">MYPYPATH</tt>, but this causes type
checkers to fail on packages that are highly dynamic (e.g. sqlalchemy
and Django).</p>
</div>
<div class="section" id="definition-of-terms">
<h1><a class="toc-backref" href="#id12">Definition of Terms</a></h1>
<p>The definition of &quot;MAY&quot;, &quot;MUST&quot;, and &quot;SHOULD&quot;, and &quot;SHOULD NOT&quot; are
to be interpreted as described in <a class="reference external" href="http://tools.ietf.org/html/rfc2119.html">RFC 2119</a>.</p>
<p>&quot;inline&quot; - the types are part of the runtime code using <a class="reference external" href="/dev/peps/pep-0526">PEP 526</a> and 3107
syntax.</p>
<p>&quot;stubs&quot; - files containing only type information, empty of runtime code.</p>
<p>&quot;Distributions&quot; are the packaged files which are used to publish and distribute
a release. <a class="footnote-reference" href="#id9" id="id3">[3]</a></p>
<p>&quot;Module&quot; a file containing Python runtime code or stubbed type information.</p>
<p>&quot;Package&quot; a directory or directories that namespace Python modules.</p>
</div>
<div class="section" id="specification">
<h1><a class="toc-backref" href="#id13">Specification</a></h1>
<p>There are several motivations and methods of supporting typing in a package.
This PEP recognizes three (3) types of packages that users of typing wish to
create:</p>
<ol class="arabic simple">
<li>The package maintainer would like to add type information inline.</li>
<li>The package maintainer would like to add type information via stubs.</li>
<li>A third party or package maintainer would like to share stub files for
a package, but the maintainer does not want to include them in the source
of the package.</li>
</ol>
<p>This PEP aims to support these scenarios and make them simple to add to
packaging and deployment.</p>
<p>The two major parts of this specification are the packaging specifications
and the resolution order for resolving module type information. The type
checking spec is meant to replace the <tt class="docutils literal">shared/typehints/pythonX.Y/</tt> spec
of <a class="reference external" href="/dev/peps/pep-0484">PEP 484</a> <a class="footnote-reference" href="#id8" id="id4">[2]</a>.</p>
<p>New third party stub libraries SHOULD distribute stubs via the third party
packaging methods proposed in this PEP in place of being added to typeshed.
Typeshed will remain in use, but if maintainers are found, third party stubs
in typeshed MAY be split into their own package.</p>
<div class="section" id="packaging-type-information">
<h2><a class="toc-backref" href="#id14">Packaging Type Information</a></h2>
<p>In order to make packaging and distributing type information as simple and
easy as possible, packaging and distribution is done through existing
frameworks.</p>
<p>Package maintainers who wish to support type checking of their code MUST add
a marker file named <tt class="docutils literal">py.typed</tt> to their package supporting typing. This marker applies
recursively: if a top-level package includes it, all its sub-packages MUST support
type checking as well. To have this file installed with the package,
maintainers can use existing packaging options such as <tt class="docutils literal">package_data</tt> in
distutils, shown below.</p>
<p>Distutils option example:</p>
<pre class="literal-block">
setup(
    ...,
    package_data = {
        'foopkg': ['py.typed'],
    },
    ...,
    )
</pre>
<p>For namespace packages, the <tt class="docutils literal">py.typed</tt> file should be in the submodules of
the namespace, to avoid conflicts and for clarity.</p>
<p>This PEP does not support distributing typing information as part of
module-only distributions. The code should be refactored into a package-based
distribution and indicate that the package supports typing as described
above.</p>
<div class="section" id="stub-only-packages">
<h3><a class="toc-backref" href="#id15">Stub Only Packages</a></h3>
<p>For package maintainers wishing to ship stub files containing all of their
type information, it is preferred that the <tt class="docutils literal">*.pyi</tt> stubs are alongside the
corresponding <tt class="docutils literal">*.py</tt> files. However, the stubs can also be put in a separate
package and distributed separately. Third parties can also find this method
useful if they wish to distribute stub files. The name of the stub package
MUST follow the scheme <tt class="docutils literal">foopkg_stubs</tt> for type stubs for the package named
<tt class="docutils literal">foopkg</tt>. The normal resolution order of checking <tt class="docutils literal">*.pyi</tt> before <tt class="docutils literal">*.py</tt>
will be maintained.</p>
<p>Third parties seeking to distribute stub files are encouraged to contact the
maintainer of the package about distribution alongside the package. If the
maintainer does not wish to maintain or package stub files or type information
inline, then a third party stub only package can be created.</p>
<p>In addition, stub-only distributions SHOULD indicate which version(s)
of the runtime package are supported by indicating the runtime distribution's
version(s) through normal dependency data. For example, the
stub package <tt class="docutils literal">flyingcircus_stubs</tt> can indicate the versions of the
runtime <tt class="docutils literal">flyingcircus</tt> distribution it supports through <tt class="docutils literal">install_requires</tt>
in distutils-based tools, or the equivalent in other packaging tools.</p>
</div>
</div>
<div class="section" id="type-checker-module-resolution-order">
<h2><a class="toc-backref" href="#id16">Type Checker Module Resolution Order</a></h2>
<p>The following is the order in which type checkers supporting this PEP SHOULD
resolve modules containing type information:</p>
<ol class="arabic simple">
<li>User code - the files the type checker is running on.</li>
<li>Stubs or Python source manually put in the beginning of the path. Type
checkers SHOULD provide this to allow the user complete control of which
stubs to use, and patch broken stubs/inline types from packages.</li>
<li>Stub packages - these packages can supersede the installed packages.
They can be found at <tt class="docutils literal">foopkg_stubs</tt> for package <tt class="docutils literal">foopkg</tt>.</li>
<li>Inline packages - if there is nothing overriding the installed
package, and it opts into type checking, inline types SHOULD be used.</li>
<li>Typeshed (if used) - Provides the stdlib types and several third party
libraries.</li>
</ol>
<p>Type checkers that check a different Python version than the version they run
on MUST find the type information in the <tt class="docutils literal"><span class="pre">site-packages</span></tt>/<tt class="docutils literal"><span class="pre">dist-packages</span></tt>
of that Python version. This can be queried e.g.
<tt class="docutils literal">pythonX.Y <span class="pre">-c</span> 'import site; <span class="pre">print(site.getsitepackages())'</span></tt>. It is also recommended
that the type checker allow for the user to point to a particular Python
binary, in case it is not in the path.</p>
</div>
</div>
<div class="section" id="implementation">
<h1><a class="toc-backref" href="#id17">Implementation</a></h1>
<p>The proposed scheme of indicating support for typing is completely backwards
compatible, and requires no modification to tooling. A sample package with
inline types is available <a class="citation-reference" href="#typed-pkg" id="id5">[typed_pkg]</a>, as well as a sample package checker
<a class="citation-reference" href="#pkg-checker" id="id6">[pkg_checker]</a> which reads the metadata of installed packages and reports on
their status as either not typed, inline typed, or a stub package.</p>
</div>
<div class="section" id="acknowledgements">
<h1><a class="toc-backref" href="#id18">Acknowledgements</a></h1>
<p>This PEP would not have been possible without the ideas, feedback, and support
of Ivan Levkivskyi, Jelle Zijlstra, Nick Coghlan, Daniel F Moisset, Nathaniel
Smith, and Guido van Rossum.</p>
</div>
<div class="section" id="version-history">
<h1><a class="toc-backref" href="#id19">Version History</a></h1>
<ul>
<li><p class="first">2017-11-12</p>
<blockquote>
<ul class="simple">
<li>Rewritten to use existing tooling only</li>
<li>No need to indicate kind of type information in metadata</li>
<li>Name of marker file changed from <tt class="docutils literal">.typeinfo</tt> to <tt class="docutils literal">py.typed</tt></li>
</ul>
</blockquote>
</li>
<li><p class="first">2017-11-10</p>
<blockquote>
<ul class="simple">
<li>Specification re-written to use package metadata instead of distribution
metadata.</li>
<li>Removed stub only packages and merged into third party packages spec.</li>
<li>Removed suggestion for typecheckers to consider checking runtime versions</li>
<li>Implementations updated to reflect PEP changes.</li>
</ul>
</blockquote>
</li>
<li><p class="first">2017-10-26</p>
<blockquote>
<ul class="simple">
<li>Added implementation references.</li>
<li>Added acknowledgements and version history.</li>
</ul>
</blockquote>
</li>
<li><p class="first">2017-10-06</p>
<blockquote>
<ul class="simple">
<li>Rewritten to use .distinfo/METADATA over a distutils specific command.</li>
<li>Clarify versioning of third party stub packages.</li>
</ul>
</blockquote>
</li>
<li><p class="first">2017-09-11</p>
<blockquote>
<ul class="simple">
<li>Added information about current solutions and typeshed.</li>
<li>Clarify rationale.</li>
</ul>
</blockquote>
</li>
</ul>
</div>
<div class="section" id="references">
<h1><a class="toc-backref" href="#id20">References</a></h1>
<table class="docutils footnote" frame="void" id="id7" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Typeshed (<a class="reference external" href="https://github.com/python/typeshed">https://github.com/python/typeshed</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[2]</td><td><em>(<a class="fn-backref" href="#id2">1</a>, <a class="fn-backref" href="#id4">2</a>)</em> <a class="reference external" href="/dev/peps/pep-0484">PEP 484</a>, Storing and Distributing Stub Files
(<a class="reference external" href="https://www.python.org/dev/peps/pep-0484/#storing-and-distributing-stub-files">https://www.python.org/dev/peps/pep-0484/#storing-and-distributing-stub-files</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id9" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td><a class="reference external" href="/dev/peps/pep-0426">PEP 426</a> definitions
(<a class="reference external" href="https://www.python.org/dev/peps/pep-0426/">https://www.python.org/dev/peps/pep-0426/</a>)</td></tr>
</tbody>
</table>
<table class="docutils citation" frame="void" id="typed-pkg" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[typed_pkg]</a></td><td>Sample typed package
(<a class="reference external" href="https://github.com/ethanhs/sample-typed-package">https://github.com/ethanhs/sample-typed-package</a>)</td></tr>
</tbody>
</table>
<table class="docutils citation" frame="void" id="pkg-checker" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[pkg_checker]</a></td><td>Sample package checker
(<a class="reference external" href="https://github.com/ethanhs/check_typedpkg">https://github.com/ethanhs/check_typedpkg</a>)</td></tr>
</tbody>
</table>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id21">Copyright</a></h1>
<p>This document has been placed in the public domain.</p>
<!-- Local Variables:
mode: indented-text
indent-tabs-mode: nil
sentence-end-double-space: t
fill-column: 70
coding: utf-8
End: -->
</div>

