<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">PEP:</th><td class="field-body">527</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">Removing Un(der)used file types/extensions on PyPI</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">$Revision$</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference external" href="https://hg.python.org/peps/file/tip/pep-0527.txt">$Date$</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">Donald Stufft &lt;donald&#32;&#97;t&#32;stufft.io&gt;</td>
</tr>
<tr class="field"><th class="field-name">BDFL-Delegate:</th><td class="field-body">Nick Coghlan &lt;ncoghlan&#32;&#97;t&#32;gmail.com&gt;</td>
</tr>
<tr class="field"><th class="field-name">Discussions-To:</th><td class="field-body"><a class="reference external" href="mailto:distutils-sig&#64;python.org?subject=PEP%20527">distutils-sig&#32;&#97;t&#32;python.org</a></td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Accepted</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Process</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference external" href="/dev/peps/pep-0012">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">23-Aug-2016</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body">23-Aug-2016</td>
</tr>
<tr class="field"><th class="field-name">Resolution:</th><td class="field-body"><a class="reference external" href="https://mail.python.org/pipermail/distutils-sig/2016-September/029624.html">https://mail.python.org/pipermail/distutils-sig/2016-September/029624.html</a></td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#abstract" id="id2">Abstract</a></li>
<li><a class="reference internal" href="#rationale" id="id3">Rationale</a><ul>
<li><a class="reference internal" href="#file-formats" id="id4">File Formats</a><ul>
<li><a class="reference internal" href="#bdist-dumb" id="id5">bdist_dumb</a></li>
<li><a class="reference internal" href="#bdist-rpm" id="id6">bdist_rpm</a></li>
<li><a class="reference internal" href="#bdist-dmg-bdist-msi-and-bdist-wininst" id="id7">bdist_dmg, bdist_msi, and bdist_wininst</a></li>
</ul>
</li>
<li><a class="reference internal" href="#file-extensions" id="id8">File Extensions</a></li>
<li><a class="reference internal" href="#limiting-number-of-sdists-per-release" id="id9">Limiting number of sdists per release</a></li>
</ul>
</li>
<li><a class="reference internal" href="#removal-process" id="id10">Removal Process</a></li>
<li><a class="reference internal" href="#copyright" id="id11">Copyright</a></li>
</ul>
</div>
<div class="section" id="abstract">
<h1><a class="toc-backref" href="#id2">Abstract</a></h1>
<p>This PEP recommends deprecating, and ultimately removing, support for uploading
certain unused or under used file types and extensions to PyPI. In particular
it recommends disallowing further uploads of any files of the types
<tt class="docutils literal">bdist_dumb</tt>, <tt class="docutils literal">bdist_rpm</tt>, <tt class="docutils literal">bdist_dmg</tt>, <tt class="docutils literal">bdist_msi</tt>, and
<tt class="docutils literal">bdist_wininst</tt>, leaving PyPI to only accept new uploads of the <tt class="docutils literal">sdist</tt>,
<tt class="docutils literal">bdist_wheel</tt>, and <tt class="docutils literal">bdist_egg</tt> file types.</p>
<p>In addition, this PEP proposes removing support for new uploads of sdists using
the <tt class="docutils literal">.tar</tt>, <tt class="docutils literal">.tar.bz2</tt>, <tt class="docutils literal">.tar.xz</tt>, <tt class="docutils literal">.tar.Z</tt>, <tt class="docutils literal">.tgz</tt>, <tt class="docutils literal">.tbz</tt>, and
any other extension besides <tt class="docutils literal">.tar.gz</tt> and <tt class="docutils literal">.zip</tt>.</p>
<p>Finally, this PEP also proposes limiting the number of allowed sdist uploads
for each individual release of a project on PyPI to one instead of one for each
allowed extension.</p>
</div>
<div class="section" id="rationale">
<h1><a class="toc-backref" href="#id3">Rationale</a></h1>
<div class="section" id="file-formats">
<h2><a class="toc-backref" href="#id4">File Formats</a></h2>
<p>Currently PyPI supports the following file types:</p>
<ul class="simple">
<li><tt class="docutils literal">sdist</tt></li>
<li><tt class="docutils literal">bdist_wheel</tt></li>
<li><tt class="docutils literal">bdist_egg</tt></li>
<li><tt class="docutils literal">bdist_wininst</tt></li>
<li><tt class="docutils literal">bdist_msi</tt></li>
<li><tt class="docutils literal">bdist_dmg</tt></li>
<li><tt class="docutils literal">bdist_rpm</tt></li>
<li><tt class="docutils literal">bdist_dumb</tt></li>
</ul>
<p>However, these different types of files have varying amounts of usefulness or
general use in the ecosystem. Continuing to support them adds a maintenance
burden on PyPI as well as tool authors and incurs a cost in both bandwidth and
disk space not only on PyPI itself, but also on any mirrors of PyPI.</p>
<p>Python packaging is a multi-level ecosystem where PyPI is primarily suited and
used to distribute virtual environment compatible packages directly from their
respective project owners. These packages are then consumed either directly
by end-users, or by downstream distributors that take these packages and turn
them into their respective system level packages (such as RPM, deb, MSI, etc).</p>
<p>While PyPI itself only directly works with these Python specific but platform
agnostic packages, we encourage community-driven and commercial conversions of
these packages to downstream formats for particular target environments, like:</p>
<ul class="simple">
<li>The conda cross-platform data analysis ecosystem (conda-forge)</li>
<li>The deb based Linux ecosystem (Debian, Ubuntu, etc)</li>
<li>The RPM based Linux ecosystem (Fedora, openSuSE, Mageia, etc)</li>
<li>The homebrew, MacPorts and fink ecosystems for Mac OS X</li>
<li>The Windows Package Management ecosystem (NuGet, Chocalatey, etc)</li>
<li>3rd party creation of Windows MSIs and installers (e.g. Christoph Gohlke's
work at <a class="reference external" href="http://www.lfd.uci.edu/~gohlke/pythonlibs/">http://www.lfd.uci.edu/~gohlke/pythonlibs/</a> )</li>
<li>other commercial redistribution formats (ActiveState's PyPM, Enthought
Canopy, etc)</li>
<li>other open source community redistribution formats (Nix, Gentoo, Arch, *BSD,
etc)</li>
</ul>
<p>It is the belief of this PEP that the entire ecosystem is best supported by
keeping PyPI focused on the platform agnostic formats, where the limited amount
of time by volunteers can be best used instead of spreading the available time
out amongst several platforms. Further more, this PEP believes that the people
best positioned to provide well integrated packages for a particular platform
are people focused on that platform, and not across all possible platforms.</p>
<div class="section" id="bdist-dumb">
<h3><a class="toc-backref" href="#id5">bdist_dumb</a></h3>
<p>As it's name implies, <tt class="docutils literal">bdist_dumb</tt> is not a very complex format, however it
is so simple as to be worthless for actual usage.</p>
<p>For instance, if you're using something like pyenv on macOS and you're building
a library using Python 3.5, then <tt class="docutils literal">bdist_dumb</tt> will produce a <tt class="docutils literal">.tar.gz</tt> file
named something like <tt class="docutils literal"><span class="pre">exampleproject-1.0.macosx-10.11-x86_64.tar.gz</span></tt>. Right
off the bat this file name is somewhat difficult to differentiate from an
<tt class="docutils literal">sdist</tt> since they both use the same file extension (and with the legacy pre
<a class="reference external" href="/dev/peps/pep-0440">PEP 440</a> versions, <tt class="docutils literal"><span class="pre">1.0-macosx-10.11-x86_64</span></tt> is a valid, although quite silly,
version number). However, once you open up the created <tt class="docutils literal">.tar.gz</tt>, you'd find
that there is no metadata inside that could be used for things like dependency
discovery and in fact, it is quite simply a tarball containing hardcoded paths
to wherever files would have been installed on the computer creating the
<tt class="docutils literal">bdist_dumb</tt>. Going back to our pyenv on macOS example, this means that if I
created it, it would contain files like:</p>
<p><tt class="docutils literal"><span class="pre">Users/dstufft/.pyenv/versions/3.5.2/lib/python3.5/site-packages/example.py</span></tt></p>
</div>
<div class="section" id="bdist-rpm">
<h3><a class="toc-backref" href="#id6">bdist_rpm</a></h3>
<p>The <tt class="docutils literal">bdist_rpm</tt> format on PyPI allows people to upload <tt class="docutils literal">.rpm</tt> files for
end users to manually download by hand and then manually install by hand.
However, the common usage of <tt class="docutils literal">rpm</tt> is with a specially designed repository
that allows automatic installation of dependencies, upgrades, etc which PyPI
does not provide. Thus, it is a type of file that is barely being used on PyPI
with only ~460 files of this type having been uploaded to PyPI (out a total of
662,544).</p>
<p>In addition, services like <a class="reference external" href="https://copr.fedorainfracloud.org/">COPR</a> provide
a better supported mechanism for publishing and using RPM files than we're ever
likely to get on PyPI.</p>
</div>
<div class="section" id="bdist-dmg-bdist-msi-and-bdist-wininst">
<h3><a class="toc-backref" href="#id7">bdist_dmg, bdist_msi, and bdist_wininst</a></h3>
<p>The <tt class="docutils literal">bdist_dmg</tt>, <tt class="docutils literal">bdist_msi</tt>, and <tt class="docutils literal">bdist_winist</tt> formats are similar in
that they are an OS specific installer that will only install a library into an
environment and are not designed for real user facing installs of applications
(which would require things like bundling a Python interpreter and the like).</p>
<p>Out of these three, the usage for <tt class="docutils literal">bdist_dmg</tt> and <tt class="docutils literal">bdist_msi</tt> is very low,
with only ~500 <tt class="docutils literal">bdist_msi</tt> files and ~50 <tt class="docutils literal">bdist_dmg</tt> files having been
uploaded to PyPI. The <tt class="docutils literal">bdist_wininst</tt> format has more use, with ~14,000 files
having ever been uploaded to PyPI.</p>
<p>It's quite easy to look at the low usage of <tt class="docutils literal">bdist_dmg</tt> and <tt class="docutils literal">bdist_msi</tt> and
conclude that removing them will be fairly low impact, however
<tt class="docutils literal">bdist_wininst</tt> has several orders of magnitude more usage. This is somewhat
misleading though, because although it has more people <em>uploading</em> those files
the actual usage of those uploaded files is fairly low. Taking a look at the
previous 30 days, we can see that 90% of all downloads of <tt class="docutils literal">bdist_winist</tt>
files from PyPI were generated by the mirroring infrastructure and 7% of them
were generated by setuptools (which can currently be better covered by
<tt class="docutils literal">bdist_egg</tt> files).</p>
<p>Given the small number of files uploaded for <tt class="docutils literal">bdist_dmg</tt> and <tt class="docutils literal">bdist_msi</tt>
and that <tt class="docutils literal">bdist_wininst</tt> is largely existing to either consume bandwidth and
disk space via the mirroring infrastructure <em>or</em> could be trivially replaced
with <tt class="docutils literal">bdist_egg</tt>, this PEP proposes to include these three formats in the
list of those to be disallowed.</p>
</div>
</div>
<div class="section" id="file-extensions">
<h2><a class="toc-backref" href="#id8">File Extensions</a></h2>
<p>Currently <tt class="docutils literal">sdist</tt> supports a wide variety of file extensions like <tt class="docutils literal">.tar.gz</tt>,
<tt class="docutils literal">.tar</tt>, <tt class="docutils literal">.tar.bz2</tt>, <tt class="docutils literal">.tar.xz</tt>, <tt class="docutils literal">.zip</tt>, <tt class="docutils literal">.tar.Z</tt>, <tt class="docutils literal">.tgz</tt>, and
<tt class="docutils literal">.tbz</tt>. However, of those the only extensions which get anything more than
negligable usage is <tt class="docutils literal">.tar.gz</tt> with 444,338 sdists currently, <tt class="docutils literal">.zip</tt> with
58,774 sdists currently, and <tt class="docutils literal">.tar.bz2</tt> with 3,265 sdists currently.</p>
<p>Having multiple formats accepted requires tooling both within PyPI and outside
of PyPI to handle all of the various extensions that <em>might</em> be used (even if
nobody is currently using them). This doesn't only affect PyPI, but ripples out
throughout the ecosystem. In addition, the different formats all have different
requirements for what optional C libraries Python was linked against and
different requirements for what versions of Python they support. In addition,
multiple formats also create a weird situation where there may be two
<tt class="docutils literal">sdist</tt> files for a particular project/release with subtly different content.</p>
<p>It's easy to advocate that anything outside of <tt class="docutils literal">.tar.gz</tt>, <tt class="docutils literal">.zip</tt>, and
<tt class="docutils literal">.tar.bz2</tt> should be disallowed. Outside of a tiny handful, nobody has
actively been uploading these other types of files in the ~15 years of PyPI's
existence so they've obviously not been particularly useful. In addition, while
<tt class="docutils literal">.tar.xz</tt> is theoretically a nicer format than the other <tt class="docutils literal">.tar.*</tt> formats
due to the better compression ratio achieved by LZMA, it is only available in
Python 3.3+ and has an optional dependency on the lzma C library.</p>
<p>Looking at the three extensions we <em>do</em> have in current use, it's also fairly
easy to conclude that <tt class="docutils literal">.tar.bz2</tt> can be disallowed as well. It has a fairly
small number of files ever uploaded with it and it requires an additional
optional C library to handle the bzip2 compression.</p>
<p>Finally we get down to <tt class="docutils literal">.tar.gz</tt> and <tt class="docutils literal">.zip</tt>. Looking at the pure numbers
for these two, we can see that <tt class="docutils literal">.tar.gz</tt> is by far the most uploaded format,
with 444,338 total uploaded compared to <tt class="docutils literal">.zip</tt>'s 58,774 and on POSIX
operating systems <tt class="docutils literal">.tar.gz</tt> is also the default produced by all currently
released versions of Python and setuptools. In addition, these two file types
both use the same C library (<tt class="docutils literal">zlib</tt>) which is also required for
<tt class="docutils literal">bdist_wheel</tt> and <tt class="docutils literal">bdist_egg</tt>. The two wrinkles with deciding between
<tt class="docutils literal">.tar.gz</tt> and <tt class="docutils literal">.zip</tt> is that while on POSIX operating systems <tt class="docutils literal">.tar.gz</tt>
is the default, on Windows <tt class="docutils literal">.zip</tt> is the default and the <tt class="docutils literal">bdist_wheel</tt>
format also uses zip.</p>
<p>Instead of trying to standardize on either <tt class="docutils literal">.tar.gz</tt> or <tt class="docutils literal">.zip</tt>, this PEP
proposes that we allow <em>either</em> <tt class="docutils literal">.tar.gz</tt> or <tt class="docutils literal">.zip</tt> for sdists.</p>
</div>
<div class="section" id="limiting-number-of-sdists-per-release">
<h2><a class="toc-backref" href="#id9">Limiting number of sdists per release</a></h2>
<p>A sdist on PyPI should be a single source of truth for a particular release of
software. However, currently PyPI allows you to upload one sdist for each of
the sdist file extensions it allows. Currently this allows something like 10
different sdists for a project, but even with this PEP it allows two different
sources of truth for a single version. Having multiple sdists often times can
account for strange bugs that only expose themselves based on which sdist that
the person used.</p>
<p>To resolve this, this PEP proposes to allow one, and only one, sdist per
release of a project.</p>
</div>
</div>
<div class="section" id="removal-process">
<h1><a class="toc-backref" href="#id10">Removal Process</a></h1>
<p>This PEP does <strong>NOT</strong> propose removing any existing files from PyPI, only
disallowing new ones from being uploaded. This restriction will be phased in on
a per-project basis to allow projects to adjust to the new restrictions where
applicable.</p>
<p>First, any <em>existing</em> projects will be flagged to allow legacy file types to be
uploaded, and any project without that flag (i.e. new projects) will not be
able to upload anything but <tt class="docutils literal">sdist</tt> with a <tt class="docutils literal">.tar.gz</tt> or <tt class="docutils literal">.zip</tt> extension,
<tt class="docutils literal">bdist_wheel</tt>, and <tt class="docutils literal">bdist_egg</tt>. Then, any existing projects that have never
uploaded a file that requires the legacy file type flag will have that flag
removed, also making them fall under the new restrictions. Finally, an email
will be generated to the maintainers of all projects still given the legacy
flag, which will inform them of the upcoming new restrictions on uploads and
tell them that these restrictions will be applied to future uploads to their
projects starting in 1 month. Finally, after 1 month all projects will have the
legacy file type flag removed, and support for uploading these types of files
will cease to exist on PyPI.</p>
<p>This plan should provide minimal disruption since it does not remove any
existing files, and the types of files it does prevent from being uploaded are
either not particularly useful (or used) types of files <em>or</em> they can continue
to upload a similar type of file with a slight change to their process.</p>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id11">Copyright</a></h1>
<p>This document has been placed in the public domain.</p>
<!-- Local Variables:
mode: indented-text
indent-tabs-mode: nil
sentence-end-double-space: t
fill-column: 70
coding: utf-8
End: -->
</div>

