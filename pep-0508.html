<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">PEP:</th><td class="field-body">508</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">Dependency specification for Python Software Packages</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">$Revision$</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference external" href="https://hg.python.org/peps/file/tip/pep-0508.txt">$Date$</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">Robert Collins &lt;rbtcollins&#32;&#97;t&#32;hp.com&gt;</td>
</tr>
<tr class="field"><th class="field-name">BDFL-Delegate:</th><td class="field-body">Donald Stufft &lt;donald&#32;&#97;t&#32;stufft.io&gt;</td>
</tr>
<tr class="field"><th class="field-name">Discussions-To:</th><td class="field-body">distutils-sig &lt;<a class="reference external" href="mailto:distutils-sig&#64;python.org?subject=PEP%20508">distutils-sig&#32;&#97;t&#32;python.org</a>&gt;</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Active</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Informational</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference external" href="/dev/peps/pep-0012">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">11-Nov-2015</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body">05-Nov-2015, 16-Nov-2015</td>
</tr>
<tr class="field"><th class="field-name">Resolution:</th><td class="field-body"><a class="reference external" href="https://mail.python.org/pipermail/distutils-sig/2015-November/027868.html">https://mail.python.org/pipermail/distutils-sig/2015-November/027868.html</a></td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#abstract" id="id13">Abstract</a></li>
<li><a class="reference internal" href="#motivation" id="id14">Motivation</a></li>
<li><a class="reference internal" href="#specification" id="id15">Specification</a><ul>
<li><a class="reference internal" href="#examples" id="id16">Examples</a></li>
<li><a class="reference internal" href="#concepts" id="id17">Concepts</a></li>
<li><a class="reference internal" href="#grammar" id="id18">Grammar</a></li>
<li><a class="reference internal" href="#whitespace" id="id19">Whitespace</a></li>
<li><a class="reference internal" href="#names" id="id20">Names</a></li>
<li><a class="reference internal" href="#extras" id="id21">Extras</a></li>
<li><a class="reference internal" href="#versions" id="id22">Versions</a></li>
<li><a class="reference internal" href="#environment-markers" id="id23">Environment Markers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#backwards-compatibility" id="id24">Backwards Compatibility</a></li>
<li><a class="reference internal" href="#rationale" id="id25">Rationale</a></li>
<li><a class="reference internal" href="#complete-grammar" id="id26">Complete Grammar</a></li>
<li><a class="reference internal" href="#references" id="id27">References</a></li>
<li><a class="reference internal" href="#copyright" id="id28">Copyright</a></li>
</ul>
</div>
<div class="section" id="abstract">
<h1><a class="toc-backref" href="#id13">Abstract</a></h1>
<p>This PEP specifies the language used to describe dependencies for packages.
It draws a border at the edge of describing a single dependency - the
different sorts of dependencies and when they should be installed is a higher
level problem. The intent is to provide a building block for higher layer
specifications.</p>
<p>The job of a dependency is to enable tools like pip <a class="footnote-reference" href="#pip" id="id1">[1]</a> to find the right
package to install. Sometimes this is very loose - just specifying a name, and
sometimes very specific - referring to a specific file to install. Sometimes
dependencies are only relevant in one platform, or only some versions are
acceptable, so the language permits describing all these cases.</p>
<p>The language defined is a compact line based format which is already in
widespread use in pip requirements files, though we do not specify the command
line option handling that those files permit. There is one caveat - the
URL reference form, specified in PEP-440 <a class="footnote-reference" href="#pep440" id="id2">[4]</a> is not actually
implemented in pip, but since PEP-440 is accepted, we use that format rather
than pip's current native format.</p>
</div>
<div class="section" id="motivation">
<h1><a class="toc-backref" href="#id14">Motivation</a></h1>
<p>Any specification in the Python packaging ecosystem that needs to consume
lists of dependencies needs to build on an approved PEP for such, but
PEP-426 <a class="footnote-reference" href="#pep426" id="id3">[3]</a> is mostly aspirational - and there are already existing
implementations of the dependency specification which we can instead adopt.
The existing implementations are battle proven and user friendly, so adopting
them is arguably much better than approving an aspirational, unconsumed, format.</p>
</div>
<div class="section" id="specification">
<h1><a class="toc-backref" href="#id15">Specification</a></h1>
<div class="section" id="examples">
<h2><a class="toc-backref" href="#id16">Examples</a></h2>
<p>All features of the language shown with a name based lookup:</p>
<pre class="literal-block">
requests [security,tests] &gt;= 2.8.1, == 2.8.* ; python_version &lt; &quot;2.7&quot;
</pre>
<p>A minimal URL based lookup:</p>
<pre class="literal-block">
pip &#64; https://github.com/pypa/pip/archive/1.3.1.zip#sha1=da9234ee9982d4bbb3c72346a6de940a148ea686
</pre>
</div>
<div class="section" id="concepts">
<h2><a class="toc-backref" href="#id17">Concepts</a></h2>
<p>A dependency specification always specifies a distribution name. It may
include extras, which expand the dependencies of the named distribution to
enable optional features. The version installed can be controlled using
version limits, or giving the URL to a specific artifact to install. Finally
the dependency can be made conditional using environment markers.</p>
</div>
<div class="section" id="grammar">
<h2><a class="toc-backref" href="#id18">Grammar</a></h2>
<p>We first cover the grammar briefly and then drill into the semantics of each
section later.</p>
<p>A distribution specification is written in ASCII text. We use a parsley
<a class="footnote-reference" href="#parsley" id="id4">[6]</a> grammar to provide a precise grammar. It is expected that the
specification will be embedded into a larger system which offers framing such
as comments, multiple line support via continuations, or other such features.</p>
<p>The full grammar including annotations to build a useful parse tree is
included at the end of the PEP.</p>
<p>Versions may be specified according to the PEP-440 <a class="footnote-reference" href="#pep440" id="id5">[4]</a> rules. (Note:
URI is defined in std-66 <a class="footnote-reference" href="#std66" id="id6">[5]</a>):</p>
<pre class="literal-block">
version_cmp   = wsp* '&lt;' | '&lt;=' | '!=' | '==' | '&gt;=' | '&gt;' | '~=' | '==='
version       = wsp* ( letterOrDigit | '-' | '_' | '.' | '*' | '+' | '!' )+
version_one   = version_cmp version wsp*
version_many  = version_one (wsp* ',' version_one)*
versionspec   = ( '(' version_many ')' ) | version_many
urlspec       = '&#64;' wsp* &lt;URI_reference&gt;
</pre>
<p>Environment markers allow making a specification only take effect in some
environments:</p>
<pre class="literal-block">
marker_op     = version_cmp | (wsp* 'in') | (wsp* 'not' wsp+ 'in')
python_str_c  = (wsp | letter | digit | '(' | ')' | '.' | '{' | '}' |
                 '-' | '_' | '*' | '#' | ':' | ';' | ',' | '/' | '?' |
                 '[' | ']' | '!' | '~' | '`' | '&#64;' | '$' | '%' | '^' |
                 '&amp;' | '=' | '+' | '|' | '&lt;' | '&gt;' )
dquote        = '&quot;'
squote        = '\\''
python_str    = (squote (python_str_c | dquote)* squote |
                 dquote (python_str_c | squote)* dquote)
env_var       = ('python_version' | 'python_full_version' |
                 'os_name' | 'sys_platform' | 'platform_release' |
                 'platform_system' | 'platform_version' |
                 'platform_machine' | 'platform_python_implementation' |
                 'implementation_name' | 'implementation_version' |
                 'extra' # ONLY when defined by a containing layer
                 )
marker_var    = wsp* (env_var | python_str)
marker_expr   = marker_var marker_op marker_var
              | wsp* '(' marker wsp* ')'
marker_and    = marker_expr wsp* 'and' marker_expr
              | marker_expr
marker_or     = marker_and wsp* 'or' marker_and
                  | marker_and
marker        = marker_or
quoted_marker = ';' wsp* marker
</pre>
<p>Optional components of a distribution may be specified using the extras
field:</p>
<pre class="literal-block">
identifer_end = letterOrDigit | (('-' | '_' | '.' )* letterOrDigit)
identifier    = letterOrDigit identifier_end*
name          = identifier
extras_list   = identifier (wsp* ',' wsp* identifier)*
extras        = '[' wsp* extras_list? wsp* ']'
</pre>
<p>Giving us a rule for name based requirements:</p>
<pre class="literal-block">
name_req      = name wsp* extras? wsp* versionspec? wsp* quoted_marker?
</pre>
<p>And a rule for direct reference specifications:</p>
<pre class="literal-block">
url_req       = name wsp* extras? wsp* urlspec wsp+ quoted_marker?
</pre>
<p>Leading to the unified rule that can specify a dependency.:</p>
<pre class="literal-block">
specification = wsp* ( url_req | name_req ) wsp*
</pre>
</div>
<div class="section" id="whitespace">
<h2><a class="toc-backref" href="#id19">Whitespace</a></h2>
<p>Non line-breaking whitespace is mostly optional with no semantic meaning. The
sole exception is detecting the end of a URL requirement.</p>
</div>
<div class="section" id="names">
<h2><a class="toc-backref" href="#id20">Names</a></h2>
<p>Python distribution names are currently defined in PEP-345 <a class="footnote-reference" href="#pep345" id="id7">[2]</a>. Names
act as the primary identifier for distributions. They are present in all
dependency specifications, and are sufficient to be a specification on their
own. However, PyPI places strict restrictions on names - they must match a
case insensitive regex or they won't be accepted. Accordingly, in this PEP we
limit the acceptable values for identifiers to that regex. A full redefinition
of name may take place in a future metadata PEP. The regex (run with
re.IGNORECASE) is:</p>
<pre class="literal-block">
^([A-Z0-9]|[A-Z0-9][A-Z0-9._-]*[A-Z0-9])$
</pre>
</div>
<div class="section" id="extras">
<h2><a class="toc-backref" href="#id21">Extras</a></h2>
<p>An extra is an optional part of a distribution. Distributions can specify as
many extras as they wish, and each extra results in the declaration of
additional dependencies of the distribution <strong>when</strong> the extra is used in a
dependency specification. For instance:</p>
<pre class="literal-block">
requests[security]
</pre>
<p>Extras union in the dependencies they define with the dependencies of the
distribution they are attached to. The example above would result in requests
being installed, and requests own dependencies, and also any dependencies that
are listed in the &quot;security&quot; extra of requests.</p>
<p>If multiple extras are listed, all the dependencies are unioned together.</p>
</div>
<div class="section" id="versions">
<h2><a class="toc-backref" href="#id22">Versions</a></h2>
<p>See PEP-440 <a class="footnote-reference" href="#pep440" id="id8">[4]</a> for more detail on both version numbers and version
comparisons. Version specifications limit the versions of a distribution that
can be used. They only apply to distributions looked up by name, rather than
via a URL. Version comparison are also used in the markers feature. The
optional brackets around a version are present for compatibility with PEP-345
<a class="footnote-reference" href="#pep345" id="id9">[2]</a> but should not be generated, only accepted.</p>
</div>
<div class="section" id="environment-markers">
<h2><a class="toc-backref" href="#id23">Environment Markers</a></h2>
<p>Environment markers allow a dependency specification to provide a rule that
describes when the dependency should be used. For instance, consider a package
that needs argparse. In Python 2.7 argparse is always present. On older Python
versions it has to be installed as a dependency. This can be expressed as so:</p>
<pre class="literal-block">
argparse;python_version&lt;&quot;2.7&quot;
</pre>
<p>A marker expression evaluates to either True or False. When it evaluates to
False, the dependency specification should be ignored.</p>
<p>The marker language is inspired by Python itself, chosen for the ability to
safely evaluate it without running arbitrary code that could become a security
vulnerability. Markers were first standardised in PEP-345 <a class="footnote-reference" href="#pep345" id="id10">[2]</a>. This PEP
fixes some issues that were observed in the design described in PEP-426
<a class="footnote-reference" href="#pep426" id="id11">[3]</a>.</p>
<p>Comparisons in marker expressions are typed by the comparison operator.  The
&lt;marker_op&gt; operators that are not in &lt;version_cmp&gt; perform the same as they
do for strings in Python. The &lt;version_cmp&gt; operators use the PEP-440
<a class="footnote-reference" href="#pep440" id="id12">[4]</a> version comparison rules when those are defined (that is when both
sides have a valid version specifier). If there is no defined PEP-440
behaviour and the operator exists in Python, then the operator falls back to
the Python behaviour. Otherwise an error should be raised. e.g. the following
will result in  errors:</p>
<pre class="literal-block">
&quot;dog&quot; ~= &quot;fred&quot;
python_version ~= &quot;surprise&quot;
</pre>
<p>User supplied constants are always encoded as strings with either <tt class="docutils literal">'</tt> or
<tt class="docutils literal">&quot;</tt> quote marks. Note that backslash escapes are not defined, but existing
implementations do support them. They are not included in this
specification because they add complexity and there is no observable need for
them today. Similarly we do not define non-ASCII character support: all the
runtime variables we are referencing are expected to be ASCII-only.</p>
<p>The variables in the marker grammar such as &quot;os_name&quot; resolve to values looked
up in the Python runtime. With the exception of &quot;extra&quot; all values are defined
on all Python versions today - it is an error in the implementation of markers
if a value is not defined.</p>
<p>Unknown variables must raise an error rather than resulting in a comparison
that evaluates to True or False.</p>
<p>Variables whose value cannot be calculated on a given Python implementation
should evaluate to <tt class="docutils literal">0</tt> for versions, and an empty string for all other
variables.</p>
<p>The &quot;extra&quot; variable is special. It is used by wheels to signal which
specifications apply to a given extra in the wheel <tt class="docutils literal">METADATA</tt> file, but
since the <tt class="docutils literal">METADATA</tt> file is based on a draft version of PEP-426, there is
no current specification for this. Regardless, outside of a context where this
special handling is taking place, the &quot;extra&quot; variable should result in an
error like all other unknown variables.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Marker</th>
<th class="head">Python equivalent</th>
<th class="head">Sample values</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><tt class="docutils literal">os_name</tt></td>
<td><tt class="docutils literal">os.name</tt></td>
<td><tt class="docutils literal">posix</tt>, <tt class="docutils literal">java</tt></td>
</tr>
<tr><td><tt class="docutils literal">sys_platform</tt></td>
<td><tt class="docutils literal">sys.platform</tt></td>
<td><tt class="docutils literal">linux</tt>, <tt class="docutils literal">linux2</tt>, <tt class="docutils literal">darwin</tt>, <tt class="docutils literal">java1.8.0_51</tt> (note that &quot;linux&quot;
is from Python3 and &quot;linux2&quot; from Python2)</td>
</tr>
<tr><td><tt class="docutils literal">platform_machine</tt></td>
<td><tt class="docutils literal">platform.machine()</tt></td>
<td><tt class="docutils literal">x86_64</tt></td>
</tr>
<tr><td><tt class="docutils literal">platform_python_implementation</tt></td>
<td><tt class="docutils literal">platform.python_implementation()</tt></td>
<td><tt class="docutils literal">CPython</tt>, <tt class="docutils literal">Jython</tt></td>
</tr>
<tr><td><tt class="docutils literal">platform_release</tt></td>
<td><tt class="docutils literal">platform.release()</tt></td>
<td><tt class="docutils literal"><span class="pre">3.14.1-x86_64-linode39</span></tt>, <tt class="docutils literal">14.5.0</tt>, <tt class="docutils literal">1.8.0_51</tt></td>
</tr>
<tr><td><tt class="docutils literal">platform_system</tt></td>
<td><tt class="docutils literal">platform.system()</tt></td>
<td><tt class="docutils literal">Linux</tt>, <tt class="docutils literal">Windows</tt>, <tt class="docutils literal">Java</tt></td>
</tr>
<tr><td><tt class="docutils literal">platform_version</tt></td>
<td><tt class="docutils literal">platform.version()</tt></td>
<td><tt class="docutils literal">#1 SMP Fri Apr 25 13:07:35 EDT 2014</tt>
<tt class="docutils literal">Java HotSpot(TM) <span class="pre">64-Bit</span> Server VM, <span class="pre">25.51-b03,</span> Oracle Corporation</tt>
<tt class="docutils literal">Darwin Kernel Version 14.5.0: Wed Jul 29 02:18:53 PDT 2015; <span class="pre">root:xnu-2782.40.9~2/RELEASE_X86_64</span></tt></td>
</tr>
<tr><td><tt class="docutils literal">python_version</tt></td>
<td><tt class="docutils literal"><span class="pre">platform.python_version()[:3]</span></tt></td>
<td><tt class="docutils literal">3.4</tt>, <tt class="docutils literal">2.7</tt></td>
</tr>
<tr><td><tt class="docutils literal">python_full_version</tt></td>
<td><tt class="docutils literal">platform.python_version()</tt></td>
<td><tt class="docutils literal">3.4.0</tt>, <tt class="docutils literal">3.5.0b1</tt></td>
</tr>
<tr><td><tt class="docutils literal">implementation_name</tt></td>
<td><tt class="docutils literal">sys.implementation.name</tt></td>
<td><tt class="docutils literal">cpython</tt></td>
</tr>
<tr><td><tt class="docutils literal">implementation_version</tt></td>
<td>see definition below</td>
<td><tt class="docutils literal">3.4.0</tt>, <tt class="docutils literal">3.5.0b1</tt></td>
</tr>
<tr><td><tt class="docutils literal">extra</tt></td>
<td>An error except when defined by the context interpreting the
specification.</td>
<td><tt class="docutils literal">test</tt></td>
</tr>
</tbody>
</table>
<p>The <tt class="docutils literal">implementation_version</tt> marker variable is derived from
<tt class="docutils literal">sys.implementation.version</tt>:</p>
<pre class="literal-block">
def format_full_version(info):
    version = '{0.major}.{0.minor}.{0.micro}'.format(info)
    kind = info.releaselevel
    if kind != 'final':
        version += kind[0] + str(info.serial)
    return version

if hasattr(sys, 'implementation'):
    implementation_version = format_full_version(sys.implementation.version)
else:
    implementation_version = &quot;0&quot;
</pre>
</div>
</div>
<div class="section" id="backwards-compatibility">
<h1><a class="toc-backref" href="#id24">Backwards Compatibility</a></h1>
<p>Most of this PEP is already widely deployed and thus offers no compatibility
concerns.</p>
<p>There are however a few points where the PEP differs from the deployed base.</p>
<p>Firstly, PEP-440 direct references haven't actually been deployed in the wild,
but they were designed to be compatibly added, and there are no known
obstacles to adding them to pip or other tools that consume the existing
dependency metadata in distributions - particularly since they won't be
permitted to be present in PyPI uploaded distributions anyway.</p>
<p>Secondly, PEP-426 markers which have had some reasonable deployment,
particularly in wheels and pip, will handle version comparisons with
<tt class="docutils literal">python_full_version</tt> &quot;2.7.10&quot; differently. Specifically in 426 &quot;2.7.10&quot; is
less than &quot;2.7.9&quot;. This backward incompatibility is deliberate. We are also
defining new operators - &quot;~=&quot; and &quot;===&quot;, and new variables -
<tt class="docutils literal">platform_release</tt>, <tt class="docutils literal">platform_system</tt>, <tt class="docutils literal">implementation_name</tt>, and
<tt class="docutils literal">implementation_version</tt> which are not present in older marker
implementations. The variables will error on those implementations. Users of
both features will need to make a judgement as to when support has become
sufficiently widespread in the ecosystem that using them will not cause
compatibility issues.</p>
<p>Thirdly, PEP-345 required brackets around version specifiers. In order to
accept PEP-345 dependency specifications, brackets are accepted, but they
should not be generated.</p>
</div>
<div class="section" id="rationale">
<h1><a class="toc-backref" href="#id25">Rationale</a></h1>
<p>In order to move forward with any new PEPs that depend on environment markers,
we needed a specification that included them in their modern form. This PEP
brings together all the currently unspecified components into a specified
form.</p>
<p>The requirement specifier was adopted from the EBNF in the setuptools
pkg_resources documentation, since we wish to avoid depending on a de facto, vs
PEP specified, standard.</p>
</div>
<div class="section" id="complete-grammar">
<h1><a class="toc-backref" href="#id26">Complete Grammar</a></h1>
<p>The complete parsley grammar:</p>
<pre class="literal-block">
wsp           = ' ' | '\t'
version_cmp   = wsp* &lt;'&lt;=' | '&lt;' | '!=' | '==' | '&gt;=' | '&gt;' | '~=' | '==='&gt;
version       = wsp* &lt;( letterOrDigit | '-' | '_' | '.' | '*' | '+' | '!' )+&gt;
version_one   = version_cmp:op version:v wsp* -&gt; (op, v)
version_many  = version_one:v1 (wsp* ',' version_one)*:v2 -&gt; [v1] + v2
versionspec   = ('(' version_many:v ')' -&gt;v) | version_many
urlspec       = '&#64;' wsp* &lt;URI_reference&gt;
marker_op     = version_cmp | (wsp* 'in') | (wsp* 'not' wsp+ 'in')
python_str_c  = (wsp | letter | digit | '(' | ')' | '.' | '{' | '}' |
                 '-' | '_' | '*' | '#' | ':' | ';' | ',' | '/' | '?' |
                 '[' | ']' | '!' | '~' | '`' | '&#64;' | '$' | '%' | '^' |
                 '&amp;' | '=' | '+' | '|' | '&lt;' | '&gt;' )
dquote        = '&quot;'
squote        = '\\''
python_str    = (squote &lt;(python_str_c | dquote)*&gt;:s squote |
                 dquote &lt;(python_str_c | squote)*&gt;:s dquote) -&gt; s
env_var       = ('python_version' | 'python_full_version' |
                 'os_name' | 'sys_platform' | 'platform_release' |
                 'platform_system' | 'platform_version' |
                 'platform_machine' | 'platform_python_implementation' |
                 'implementation_name' | 'implementation_version' |
                 'extra' # ONLY when defined by a containing layer
                 ):varname -&gt; lookup(varname)
marker_var    = wsp* (env_var | python_str)
marker_expr   = marker_var:l marker_op:o marker_var:r -&gt; (o, l, r)
              | wsp* '(' marker:m wsp* ')' -&gt; m
marker_and    = marker_expr:l wsp* 'and' marker_expr:r -&gt; ('and', l, r)
              | marker_expr:m -&gt; m
marker_or     = marker_and:l wsp* 'or' marker_and:r -&gt; ('or', l, r)
                  | marker_and:m -&gt; m
marker        = marker_or
quoted_marker = ';' wsp* marker
identifer_end = letterOrDigit | (('-' | '_' | '.' )* letterOrDigit)
identifier    = &lt; letterOrDigit identifier_end* &gt;
name          = identifier
extras_list   = identifier:i (wsp* ',' wsp* identifier)*:ids -&gt; [i] + ids
extras        = '[' wsp* extras_list?:e wsp* ']' -&gt; e
name_req      = (name:n wsp* extras?:e wsp* versionspec?:v wsp* quoted_marker?:m
                 -&gt; (n, e or [], v or [], m))
url_req       = (name:n wsp* extras?:e wsp* urlspec:v (wsp+ | end) quoted_marker?:m
                 -&gt; (n, e or [], v, m))
specification = wsp* ( url_req | name_req ):s wsp* -&gt; s
# The result is a tuple - name, list-of-extras,
# list-of-version-constraints-or-a-url, marker-ast or None


URI_reference = &lt;URI | relative_ref&gt;
URI           = scheme ':' hier_part ('?' query )? ( '#' fragment)?
hier_part     = ('//' authority path_abempty) | path_absolute | path_rootless | path_empty
absolute_URI  = scheme ':' hier_part ( '?' query )?
relative_ref  = relative_part ( '?' query )? ( '#' fragment )?
relative_part = '//' authority path_abempty | path_absolute | path_noscheme | path_empty
scheme        = letter ( letter | digit | '+' | '-' | '.')*
authority     = ( userinfo '&#64;' )? host ( ':' port )?
userinfo      = ( unreserved | pct_encoded | sub_delims | ':')*
host          = IP_literal | IPv4address | reg_name
port          = digit*
IP_literal    = '[' ( IPv6address | IPvFuture) ']'
IPvFuture     = 'v' hexdig+ '.' ( unreserved | sub_delims | ':')+
IPv6address   = (
                  ( h16 ':'){6} ls32
                  | '::' ( h16 ':'){5} ls32
                  | ( h16 )?  '::' ( h16 ':'){4} ls32
                  | ( ( h16 ':')? h16 )? '::' ( h16 ':'){3} ls32
                  | ( ( h16 ':'){0,2} h16 )? '::' ( h16 ':'){2} ls32
                  | ( ( h16 ':'){0,3} h16 )? '::' h16 ':' ls32
                  | ( ( h16 ':'){0,4} h16 )? '::' ls32
                  | ( ( h16 ':'){0,5} h16 )? '::' h16
                  | ( ( h16 ':'){0,6} h16 )? '::' )
h16           = hexdig{1,4}
ls32          = ( h16 ':' h16) | IPv4address
IPv4address   = dec_octet '.' dec_octet '.' dec_octet '.' dec_octet
nz            = ~'0' digit
dec_octet     = (
                  digit # 0-9
                  | nz digit # 10-99
                  | '1' digit{2} # 100-199
                  | '2' ('0' | '1' | '2' | '3' | '4') digit # 200-249
                  | '25' ('0' | '1' | '2' | '3' | '4' | '5') )# %250-255
reg_name = ( unreserved | pct_encoded | sub_delims)*
path = (
        path_abempty # begins with '/' or is empty
        | path_absolute # begins with '/' but not '//'
        | path_noscheme # begins with a non-colon segment
        | path_rootless # begins with a segment
        | path_empty ) # zero characters
path_abempty  = ( '/' segment)*
path_absolute = '/' ( segment_nz ( '/' segment)* )?
path_noscheme = segment_nz_nc ( '/' segment)*
path_rootless = segment_nz ( '/' segment)*
path_empty    = pchar{0}
segment       = pchar*
segment_nz    = pchar+
segment_nz_nc = ( unreserved | pct_encoded | sub_delims | '&#64;')+
                # non-zero-length segment without any colon ':'
pchar         = unreserved | pct_encoded | sub_delims | ':' | '&#64;'
query         = ( pchar | '/' | '?')*
fragment      = ( pchar | '/' | '?')*
pct_encoded   = '%' hexdig
unreserved    = letter | digit | '-' | '.' | '_' | '~'
reserved      = gen_delims | sub_delims
gen_delims    = ':' | '/' | '?' | '#' | '(' | ')?' | '&#64;'
sub_delims    = '!' | '$' | '&amp;' | '\\'' | '(' | ')' | '*' | '+' | ',' | ';' | '='
hexdig        = digit | 'a' | 'A' | 'b' | 'B' | 'c' | 'C' | 'd' | 'D' | 'e' | 'E' | 'f' | 'F'
</pre>
<p>A test program - if the grammar is in a string <tt class="docutils literal">grammar</tt>:</p>
<pre class="literal-block">
import os
import sys
import platform

from parsley import makeGrammar

grammar = &quot;&quot;&quot;
    wsp ...
    &quot;&quot;&quot;
tests = [
    &quot;A&quot;,
    &quot;A.B-C_D&quot;,
    &quot;aa&quot;,
    &quot;name&quot;,
    &quot;name&lt;=1&quot;
    &quot;name&gt;=3&quot;,
    &quot;name&gt;=3,&lt;2&quot;,
    &quot;name&#64;http://foo.com&quot;,
    &quot;name [fred,bar] &#64; http://foo.com ; python_version=='2.7'&quot;,
    &quot;name[quux, strange];python_version&lt;'2.7' and platform_version=='2'&quot;,
    &quot;name; os_name=='a' or os_name=='b'&quot;,
    # Should parse as (a and b) or c
    &quot;name; os_name=='a' and os_name=='b' or os_name=='c'&quot;,
    # Overriding precedence -&gt; a and (b or c)
    &quot;name; os_name=='a' and (os_name=='b' or os_name=='c')&quot;,
    # should parse as a or (b and c)
    &quot;name; os_name=='a' or os_name=='b' and os_name=='c'&quot;,
    # Overriding precedence -&gt; (a or b) and c
    &quot;name; (os_name=='a' or os_name=='b') and os_name=='c'&quot;,
    ]

def format_full_version(info):
    version = '{0.major}.{0.minor}.{0.micro}'.format(info)
    kind = info.releaselevel
    if kind != 'final':
        version += kind[0] + str(info.serial)
    return version

if hasattr(sys, 'implementation'):
    implementation_version = format_full_version(sys.implementation.version)
    implementation_name = sys.implementation.name
else:
    implementation_version = '0'
    implementation_name = ''
bindings = {
    'implementation_name': implementation_name,
    'implementation_version': implementation_version,
    'os_name': os.name,
    'platform_machine': platform.machine(),
    'platform_python_implementation': platform.python_implementation(),
    'platform_release': platform.release(),
    'platform_system': platform.system(),
    'platform_version': platform.version(),
    'python_full_version': platform.python_version(),
    'python_version': platform.python_version()[:3],
    'sys_platform': sys.platform,
}

compiled = makeGrammar(grammar, {'lookup': bindings.__getitem__})
for test in tests:
    parsed = compiled(test).specification()
    print(&quot;%s -&gt; %s&quot; % (test, parsed))
</pre>
</div>
<div class="section" id="references">
<h1><a class="toc-backref" href="#id27">References</a></h1>
<table class="docutils footnote" frame="void" id="pip" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>pip, the recommended installer for Python packages
(<a class="reference external" href="http://pip.readthedocs.org/en/stable/">http://pip.readthedocs.org/en/stable/</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="pep345" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[2]</td><td><em>(<a class="fn-backref" href="#id7">1</a>, <a class="fn-backref" href="#id9">2</a>, <a class="fn-backref" href="#id10">3</a>)</em> PEP-345, Python distribution metadata version 1.2.
(<a class="reference external" href="https://www.python.org/dev/peps/pep-0345/">https://www.python.org/dev/peps/pep-0345/</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="pep426" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[3]</td><td><em>(<a class="fn-backref" href="#id3">1</a>, <a class="fn-backref" href="#id11">2</a>)</em> PEP-426, Python distribution metadata.
(<a class="reference external" href="https://www.python.org/dev/peps/pep-0426/">https://www.python.org/dev/peps/pep-0426/</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="pep440" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[4]</td><td><em>(<a class="fn-backref" href="#id2">1</a>, <a class="fn-backref" href="#id5">2</a>, <a class="fn-backref" href="#id8">3</a>, <a class="fn-backref" href="#id12">4</a>)</em> PEP-440, Python distribution metadata.
(<a class="reference external" href="https://www.python.org/dev/peps/pep-0440/">https://www.python.org/dev/peps/pep-0440/</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="std66" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[5]</a></td><td>The URL specification.
(<a class="reference external" href="https://tools.ietf.org/html/rfc3986">https://tools.ietf.org/html/rfc3986</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="parsley" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[6]</a></td><td>The parsley PEG library.
(<a class="reference external" href="https://pypi.python.org/pypi/parsley/">https://pypi.python.org/pypi/parsley/</a>)</td></tr>
</tbody>
</table>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id28">Copyright</a></h1>
<p>This document has been placed in the public domain.</p>
<!-- Local Variables:
mode: indented-text
indent-tabs-mode: nil
sentence-end-double-space: t
fill-column: 70
coding: utf-8
End: -->
</div>

