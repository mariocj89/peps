<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">PEP:</th><td class="field-body">102</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">Doing Python Micro Releases</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">$Revision$</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference external" href="https://hg.python.org/peps/file/tip/pep-0102.txt">$Date$</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">anthony&#32;&#97;t&#32;interlink.com.au (Anthony Baxter),
barry&#32;&#97;t&#32;python.org (Barry Warsaw),
guido&#32;&#97;t&#32;python.org (Guido van Rossum)</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Superseded</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Informational</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference external" href="/dev/peps/pep-0012">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">22-Aug-2001 (edited down on 9-Jan-2002 to become <a class="reference external" href="/dev/peps/pep-0102">PEP 102</a>)</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body"></td>
</tr>
<tr class="field"><th class="field-name">Superseded-By:</th><td class="field-body">101</td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#replacement-note" id="id2">Replacement Note</a></li>
<li><a class="reference internal" href="#abstract" id="id3">Abstract</a></li>
<li><a class="reference internal" href="#how-to-make-a-release" id="id4">How to Make A Release</a></li>
<li><a class="reference internal" href="#what-next" id="id5">What Next?</a></li>
<li><a class="reference internal" href="#final-release-notes" id="id6">Final Release Notes</a></li>
<li><a class="reference internal" href="#windows-notes" id="id7">Windows Notes</a></li>
<li><a class="reference internal" href="#copyright" id="id8">Copyright</a></li>
</ul>
</div>
<div class="section" id="replacement-note">
<h1><a class="toc-backref" href="#id2">Replacement Note</a></h1>
<p>Although the size of the to-do list in this PEP is much less scary
than that in <a class="reference external" href="/dev/peps/pep-0101">PEP 101</a>, it turns out not to be enough justification
for the duplication of information, and with it, the danger of one
of the copies to become out of date.  Therefore, this PEP is not
maintained anymore, and micro releases are fully covered by <a class="reference external" href="/dev/peps/pep-0101">PEP 101</a>.</p>
</div>
<div class="section" id="abstract">
<h1><a class="toc-backref" href="#id3">Abstract</a></h1>
<p>Making a Python release is an arduous process that takes a
minimum of half a day's work even for an experienced releaser.
Until recently, most -- if not all -- of that burden was borne by
Guido himself.  But several recent releases have been performed by
other folks, so this PEP attempts to collect, in one place, all
the steps needed to make a Python bugfix release.</p>
<p>The major Python release process is covered in <a class="reference external" href="/dev/peps/pep-0101">PEP 101</a> - this PEP
is just <a class="reference external" href="/dev/peps/pep-0101">PEP 101</a>, trimmed down to only include the bits that are
relevant for micro releases, a.k.a. patch, or bug fix releases.</p>
<p>It is organized as a recipe and you can actually print this out and
check items off as you complete them.</p>
</div>
<div class="section" id="how-to-make-a-release">
<h1><a class="toc-backref" href="#id4">How to Make A Release</a></h1>
<p>Here are the steps taken to make a Python release.  Some steps are
more fuzzy than others because there's little that can be
automated (e.g. writing the NEWS entries).  Where a step is
usually performed by An Expert, the name of that expert is given.
Otherwise, assume the step is done by the Release Manager (RM),
the designated person performing the release.  Almost every place
the RM is mentioned below, this step can also be done by the BDFL
of course!</p>
<p>XXX: We should include a dependency graph to illustrate the steps
that can be taken in parallel, or those that depend on other
steps.</p>
<p>We use the following conventions in the examples below.  Where a
release number is given, it is of the form X.Y.MaA, e.g. 2.1.2c1
for Python 2.1.2 release candidate 1, where &quot;a&quot; == alpha, &quot;b&quot; ==
beta, &quot;c&quot; == release candidate.  Final releases are tagged with
&quot;releaseXYZ&quot; in CVS.  The micro releases are made from the
maintenance branch of the major release, e.g. Python 2.1.2 is made
from the release21-maint branch.</p>
<ol class="arabic">
<li><p class="first">Send an email to <a class="reference external" href="mailto:python-dev&#64;python.org">python-dev&#64;python.org</a> indicating the release is
about to start.</p>
</li>
<li><p class="first">Put a freeze on check ins into the maintenance branch.  At this
point, nobody except the RM should make any commits to the branch
(or his duly assigned agents, i.e. Guido the BDFL, Fred Drake for
documentation, or Thomas Heller for Windows).  If the RM screwed up
and some desperate last minute change to the branch is
necessary, it can mean extra work for Fred and Thomas.  So try to
avoid this!</p>
</li>
<li><p class="first">On the branch, change Include/patchlevel.h in two places, to
reflect the new version number you've just created.  You'll want
to change the PY_VERSION macro, and one or several of the
version subpart macros just above PY_VERSION, as appropriate.</p>
</li>
<li><p class="first">Change the &quot;%define version&quot; line of Misc/RPM/python-2.3.spec to the
same string as <tt class="docutils literal">PY_VERSION</tt> was changed to above.  E.g:</p>
<pre class="literal-block">
%define version 2.3.1
</pre>
<p>You also probably want to reset the %define release line
to '1pydotorg' if it's not already that.</p>
</li>
<li><p class="first">If you're changing the version number for Python (e.g. from
Python 2.1.1 to Python 2.1.2), you also need to update the
README file, which has a big banner at the top proclaiming its
identity.  Don't do this if you're just releasing a new alpha or
beta release, but /do/ do this if you're release a new micro,
minor or major release.</p>
</li>
<li><p class="first">The LICENSE file also needs to be changed, due to several
references to the release number.  As for the README file, changing
these are necessary for a new micro, minor or major release.</p>
<p>The LICENSE file contains a table that describes the legal
heritage of Python; you should add an entry for the X.Y.Z
release you are now making.  You should update this table in the
LICENSE file on the CVS trunk too.</p>
</li>
<li><p class="first">When the year changes, copyright legends need to be updated in
many places, including the README and LICENSE files.</p>
</li>
<li><p class="first">For the Windows build, additional files have to be updated.</p>
<p>PCbuild/BUILDno.txt contains the Windows build number, see the
instructions in this file how to change it.  Saving the project
file PCbuild/pythoncore.dsp results in a change to
PCbuild/pythoncore.dsp as well.</p>
<p>PCbuild/python20.wse sets up the Windows installer version
resource (displayed when you right-click on the installer .exe
and select Properties), and also contains the Python version
number.</p>
<p>(Before version 2.3.2, it was required to manually edit
PC/python_nt.rc, this step is now automated by the build
process.)</p>
</li>
<li><p class="first">After starting the process, the most important thing to do next
is to update the Misc/NEWS file.  Thomas will need this in order to
do the Windows release and he likes to stay up late.  This step
can be pretty tedious, so it's best to get to it immediately
after making the branch, or even before you've made the branch.
The sooner the better (but again, watch for new checkins up
until the release is made!)</p>
<p>Add high level items new to this release.  E.g. if we're
releasing 2.2a3, there must be a section at the top of the file
explaining &quot;What's new in Python 2.2a3&quot;.  It will be followed by
a section entitled &quot;What's new in Python 2.2a2&quot;.</p>
<p>Note that you /hope/ that as developers add new features to the
trunk, they've updated the NEWS file accordingly.  You can't be
positive, so double check.  If you're a Unix weenie, it helps to
verify with Thomas about changes on Windows, and Jack Jansen
about changes on the Mac.</p>
<p>This command should help you (but substitute the correct -r tag!):</p>
<pre class="literal-block">
% cvs log -rr22a1: | python Tools/scripts/logmerge.py &gt; /tmp/news.txt
</pre>
<p>IOW, you're printing out all the cvs log entries from the
previous release until now.  You can then troll through the
news.txt file looking for interesting things to add to NEWS.</p>
</li>
<li><p class="first">Check your NEWS changes into the maintenance branch.  It's easy
to forget to update the release date in this file!</p>
</li>
<li><p class="first">Check in any changes to IDLE's NEWS.txt.  Update the header in
Lib/idlelib/NEWS.txt to reflect its release version and date.
Update the IDLE version in Lib/idlelib/idlever.py to match.</p>
</li>
</ol>
<ol class="arabic" start="11">
<li><p class="first">Once the release process has started, the documentation needs to
be built and posted on python.org according to the instructions
in <a class="reference external" href="/dev/peps/pep-0101">PEP 101</a>.</p>
<p>Note that Fred is responsible both for merging doc changes from
the trunk to the branch AND for merging any branch changes from
the branch to the trunk during the cleaning up phase.
Basically, if it's in Doc/ Fred will take care of it.</p>
</li>
<li><p class="first">Thomas compiles everything with MSVC 6.0 SP5, and moves the
python23.chm file into the src/chm directory.  The installer
executable is then generated with Wise Installation System.</p>
<p>The installer includes the MSVC 6.0 runtime in the files
MSVCRT.DLL and MSVCIRT.DLL.  It leads to disaster if these files
are taken from the system directory of the machine where the
installer is built, instead it must be absolutely made sure that
these files come from the VCREDIST.EXE redistributable package
contained in the MSVC SP5 CD.  VCREDIST.EXE must be unpacked
with winzip, and the Wise Installation System prompts for the
directory.</p>
<p>After building the installer, it should be opened with winzip,
and the MS dlls extracted again and check for the same version
number as those unpacked from VCREDIST.EXE.</p>
<p>Thomas uploads this file to the starship.  He then sends the RM
a notice which includes the location and MD5 checksum of the
Windows executable.</p>
<p>Note that Thomas's creation of the Windows executable may generate
a few more commits on the branch.  Thomas will be responsible for
merging Windows-specific changes from trunk to branch, and from
branch to trunk.</p>
</li>
<li><p class="first">Sean performs his Red Hat magic, generating a set of RPMs.  He
uploads these files to python.org.  He then sends the RM a notice
which includes the location and MD5 checksum of the RPMs.</p>
</li>
<li><p class="first">It's Build Time!</p>
<p>Now, you're ready to build the source tarball.  First cd to your
working directory for the branch.  E.g.
% cd .../python-22a3</p>
</li>
<li><p class="first">Do a &quot;cvs update&quot; in this directory.  Do NOT include the -A flag!</p>
<p>You should not see any &quot;M&quot; files, but you may see several &quot;P&quot;
and/or &quot;U&quot; files.  I.e. you better not have any uncommitted
changes in your working directory, but you may pick up some of
Fred's or Thomas's last minute changes.</p>
</li>
<li><p class="first">Now tag the branch using a symbolic name like &quot;rXYMaZ&quot;,
e.g. r212</p>
<pre class="literal-block">
% cvs tag r212
</pre>
<p>Be sure to tag only the python/dist/src subdirectory of the
Python CVS tree!</p>
</li>
<li><p class="first">Change to a neutral directory, i.e. one in which you can do a
fresh, virgin, cvs export of the branch.  You will be creating a
new directory at this location, to be named &quot;Python-X.Y.M&quot;.  Do
a CVS export of the tagged branch.</p>
<pre class="literal-block">
% cd ~
% cvs -d cvs.sf.net:/cvsroot/python export -rr212 \
                      -d Python-2.1.2 python/dist/src
</pre>
</li>
<li><p class="first">Generate the tarball.  Note that we're not using the 'z' option
on the tar command because 1) that's only supported by GNU tar
as far as we know, and 2) we're going to max out the compression
level, which isn't a supported option. We generate both tar.gz
tar.bz2 formats, as the latter is about 1/6th smaller.</p>
<pre class="literal-block">
% tar -cf - Python-2.1.2 | gzip -9 &gt; Python-2.1.2.tgz
% tar -cf - Python-2.1.2 | bzip2 -9 &gt; Python-2.1.2.tar.bz2
</pre>
</li>
<li><p class="first">Calculate the MD5 checksum of the tgz and tar.bz2 files you
just created</p>
<pre class="literal-block">
% md5sum Python-2.1.2.tgz
</pre>
<p>Note that if you don't have the md5sum program, there is a
Python replacement in the Tools/scripts/md5sum.py file.</p>
</li>
<li><p class="first">Create GPG keys for each of the files.</p>
<pre class="literal-block">
% gpg -ba Python-2.1.2.tgz
% gpg -ba Python-2.1.2.tar.bz2
% gpg -ba Python-2.1.2.exe
</pre>
</li>
<li><p class="first">Now you want to perform the very important step of checking the
tarball you just created, to make sure a completely clean,
virgin build passes the regression test.  Here are the best
steps to take:</p>
<pre class="literal-block">
% cd /tmp
% tar zxvf ~/Python-2.1.2.tgz
% cd Python-2.1.2
% ls
(Do things look reasonable?)
% ./configure
(Loads of configure output)
% make test
(Do all the expected tests pass?)
</pre>
<p>If the tests pass, then you can feel good that the tarball is
fine.  If some of the tests fail, or anything else about the
freshly unpacked directory looks weird, you better stop now and
figure out what the problem is.</p>
</li>
<li><p class="first">You need to upload the tgz and the exe file to creosote.python.org.
This step can take a long time depending on your network
bandwidth.  scp both files from your own machine to creosote.</p>
</li>
<li><p class="first">While you're waiting, you can start twiddling the web pages to
include the announcement.</p>
<ol class="arabic">
<li><p class="first">In the top of the python.org web site CVS tree, create a
subdirectory for the X.Y.Z release.  You can actually copy an
earlier patch release's subdirectory, but be sure to delete
the X.Y.Z/CVS directory and &quot;cvs add X.Y.Z&quot;, for example:</p>
<pre class="literal-block">
% cd .../pydotorg
% cp -r 2.2.2 2.2.3
% rm -rf 2.2.3/CVS
% cvs add 2.2.3
% cd 2.2.3
</pre>
</li>
<li><p class="first">Edit the files for content: usually you can globally replace
X.Ya(Z-1) with X.YaZ.  However, you'll need to think about the
&quot;What's New?&quot; section.</p>
</li>
<li><p class="first">Copy the Misc/NEWS file to NEWS.txt in the X.Y.Z directory for
python.org; this contains the &quot;full scoop&quot; of changes to
Python since the previous release for this version of Python.</p>
</li>
<li><p class="first">Copy the .asc GPG signatures you created earlier here as well.</p>
</li>
<li><p class="first">Also, update the MD5 checksums.</p>
</li>
<li><p class="first">Preview the web page by doing a &quot;make&quot; or &quot;make install&quot; (as
long as you've created a new directory for this release!)</p>
</li>
<li><p class="first">Similarly, edit the ../index.ht file, i.e. the python.org home
page.  In the Big Blue Announcement Block, move the paragraph
for the new version up to the top and boldify the phrase
&quot;Python X.YaZ is out&quot;.  Edit for content, and preview locally,
but do NOT do a &quot;make install&quot; yet!</p>
</li>
</ol>
</li>
<li><p class="first">Now we're waiting for the scp to creosote to finish.  Da de da,
da de dum, hmm, hmm, dum de dum.</p>
</li>
<li><p class="first">Once that's done you need to go to creosote.python.org and move
all the files in place over there.  Our policy is that every
Python version gets its own directory, but each directory may
contain several releases.  We keep all old releases, moving them
into a &quot;prev&quot; subdirectory when we have a new release.</p>
<p>So, there's a directory called &quot;2.2&quot; which contains
Python-2.2a2.exe and Python-2.2a2.tgz, along with a &quot;prev&quot;
subdirectory containing Python-2.2a1.exe and Python-2.2a1.tgz.</p>
<p>So...</p>
<ol class="arabic simple">
<li>On creosote, cd to ~ftp/pub/python/X.Y creating it if
necessary.</li>
<li>Move the previous release files to a directory called &quot;prev&quot;
creating the directory if necessary (make sure the directory
has g+ws bits on).  If this is the first alpha release of a
new Python version, skip this step.</li>
<li>Move the .tgz file and the .exe file to this directory.  Make
sure they are world readable.  They should also be group
writable, and group-owned by webmaster.</li>
<li>md5sum the files and make sure they got uploaded intact.</li>
</ol>
</li>
<li><p class="first">the X.Y/bugs.ht file if necessary.  It is best to get
BDFL input for this step.</p>
</li>
<li><p class="first">Go up to the parent directory (i.e. the root of the web page
hierarchy) and do a &quot;make install&quot; there.  You're release is now
live!</p>
</li>
<li><p class="first">Now it's time to write the announcement for the mailing lists.
This is the fuzzy bit because not much can be automated.  You
can use one of Guido's earlier announcements as a template, but
please edit it for content!</p>
<p>Once the announcement is ready, send it to the following
addresses:</p>
<pre class="literal-block">
python-list&#64;python.org
python-announce&#64;python.org
python-dev&#64;python.org
</pre>
</li>
<li><p class="first">Send a SourceForge News Item about the release.  From the
project's &quot;menu bar&quot;, select the &quot;News&quot; link; once in News,
select the &quot;Submit&quot; link.  Type a suitable subject (e.g. &quot;Python
2.2c1 released&quot; :-) in the Subject box, add some text to the
Details box (at the very least including the release URL at
www.python.org and the fact that you're happy with the release)
and click the SUBMIT button.</p>
<p>Feel free to remove any old news items.</p>
</li>
</ol>
<p>Now it's time to do some cleanup.  These steps are very important!</p>
<ol class="arabic">
<li><p class="first">Edit the file Include/patchlevel.h so that the PY_VERSION
string says something like &quot;X.YaZ+&quot;.  Note the trailing '+'
indicating that the trunk is going to be moving forward with
development.  E.g. the line should look like:</p>
<pre class="literal-block">
#define PY_VERSION              &quot;2.1.2+&quot;
</pre>
<p>Make sure that the other <tt class="docutils literal">PY_</tt> version macros contain the
correct values.  Commit this change.</p>
</li>
<li><p class="first">For the extra paranoid, do a completely clean test of the
release.  This includes downloading the tarball from
www.python.org.</p>
</li>
<li><p class="first">Make sure the md5 checksums match.  Then unpack the tarball,
and do a clean make test.</p>
<pre class="literal-block">
% make distclean
% ./configure
% make test
</pre>
<p>To ensure that the regression test suite passes.  If not, you
screwed up somewhere!</p>
</li>
</ol>
<p>Step 5 ...</p>
<p>Verify!  This can be interleaved with Step 4.  Pretend you're a
user:  download the files from python.org, and make Python from
it.  This step is too easy to overlook, and on several occasions
we've had useless release files.  Once a general server problem
caused mysterious corruption of all files; once the source tarball
got built incorrectly; more than once the file upload process on
SF truncated files; and so on.</p>
</div>
<div class="section" id="what-next">
<h1><a class="toc-backref" href="#id5">What Next?</a></h1>
<p>Rejoice.  Drink.  Be Merry.  Write a PEP like this one.  Or be
like unto Guido and take A Vacation.</p>
<p>You've just made a Python release!</p>
<p>Actually, there is one more step.  You should turn over ownership
of the branch to Jack Jansen.  All this means is that now he will
be responsible for making commits to the branch.  He's going to
use this to build the MacOS versions.  He may send you information
about the Mac release that should be merged into the informational
pages on www.python.org.  When he's done, he'll tag the branch
something like &quot;rX.YaZ-mac&quot;.  He'll also be responsible for
merging any Mac-related changes back into the trunk.</p>
</div>
<div class="section" id="final-release-notes">
<h1><a class="toc-backref" href="#id6">Final Release Notes</a></h1>
<p>The Final release of any major release, e.g. Python 2.2 final, has
special requirements, specifically because it will be one of the
longest lived releases (i.e. betas don't last more than a couple
of weeks, but final releases can last for years!).</p>
<p>For this reason we want to have a higher coordination between the
three major releases: Windows, Mac, and source.  The Windows and
source releases benefit from the close proximity of the respective
release-bots.  But the Mac-bot, Jack Jansen, is 6 hours away.  So
we add this extra step to the release process for a final
release:</p>
<ol class="arabic simple">
<li>Hold up the final release until Jack approves, or until we
lose patience &lt;wink&gt;.</li>
</ol>
<p>The python.org site also needs some tweaking when a new bugfix release
is issued.</p>
<ol class="arabic simple" start="2">
<li>The documentation should be installed at doc/&lt;version&gt;/.</li>
<li>Add a link from doc/&lt;previous-minor-release&gt;/index.ht to the
documentation for the new version.</li>
<li>All older doc/&lt;old-release&gt;/index.ht files should be updated to
point to the documentation for the new version.</li>
<li>/robots.txt should be modified to prevent the old version's
documentation from being crawled by search engines.</li>
</ol>
</div>
<div class="section" id="windows-notes">
<h1><a class="toc-backref" href="#id7">Windows Notes</a></h1>
<p>Windows has a GUI installer, various flavors of Windows have
&quot;special limitations&quot;, and the Windows installer also packs
precompiled &quot;foreign&quot; binaries (Tcl/Tk, expat, etc).  So Windows
testing is tiresome but very necessary.</p>
<p>Concurrent with uploading the installer, Thomas installs Python
from it twice: once into the default directory suggested by the
installer, and later into a directory with embedded spaces in its
name.  For each installation, he runs the full regression suite
from a DOS box, and both with and without -0.</p>
<p>He also tries <strong>every</strong> shortcut created under Start -&gt; Menu -&gt; the
Python group.  When trying IDLE this way, you need to verify that
Help -&gt; Python Documentation works.  When trying pydoc this way
(the &quot;Module Docs&quot; Start menu entry), make sure the &quot;Start
Browser&quot; button works, and make sure you can search for a random
module (Thomas uses &quot;random&quot; &lt;wink&gt;) and then that the &quot;go to
selected&quot; button works.</p>
<p>It's amazing how much can go wrong here -- and even more amazing
how often last-second checkins break one of these things.  If
you're &quot;the Windows geek&quot;, keep in mind that you're likely the
only person routinely testing on Windows, and that Windows is
simply a mess.</p>
<p>Repeat all of the above on at least one flavor of Win9x, and one
of NT/2000/XP.  On NT/2000/XP, try both an Admin and a plain User
(not Power User) account.</p>
<p>WRT Step 5 above (verify the release media), since by the time
release files are ready to download Thomas has generally run many
Windows tests on the installer he uploaded, he usually doesn't do
anything for Step 5 except a full byte-comparison (&quot;fc /b&quot; if
using a Windows shell) of the downloaded file against the file he
uploaded.</p>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id8">Copyright</a></h1>
<p>This document has been placed in the public domain.</p>
<!-- Local Variables:
mode: indented-text
indent-tabs-mode: nil
End: -->
</div>

