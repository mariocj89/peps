<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">PEP:</th><td class="field-body">223</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">Change the Meaning of <tt class="docutils literal">\x</tt> Escapes</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">$Revision$</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference external" href="https://hg.python.org/peps/file/tip/pep-0223.txt">$Date$</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">tim.peters&#32;&#97;t&#32;gmail.com (Tim Peters)</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Final</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Standards Track</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference external" href="/dev/peps/pep-0012">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">20-Aug-2000</td>
</tr>
<tr class="field"><th class="field-name">Python-Version:</th><td class="field-body">2.0</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body">23-Aug-2000</td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#abstract" id="id3">Abstract</a></li>
<li><a class="reference internal" href="#syntax" id="id4">Syntax</a></li>
<li><a class="reference internal" href="#semantics" id="id5">Semantics</a></li>
<li><a class="reference internal" href="#example" id="id6">Example</a></li>
<li><a class="reference internal" href="#history-and-rationale" id="id7">History and Rationale</a></li>
<li><a class="reference internal" href="#development-and-discussion" id="id8">Development and Discussion</a></li>
<li><a class="reference internal" href="#backward-compatibility" id="id9">Backward Compatibility</a></li>
<li><a class="reference internal" href="#effects-on-other-tools" id="id10">Effects on Other Tools</a></li>
<li><a class="reference internal" href="#reference-implementation" id="id11">Reference Implementation</a></li>
<li><a class="reference internal" href="#bdfl-pronouncements" id="id12">BDFL Pronouncements</a></li>
<li><a class="reference internal" href="#references" id="id13">References</a></li>
<li><a class="reference internal" href="#copyright" id="id14">Copyright</a></li>
</ul>
</div>
<div class="section" id="abstract">
<h1><a class="toc-backref" href="#id3">Abstract</a></h1>
<p>Change <tt class="docutils literal">\x</tt> escapes, in both 8-bit and Unicode strings, to consume
exactly the two hex digits following.  The proposal views this as
correcting an original design flaw, leading to clearer expression
in all flavors of string, a cleaner Unicode story, better
compatibility with Perl regular expressions, and with minimal risk
to existing code.</p>
</div>
<div class="section" id="syntax">
<h1><a class="toc-backref" href="#id4">Syntax</a></h1>
<p>The syntax of <tt class="docutils literal">\x</tt> escapes, in all flavors of non-raw strings, becomes</p>
<pre class="literal-block">
\xhh
</pre>
<p>where h is a hex digit (0-9, a-f, A-F).  The exact syntax in 1.5.2 is
not clearly specified in the Reference Manual; it says</p>
<pre class="literal-block">
\xhh...
</pre>
<p>implying &quot;two or more&quot; hex digits, but one-digit forms are also
accepted by the 1.5.2 compiler, and a plain <tt class="docutils literal">\x</tt> is &quot;expanded&quot; to
itself (i.e., a backslash followed by the letter x).  It's unclear
whether the Reference Manual intended either of the 1-digit or
0-digit behaviors.</p>
</div>
<div class="section" id="semantics">
<h1><a class="toc-backref" href="#id5">Semantics</a></h1>
<p>In an 8-bit non-raw string,</p>
<pre class="literal-block">
\xij
</pre>
<p>expands to the character</p>
<pre class="literal-block">
chr(int(ij, 16))
</pre>
<p>Note that this is the same as in 1.6 and before.</p>
<p>In a Unicode string,</p>
<pre class="literal-block">
\xij
</pre>
<p>acts the same as</p>
<pre class="literal-block">
\u00ij
</pre>
<p>i.e. it expands to the obvious Latin-1 character from the initial
segment of the Unicode space.</p>
<p>An <tt class="docutils literal">\x</tt> not followed by at least two hex digits is a compile-time error,
specifically <tt class="docutils literal">ValueError</tt> in 8-bit strings, and <tt class="docutils literal">UnicodeError</tt> (a subclass
of <tt class="docutils literal">ValueError</tt>) in Unicode strings.  Note that if an <tt class="docutils literal">\x</tt> is followed by
more than two hex digits, only the first two are &quot;consumed&quot;.  In 1.6
and before all but the <em>last</em> two were silently ignored.</p>
</div>
<div class="section" id="example">
<h1><a class="toc-backref" href="#id6">Example</a></h1>
<p>In 1.5.2:</p>
<pre class="literal-block">
&gt;&gt;&gt; &quot;\x123465&quot;  # same as &quot;\x65&quot;
'e'
&gt;&gt;&gt; &quot;\x65&quot;
'e'
&gt;&gt;&gt; &quot;\x1&quot;
'\001'
&gt;&gt;&gt; &quot;\x\x&quot;
'\\x\\x'
&gt;&gt;&gt;
</pre>
<p>In 2.0:</p>
<pre class="literal-block">
&gt;&gt;&gt; &quot;\x123465&quot; # \x12 -&gt; \022, &quot;3456&quot; left alone
'\0223456'
&gt;&gt;&gt; &quot;\x65&quot;
'e'
&gt;&gt;&gt; &quot;\x1&quot;
[ValueError is raised]
&gt;&gt;&gt; &quot;\x\x&quot;
[ValueError is raised]
&gt;&gt;&gt;
</pre>
</div>
<div class="section" id="history-and-rationale">
<h1><a class="toc-backref" href="#id7">History and Rationale</a></h1>
<p><tt class="docutils literal">\x</tt> escapes were introduced in C as a way to specify variable-width
character encodings.  Exactly which encodings those were, and how many
hex digits they required, was left up to each implementation.  The
language simply stated that <tt class="docutils literal">\x</tt> &quot;consumed&quot; <em>all</em> hex digits following,
and left the meaning up to each implementation.  So, in effect, <tt class="docutils literal">\x</tt> in C
is a standard hook to supply platform-defined behavior.</p>
<p>Because Python explicitly aims at platform independence, the <tt class="docutils literal">\x</tt> escape
in Python (up to and including 1.6) has been treated the same way
across all platforms:  all <em>except</em> the last two hex digits were
silently ignored.  So the only actual use for <tt class="docutils literal">\x</tt> escapes in Python was
to specify a single byte using hex notation.</p>
<p>Larry Wall appears to have realized that this was the only real use for
<tt class="docutils literal">\x</tt> escapes in a platform-independent language, as the proposed rule for
Python 2.0 is in fact what Perl has done from the start (although you
need to run in Perl -w mode to get warned about <tt class="docutils literal">\x</tt> escapes with fewer
than 2 hex digits following -- it's clearly more Pythonic to insist on
2 all the time).</p>
<p>When Unicode strings were introduced to Python, <tt class="docutils literal">\x</tt> was generalized so
as to ignore all but the last <em>four</em> hex digits in Unicode strings.
This caused a technical difficulty for the new regular expression engine:
SRE tries very hard to allow mixing 8-bit and Unicode patterns and
strings in intuitive ways, and it no longer had any way to guess what,
for example, <tt class="docutils literal"><span class="pre">r&quot;\x123456&quot;</span></tt> should mean as a pattern:  is it asking to match
the 8-bit character <tt class="docutils literal">\x56</tt> or the Unicode character <tt class="docutils literal">\u3456</tt>?</p>
<p>There are hacky ways to guess, but it doesn't end there.  The ISO C99
standard also introduces 8-digit <tt class="docutils literal">\U12345678</tt> escapes to cover the entire
ISO 10646 character space, and it's also desired that Python 2 support
that from the start.  But then what are <tt class="docutils literal">\x</tt> escapes supposed to mean?
Do they ignore all but the last <em>eight</em> hex digits then?  And if less
than 8 following in a Unicode string, all but the last 4?  And if less
than 4, all but the last 2?</p>
<p>This was getting messier by the minute, and the proposal cuts the
Gordian knot by making <tt class="docutils literal">\x</tt> simpler instead of more complicated.  Note
that the 4-digit generalization to <tt class="docutils literal">\xijkl</tt> in Unicode strings was also
redundant, because it meant exactly the same thing as <tt class="docutils literal">\uijkl</tt> in Unicode
strings.  It's more Pythonic to have just one obvious way to specify a
Unicode character via hex notation.</p>
</div>
<div class="section" id="development-and-discussion">
<h1><a class="toc-backref" href="#id8">Development and Discussion</a></h1>
<p>The proposal was worked out among Guido van Rossum, Fredrik Lundh and
Tim Peters in email.  It was subsequently explained and discussed on
Python-Dev under subject &quot;Go x yourself&quot; <a class="footnote-reference" href="#id2" id="id1">[1]</a>, starting 2000-08-03.
Response was overwhelmingly positive; no objections were raised.</p>
</div>
<div class="section" id="backward-compatibility">
<h1><a class="toc-backref" href="#id9">Backward Compatibility</a></h1>
<p>Changing the meaning of <tt class="docutils literal">\x</tt> escapes does carry risk of breaking existing
code, although no instances of incompatibility have yet been discovered.
The risk is believed to be minimal.</p>
<p>Tim Peters verified that, except for pieces of the standard test suite
deliberately provoking end cases, there are no instances of <tt class="docutils literal"><span class="pre">\xabcdef...</span></tt>
with fewer or more than 2 hex digits following, in either the Python
CVS development tree, or in assorted Python packages sitting on his
machine.</p>
<p>It's unlikely there are any with fewer than 2, because the Reference
Manual implied they weren't legal (although this is debatable!).  If
there are any with more than 2, Guido is ready to argue they were buggy
anyway &lt;0.9 wink&gt;.</p>
<p>Guido reported that the O'Reilly Python books <em>already</em> document that
Python works the proposed way, likely due to their Perl editing
heritage (as above, Perl worked (very close to) the proposed way from
its start).</p>
<p>Finn Bock reported that what JPython does with <tt class="docutils literal">\x</tt> escapes is
unpredictable today.  This proposal gives a clear meaning that can be
consistently and easily implemented across all Python implementations.</p>
</div>
<div class="section" id="effects-on-other-tools">
<h1><a class="toc-backref" href="#id10">Effects on Other Tools</a></h1>
<p>Believed to be none.  The candidates for breakage would mostly be
parsing tools, but the author knows of none that worry about the
internal structure of Python strings beyond the approximation &quot;when
there's a backslash, swallow the next character&quot;.  Tim Peters checked
<tt class="docutils literal"><span class="pre">python-mode.el</span></tt>, the std <tt class="docutils literal">tokenize.py</tt> and <tt class="docutils literal">pyclbr.py</tt>, and the IDLE syntax
coloring subsystem, and believes there's no need to change any of
them.  Tools like <tt class="docutils literal">tabnanny.py</tt> and <tt class="docutils literal">checkappend.py</tt> inherit their immunity
from <tt class="docutils literal">tokenize.py</tt>.</p>
</div>
<div class="section" id="reference-implementation">
<h1><a class="toc-backref" href="#id11">Reference Implementation</a></h1>
<p>The code changes are so simple that a separate patch will not be produced.
Fredrik Lundh is writing the code, is an expert in the area, and will
simply check the changes in before 2.0b1 is released.</p>
</div>
<div class="section" id="bdfl-pronouncements">
<h1><a class="toc-backref" href="#id12">BDFL Pronouncements</a></h1>
<p>Yes, <tt class="docutils literal">ValueError</tt>, not <tt class="docutils literal">SyntaxError</tt>.  &quot;Problems with literal interpretations
traditionally raise 'runtime' exceptions rather than syntax errors.&quot;</p>
</div>
<div class="section" id="references">
<h1><a class="toc-backref" href="#id13">References</a></h1>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Tim Peters, Go x yourself
<a class="reference external" href="https://mail.python.org/pipermail/python-dev/2000-August/007825.html">https://mail.python.org/pipermail/python-dev/2000-August/007825.html</a></td></tr>
</tbody>
</table>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id14">Copyright</a></h1>
<p>This document has been placed in the public domain.</p>
<!-- Local Variables:
mode: indented-text
indent-tabs-mode: nil
End: -->
</div>

