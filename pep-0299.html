<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">PEP:</th><td class="field-body">299</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">Special __main__() function in modules</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">$Revision$</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference external" href="https://hg.python.org/peps/file/tip/pep-0299.txt">$Date$</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">Jeff Epler &lt;jepler&#32;&#97;t&#32;unpythonic.net&gt;</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Rejected</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Standards Track</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference external" href="/dev/peps/pep-0012">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">12-Aug-2002</td>
</tr>
<tr class="field"><th class="field-name">Python-Version:</th><td class="field-body">2.3</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body">29-Mar-2006</td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#abstract" id="id2">Abstract</a></li>
<li><a class="reference internal" href="#motivation" id="id3">Motivation</a></li>
<li><a class="reference internal" href="#proposal" id="id4">Proposal</a></li>
<li><a class="reference internal" href="#implementation" id="id5">Implementation</a></li>
<li><a class="reference internal" href="#open-issues" id="id6">Open Issues</a></li>
<li><a class="reference internal" href="#rejection" id="id7">Rejection</a></li>
<li><a class="reference internal" href="#references" id="id8">References</a></li>
<li><a class="reference internal" href="#copyright" id="id9">Copyright</a></li>
</ul>
</div>
<div class="section" id="abstract">
<h1><a class="toc-backref" href="#id2">Abstract</a></h1>
<p>Many Python modules are also intended to be callable as standalone
scripts.  This PEP proposes that a special function called <tt class="docutils literal">__main__()</tt>
should serve this purpose.</p>
</div>
<div class="section" id="motivation">
<h1><a class="toc-backref" href="#id3">Motivation</a></h1>
<p>There should be one simple and universal idiom for invoking a module
as a standalone script.</p>
<p>The semi-standard idiom:</p>
<pre class="literal-block">
if __name__ == '__main__':
    perform &quot;standalone&quot; functionality
</pre>
<p>is unclear to programmers of languages like C and C++.  It also does
not permit invocation of the standalone function when the module is
imported.  The variant:</p>
<pre class="literal-block">
if __name__ == '__main__':
    main_function()
</pre>
<p>is sometimes seen, but there exists no standard name for the function,
and because arguments are taken from sys.argv it is not possible to
pass specific arguments without changing the argument list seen by all
other modules.  (Imagine a threaded Python program, with two threads
wishing to invoke the standalone functionality of different modules
with different argument lists)</p>
</div>
<div class="section" id="proposal">
<h1><a class="toc-backref" href="#id4">Proposal</a></h1>
<p>The standard name of the 'main function' should be <tt class="docutils literal">__main__</tt>. When a
module is invoked on the command line, such as:</p>
<pre class="literal-block">
python mymodule.py
</pre>
<p>then the module behaves as though the following lines existed at the
end of the module (except that the attribute __sys may not be used or
assumed to exist elsewhere in the script):</p>
<pre class="literal-block">
if globals().has_key(&quot;__main__&quot;):
    import sys as __sys
    __sys.exit(__main__(__sys.argv))
</pre>
<p>Other modules may execute:</p>
<pre class="literal-block">
import mymodule mymodule.__main__(['mymodule', ...])
</pre>
<p>It is up to <tt class="docutils literal">mymodule</tt> to document thread-safety issues or other
issues which might restrict use of <tt class="docutils literal">__main__</tt>.  (Other issues might
include use of mutually exclusive GUI modules, non-sharable resources
like hardware devices, reassignment of <tt class="docutils literal">sys.stdin</tt>/<tt class="docutils literal">stdout</tt>, etc)</p>
</div>
<div class="section" id="implementation">
<h1><a class="toc-backref" href="#id5">Implementation</a></h1>
<p>In <tt class="docutils literal">modules/main.c</tt>, the block near line 385 (after the
<tt class="docutils literal">PyRun_AnyFileExFlags</tt> call) will be changed so that the above code
(or its C equivalent) is executed.</p>
</div>
<div class="section" id="open-issues">
<h1><a class="toc-backref" href="#id6">Open Issues</a></h1>
<ul>
<li><p class="first">Should the return value from <tt class="docutils literal">__main__</tt> be treated as the exit value?</p>
<p>Yes.  Many <tt class="docutils literal">__main__</tt> will naturally return <tt class="docutils literal">None</tt>, which
<tt class="docutils literal">sys.exit</tt> translates into a &quot;success&quot; return code.  In those that
return a numeric result, it behaves just like the argument to
<tt class="docutils literal">sys.exit()</tt> or the return value from C's main().</p>
</li>
<li><p class="first">Should the argument list to <tt class="docutils literal">__main__</tt> include <tt class="docutils literal">argv[0]</tt>, or just the
&quot;real&quot; arguments <tt class="docutils literal">argv[1:]</tt>?</p>
<p><tt class="docutils literal">argv[0]</tt> is included for symmetry with <tt class="docutils literal">sys.argv</tt> and easy
transition to the new standard idiom.</p>
</li>
</ul>
</div>
<div class="section" id="rejection">
<h1><a class="toc-backref" href="#id7">Rejection</a></h1>
<p>In a short discussion on python-dev [1], two major backwards
compatibility problems were brought up and Guido pronounced that he
doesn't like the idea anyway as it's &quot;not worth the change (in docs,
user habits, etc.) and there's nothing particularly broken.&quot;</p>
</div>
<div class="section" id="references">
<h1><a class="toc-backref" href="#id8">References</a></h1>
<table class="docutils footnote" frame="void" id="id1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[1]</td><td>Georg Brandl, &quot;What about <a class="reference external" href="/dev/peps/pep-0299">PEP 299</a>&quot;,
<a class="reference external" href="https://mail.python.org/pipermail/python-dev/2006-March/062951.html">https://mail.python.org/pipermail/python-dev/2006-March/062951.html</a></td></tr>
</tbody>
</table>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id9">Copyright</a></h1>
<p>This document has been placed in the public domain.</p>
<!-- Local Variables:
mode: indented-text
indent-tabs-mode: nil
sentence-end-double-space: t
fill-column: 70
End: -->
</div>

