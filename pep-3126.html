<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">PEP:</th><td class="field-body">3126</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">Remove Implicit String Concatenation</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">$Revision$</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference external" href="https://hg.python.org/peps/file/tip/pep-3126.txt">$Date$</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">Jim J. Jewett &lt;JimJJewett&#32;&#97;t&#32;gmail.com&gt;,
Raymond Hettinger &lt;python&#32;&#97;t&#32;rcn.com&gt;</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Rejected</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Standards Track</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference external" href="/dev/peps/pep-0012">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">29-Apr-2007</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body">29-Apr-2007, 30-Apr-2007, 07-May-2007</td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#rejection-notice" id="id9">Rejection Notice</a></li>
<li><a class="reference internal" href="#abstract" id="id10">Abstract</a></li>
<li><a class="reference internal" href="#motivation" id="id11">Motivation</a><ul>
<li><a class="reference internal" href="#history-or-future" id="id12">History or Future</a></li>
<li><a class="reference internal" href="#problem" id="id13">Problem</a></li>
</ul>
</li>
<li><a class="reference internal" href="#solution" id="id14">Solution</a></li>
<li><a class="reference internal" href="#concerns" id="id15">Concerns</a><ul>
<li><a class="reference internal" href="#operator-precedence" id="id16">Operator Precedence</a></li>
<li><a class="reference internal" href="#long-commands" id="id17">Long Commands</a></li>
<li><a class="reference internal" href="#regular-expressions" id="id18">Regular Expressions</a></li>
<li><a class="reference internal" href="#internationalization" id="id19">Internationalization</a></li>
</ul>
</li>
<li><a class="reference internal" href="#transition" id="id20">Transition</a></li>
<li><a class="reference internal" href="#open-issues" id="id21">Open Issues</a></li>
<li><a class="reference internal" href="#references" id="id22">References</a></li>
<li><a class="reference internal" href="#copyright" id="id23">Copyright</a></li>
</ul>
</div>
<div class="section" id="rejection-notice">
<h1><a class="toc-backref" href="#id9">Rejection Notice</a></h1>
<p>This PEP is rejected.  There wasn't enough support in favor, the
feature to be removed isn't all that harmful, and there are some use
cases that would become harder.</p>
</div>
<div class="section" id="abstract">
<h1><a class="toc-backref" href="#id10">Abstract</a></h1>
<p>Python inherited many of its parsing rules from C.  While this has
been generally useful, there are some individual rules which are less
useful for python, and should be eliminated.</p>
<p>This PEP proposes to eliminate implicit string concatenation based
only on the adjacency of literals.</p>
<p>Instead of:</p>
<pre class="literal-block">
&quot;abc&quot; &quot;def&quot; == &quot;abcdef&quot;
</pre>
<p>authors will need to be explicit, and either add the strings:</p>
<pre class="literal-block">
&quot;abc&quot; + &quot;def&quot; == &quot;abcdef&quot;
</pre>
<p>or join them:</p>
<pre class="literal-block">
&quot;&quot;.join([&quot;abc&quot;, &quot;def&quot;]) == &quot;abcdef&quot;
</pre>
</div>
<div class="section" id="motivation">
<h1><a class="toc-backref" href="#id11">Motivation</a></h1>
<p>One goal for Python 3000 should be to simplify the language by
removing unnecessary features.  Implicit string concatenation should
be dropped in favor of existing techniques. This will simplify the
grammar and simplify a user's mental picture of Python.  The latter is
important for letting the language &quot;fit in your head&quot;.  A large group
of current users do not even know about implicit concatenation.  Of
those who do know about it, a large portion never use it or habitually
avoid it. Of those who both know about it and use it, very few could
state with confidence the implicit operator precedence and under what
circumstances it is computed when the definition is compiled versus
when it is run.</p>
<div class="section" id="history-or-future">
<h2><a class="toc-backref" href="#id12">History or Future</a></h2>
<p>Many Python parsing rules are intentionally compatible with C.  This
is a useful default, but Special Cases need to be justified based on
their utility in Python.  We should no longer assume that python
programmers will also be familiar with C, so compatibility between
languages should be treated as a tie-breaker, rather than a
justification.</p>
<p>In C, implicit concatenation is the only way to join strings without
using a (run-time) function call to store into a variable.  In Python,
the strings can be joined (and still recognized as immutable) using
more standard Python idioms, such <tt class="docutils literal">+</tt> or <tt class="docutils literal"><span class="pre">&quot;&quot;.join</span></tt>.</p>
</div>
<div class="section" id="problem">
<h2><a class="toc-backref" href="#id13">Problem</a></h2>
<p>Implicit String concatentation leads to tuples and lists which are
shorter than they appear; this is turn can lead to confusing, or even
silent, errors.  For example, given a function which accepts several
parameters, but offers a default value for some of them:</p>
<pre class="literal-block">
def f(fmt, *args):
    print fmt % args
</pre>
<p>This looks like a valid call, but isn't:</p>
<pre class="literal-block">
&gt;&gt;&gt; f(&quot;User %s got a message %s&quot;,
      &quot;Bob&quot;
      &quot;Time for dinner&quot;)

Traceback (most recent call last):
  File &quot;&lt;pyshell#8&gt;&quot;, line 2, in &lt;module&gt;
    &quot;Bob&quot;
  File &quot;&lt;pyshell#3&gt;&quot;, line 2, in f
    print fmt % args
TypeError: not enough arguments for format string
</pre>
<p>Calls to this function can silently do the wrong thing:</p>
<pre class="literal-block">
def g(arg1, arg2=None):
    ...

# silently transformed into the possibly very different
# g(&quot;arg1 on this linearg2 on this line&quot;, None)
g(&quot;arg1 on this line&quot;
  &quot;arg2 on this line&quot;)
</pre>
<p>To quote Jason Orendorff [#Orendorff]</p>
<blockquote>
<p>Oh.  I just realized this happens a lot out here.  Where I work,
we use scons, and each SConscript has a long list of filenames:</p>
<pre class="literal-block">
sourceFiles = [
    'foo.c'
    'bar.c',
    #...many lines omitted...
    'q1000x.c']
</pre>
<p>It's a common mistake to leave off a comma, and then scons
complains that it can't find 'foo.cbar.c'.  This is pretty
bewildering behavior even if you <em>are</em> a Python programmer,
and not everyone here is.</p>
</blockquote>
</div>
</div>
<div class="section" id="solution">
<h1><a class="toc-backref" href="#id14">Solution</a></h1>
<p>In Python, strings are objects and they support the __add__ operator,
so it is possible to write:</p>
<pre class="literal-block">
&quot;abc&quot; + &quot;def&quot;
</pre>
<p>Because these are literals, this addition can still be optimized away
by the compiler; the CPython compiler already does so.
<a class="footnote-reference" href="#rcn-constantfold" id="id1">[2]</a></p>
<p>Other existing alternatives include multiline (triple-quoted) strings,
and the join method:</p>
<pre class="literal-block">
&quot;&quot;&quot;This string
   extends across
   multiple lines, but you may want to use something like
   Textwrap.dedent
   to clear out the leading spaces
   and/or reformat.
&quot;&quot;&quot;


&gt;&gt;&gt; &quot;&quot;.join([&quot;empty&quot;, &quot;string&quot;, &quot;joiner&quot;]) == &quot;emptystringjoiner&quot;
True

&gt;&gt;&gt; &quot; &quot;.join([&quot;space&quot;, &quot;string&quot;, &quot;joiner&quot;]) == &quot;space string joiner&quot;

&gt;&gt;&gt; &quot;\n&quot;.join([&quot;multiple&quot;, &quot;lines&quot;]) == &quot;multiple\nlines&quot; == (
&quot;&quot;&quot;multiple
lines&quot;&quot;&quot;)
True
</pre>
</div>
<div class="section" id="concerns">
<h1><a class="toc-backref" href="#id15">Concerns</a></h1>
<div class="section" id="operator-precedence">
<h2><a class="toc-backref" href="#id16">Operator Precedence</a></h2>
<p>Guido indicated <a class="footnote-reference" href="#rcn-constantfold" id="id2">[2]</a> that this change should be
handled by PEP, because there were a few edge cases with other string
operators, such as the %.  (Assuming that str % stays -- it may be
eliminated in favor of <a class="reference external" href="/dev/peps/pep-3101">PEP 3101</a> -- Advanced String Formatting.
<a class="footnote-reference" href="#pep3101" id="id3">[3]</a> <a class="footnote-reference" href="#elimpercent" id="id4">[4]</a>)</p>
<p>The resolution is to use parentheses to enforce precedence -- the same
solution that can be used today:</p>
<pre class="literal-block">
# Clearest, works today, continues to work, optimization is
# already possible.
(&quot;abc %s def&quot; + &quot;ghi&quot;) % var

# Already works today; precedence makes the optimization more
# difficult to recognize, but does not change the semantics.
&quot;abc&quot; + &quot;def %s ghi&quot; % var
</pre>
<p>as opposed to:</p>
<pre class="literal-block">
# Already fails because modulus (%) is higher precedence than
# addition (+)
(&quot;abc %s def&quot; + &quot;ghi&quot; % var)

# Works today only because adjacency is higher precedence than
# modulus.  This will no longer be available.
&quot;abc %s&quot; &quot;def&quot; % var

# So the 2-to-3 translator can automically replace it with the
# (already valid):
(&quot;abc %s&quot; + &quot;def&quot;) % var
</pre>
</div>
<div class="section" id="long-commands">
<h2><a class="toc-backref" href="#id17">Long Commands</a></h2>
<blockquote>
<p>... build up (what I consider to be) readable SQL queries <a class="footnote-reference" href="#skipsql" id="id5">[5]</a>:</p>
<pre class="literal-block">
rows = self.executesql(&quot;select cities.city, state, country&quot;
                       &quot;    from cities, venues, events, addresses&quot;
                       &quot;    where cities.city like %s&quot;
                       &quot;      and events.active = 1&quot;
                       &quot;      and venues.address = addresses.id&quot;
                       &quot;      and addresses.city = cities.id&quot;
                       &quot;      and events.venue = venues.id&quot;,
                       (city,))
</pre>
</blockquote>
<p>Alternatives again include triple-quoted strings, <tt class="docutils literal">+</tt>, and <tt class="docutils literal">.join</tt>:</p>
<pre class="literal-block">
query=&quot;&quot;&quot;select cities.city, state, country
             from cities, venues, events, addresses
             where cities.city like %s
               and events.active = 1&quot;
               and venues.address = addresses.id
               and addresses.city = cities.id
               and events.venue = venues.id&quot;&quot;&quot;

query=( &quot;select cities.city, state, country&quot;
      + &quot;    from cities, venues, events, addresses&quot;
      + &quot;    where cities.city like %s&quot;
      + &quot;      and events.active = 1&quot;
      + &quot;      and venues.address = addresses.id&quot;
      + &quot;      and addresses.city = cities.id&quot;
      + &quot;      and events.venue = venues.id&quot;
      )

query=&quot;\n&quot;.join([&quot;select cities.city, state, country&quot;,
                 &quot;    from cities, venues, events, addresses&quot;,
                 &quot;    where cities.city like %s&quot;,
                 &quot;      and events.active = 1&quot;,
                 &quot;      and venues.address = addresses.id&quot;,
                 &quot;      and addresses.city = cities.id&quot;,
                 &quot;      and events.venue = venues.id&quot;])

# And yes, you *could* inline any of the above querystrings
# the same way the original was inlined.
rows = self.executesql(query, (city,))
</pre>
</div>
<div class="section" id="regular-expressions">
<h2><a class="toc-backref" href="#id18">Regular Expressions</a></h2>
<p>Complex regular expressions are sometimes stated in terms of several
implicitly concatenated strings with each regex component on a
different line and followed by a comment.  The plus operator can be
inserted here but it does make the regex harder to read.  One
alternative is to use the re.VERBOSE option.  Another alternative is
to build-up the regex with a series of += lines:</p>
<pre class="literal-block">
# Existing idiom which relies on implicit concatenation
r = ('a{20}'  # Twenty A's
     'b{5}'   # Followed by Five B's
     )

# Mechanical replacement
r = ('a{20}'  +# Twenty A's
     'b{5}'   # Followed by Five B's
     )

# already works today
r = '''a{20}  # Twenty A's
       b{5}   # Followed by Five B's
    '''                 # Compiled with the re.VERBOSE flag

# already works today
r = 'a{20}'   # Twenty A's
r += 'b{5}'   # Followed by Five B's
</pre>
</div>
<div class="section" id="internationalization">
<h2><a class="toc-backref" href="#id19">Internationalization</a></h2>
<p>Some internationalization tools -- notably xgettext -- have already
been special-cased for implicit concatenation, but not for Python's
explicit concatenation. <a class="footnote-reference" href="#barryi8" id="id6">[6]</a></p>
<p>These tools will fail to extract the (already legal):</p>
<pre class="literal-block">
_(&quot;some string&quot; +
  &quot; and more of it&quot;)
</pre>
<p>but often have a special case for:</p>
<pre class="literal-block">
_(&quot;some string&quot;
  &quot; and more of it&quot;)
</pre>
<p>It should also be possible to just use an overly long line (xgettext
limits messages to 2048 characters <a class="footnote-reference" href="#xgettext2048" id="id7">[8]</a>, which is less
than Python's enforced limit) or triple-quoted strings, but these
solutions sacrifice some readability in the code:</p>
<pre class="literal-block">
# Lines over a certain length are unpleasant.
_(&quot;some string and more of it&quot;)

# Changing whitespace is not ideal.
_(&quot;&quot;&quot;Some string
     and more of it&quot;&quot;&quot;)
_(&quot;&quot;&quot;Some string
and more of it&quot;&quot;&quot;)
_(&quot;Some string \
and more of it&quot;)
</pre>
<p>I do not see a good short-term resolution for this.</p>
</div>
</div>
<div class="section" id="transition">
<h1><a class="toc-backref" href="#id20">Transition</a></h1>
<p>The proposed new constructs are already legal in current Python, and
can be used immediately.</p>
<p>The 2 to 3 translator can be made to mechanically change:</p>
<pre class="literal-block">
&quot;str1&quot; &quot;str2&quot;
(&quot;line1&quot;  #comment
 &quot;line2&quot;)
</pre>
<p>into:</p>
<pre class="literal-block">
(&quot;str1&quot; + &quot;str2&quot;)
(&quot;line1&quot;   +#comments
 &quot;line2&quot;)
</pre>
<p>If users want to use one of the other idioms, they can; as these
idioms are all already legal in python 2, the edits can be made
to the original source, rather than patching up the translator.</p>
</div>
<div class="section" id="open-issues">
<h1><a class="toc-backref" href="#id21">Open Issues</a></h1>
<p>Is there a better way to support external text extraction tools, or at
least <tt class="docutils literal">xgettext</tt> <a class="footnote-reference" href="#gettext" id="id8">[7]</a> in particular?</p>
</div>
<div class="section" id="references">
<h1><a class="toc-backref" href="#id22">References</a></h1>
<table class="docutils footnote" frame="void" id="orendorff" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[1]</td><td>Implicit String Concatenation, Orendorff
<a class="reference external" href="https://mail.python.org/pipermail/python-ideas/2007-April/000397.html">https://mail.python.org/pipermail/python-ideas/2007-April/000397.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="rcn-constantfold" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[2]</td><td><em>(<a class="fn-backref" href="#id1">1</a>, <a class="fn-backref" href="#id2">2</a>)</em> Reminder: Py3k PEPs due by April, Hettinger,
van Rossum
<a class="reference external" href="https://mail.python.org/pipermail/python-3000/2007-April/006563.html">https://mail.python.org/pipermail/python-3000/2007-April/006563.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="pep3101" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td><a class="reference external" href="/dev/peps/pep-3101">PEP 3101</a>, Advanced String Formatting, Talin
<a class="reference external" href="http://www.python.org/dev/peps/pep-3101/">http://www.python.org/dev/peps/pep-3101/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="elimpercent" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[4]</a></td><td>ps to question Re: Need help completing ABC pep,
van Rossum
<a class="reference external" href="https://mail.python.org/pipermail/python-3000/2007-April/006737.html">https://mail.python.org/pipermail/python-3000/2007-April/006737.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="skipsql" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[5]</a></td><td>(email Subject) PEP 30XZ: Simplified Parsing, Skip,
<a class="reference external" href="https://mail.python.org/pipermail/python-3000/2007-May/007261.html">https://mail.python.org/pipermail/python-3000/2007-May/007261.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="barryi8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[6]</a></td><td>(email Subject) PEP 30XZ: Simplified Parsing
<a class="reference external" href="https://mail.python.org/pipermail/python-3000/2007-May/007305.html">https://mail.python.org/pipermail/python-3000/2007-May/007305.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="gettext" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id8">[7]</a></td><td>GNU gettext manual
<a class="reference external" href="http://www.gnu.org/software/gettext/">http://www.gnu.org/software/gettext/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="xgettext2048" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[8]</a></td><td>Unix man page for xgettext -- Notes section
<a class="reference external" href="http://www.scit.wlv.ac.uk/cgi-bin/mansec?1+xgettext">http://www.scit.wlv.ac.uk/cgi-bin/mansec?1+xgettext</a></td></tr>
</tbody>
</table>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id23">Copyright</a></h1>
<blockquote>
This document has been placed in the public domain.</blockquote>
<!-- Local Variables:
mode: indented-text
indent-tabs-mode: nil
sentence-end-double-space: t
fill-column: 70
coding: utf-8
End: -->
</div>

