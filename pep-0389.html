<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">PEP:</th><td class="field-body">389</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">argparse - New Command Line Parsing Module</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">$Revision$</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference external" href="https://hg.python.org/peps/file/tip/pep-0389.txt">$Date$</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">Steven Bethard &lt;steven.bethard&#32;&#97;t&#32;gmail.com&gt;</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Final</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Standards Track</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference external" href="/dev/peps/pep-0012">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">25-Sep-2009</td>
</tr>
<tr class="field"><th class="field-name">Python-Version:</th><td class="field-body">2.7 and 3.2</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body">27-Sep-2009, 24-Oct-2009</td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#acceptance" id="id36">Acceptance</a></li>
<li><a class="reference internal" href="#abstract" id="id37">Abstract</a></li>
<li><a class="reference internal" href="#motivation" id="id38">Motivation</a></li>
<li><a class="reference internal" href="#why-aren-t-getopt-and-optparse-enough" id="id39">Why aren't getopt and optparse enough?</a></li>
<li><a class="reference internal" href="#why-isn-t-the-functionality-just-being-added-to-optparse" id="id40">Why isn't the functionality just being added to optparse?</a></li>
<li><a class="reference internal" href="#deprecation-of-optparse" id="id41">Deprecation of optparse</a></li>
<li><a class="reference internal" href="#updates-to-getopt-documentation" id="id42">Updates to getopt documentation</a></li>
<li><a class="reference internal" href="#deferred-string-formatting" id="id43">Deferred: string formatting</a></li>
<li><a class="reference internal" href="#rejected-getopt-compatibility-methods" id="id44">Rejected: getopt compatibility methods</a></li>
<li><a class="reference internal" href="#out-of-scope-various-feature-requests" id="id45">Out of Scope: Various Feature Requests</a></li>
<li><a class="reference internal" href="#discussion-sys-stderr-and-sys-exit" id="id46">Discussion: sys.stderr and sys.exit</a></li>
<li><a class="reference internal" href="#references" id="id47">References</a></li>
<li><a class="reference internal" href="#copyright" id="id48">Copyright</a></li>
</ul>
</div>
<div class="section" id="acceptance">
<h1><a class="toc-backref" href="#id36">Acceptance</a></h1>
<p>This PEP was approved by Guido on python-dev on February 21, 2010 <a class="footnote-reference" href="#id35" id="id1">[17]</a>.</p>
</div>
<div class="section" id="abstract">
<h1><a class="toc-backref" href="#id37">Abstract</a></h1>
<p>This PEP proposes inclusion of the argparse <a class="footnote-reference" href="#id18" id="id2">[1]</a> module in the Python
standard library in Python 2.7 and 3.2.</p>
</div>
<div class="section" id="motivation">
<h1><a class="toc-backref" href="#id38">Motivation</a></h1>
<p>The argparse module is a command line parsing library which provides
more functionality than the existing command line parsing modules in
the standard library, getopt <a class="footnote-reference" href="#id19" id="id3">[2]</a> and optparse <a class="footnote-reference" href="#id20" id="id4">[3]</a>. It includes
support for positional arguments (not just options), subcommands,
required options, options syntaxes like &quot;/f&quot; and &quot;+rgb&quot;, zero-or-more
and one-or-more style arguments, and many other features the other
two lack.</p>
<p>The argparse module is also already a popular third-party replacement
for these modules. It is used in projects like IPython (the Scipy
Python shell) <a class="footnote-reference" href="#id21" id="id5">[4]</a>, is included in Debian testing and unstable <a class="footnote-reference" href="#id22" id="id6">[5]</a>,
and since 2007 has had various requests for its inclusion in the
standard library <a class="footnote-reference" href="#id23" id="id7">[6]</a> <a class="footnote-reference" href="#id24" id="id8">[7]</a> <a class="footnote-reference" href="#id25" id="id9">[8]</a>. This popularity suggests it may be
a valuable addition to the Python libraries.</p>
</div>
<div class="section" id="why-aren-t-getopt-and-optparse-enough">
<h1><a class="toc-backref" href="#id39">Why aren't getopt and optparse enough?</a></h1>
<p>One argument against adding argparse is that thare are &quot;already two
different option parsing modules in the standard library&quot; <a class="footnote-reference" href="#id26" id="id10">[9]</a>. The
following is a list of features provided by argparse but not present
in getopt or optparse:</p>
<ul class="simple">
<li>While it is true there are two <em>option</em> parsing libraries, there
are no full command line parsing libraries -- both getopt and
optparse support only options and have no support for positional
arguments. The argparse module handles both, and as a result, is
able to generate better help messages, avoiding redundancies like
the <tt class="docutils literal">usage=</tt> string usually required by optparse.</li>
<li>The argparse module values practicality over purity. Thus, argparse
allows required options and customization of which characters are
used to identify options, while optparse explicitly states &quot;the
phrase 'required option' is self-contradictory&quot; and that the option
syntaxes <tt class="docutils literal"><span class="pre">-pf</span></tt>, <tt class="docutils literal"><span class="pre">-file</span></tt>, <tt class="docutils literal">+f</tt>, <tt class="docutils literal">+rgb</tt>, <tt class="docutils literal">/f</tt> and <tt class="docutils literal">/file</tt>
&quot;are not supported by optparse, and they never will be&quot;.</li>
<li>The argparse module allows options to accept a variable number of
arguments using <tt class="docutils literal"><span class="pre">nargs='?'</span></tt>, <tt class="docutils literal"><span class="pre">nargs='*'</span></tt> or <tt class="docutils literal"><span class="pre">nargs='+'</span></tt>. The
optparse module provides an untested recipe for some part of this
functionality <a class="footnote-reference" href="#id28" id="id11">[10]</a> but admits that &quot;things get hairy when you want
an option to take a variable number of arguments.&quot;</li>
<li>The argparse module supports subcommands, where a main command
line parser dispatches to other command line parsers depending on
the command line arguments. This is a common pattern in command
line interfaces, e.g. <tt class="docutils literal">svn co</tt> and <tt class="docutils literal">svn up</tt>.</li>
</ul>
</div>
<div class="section" id="why-isn-t-the-functionality-just-being-added-to-optparse">
<h1><a class="toc-backref" href="#id40">Why isn't the functionality just being added to optparse?</a></h1>
<p>Clearly all the above features offer improvements over what is
available through optparse. A reasonable question then is why these
features are not simply provided as patches to optparse, instead of
introducing an entirely new module. In fact, the original development
of argparse intended to do just that, but because of various fairly
constraining design decisions of optparse, this wasn't really
possible. Some of the problems included:</p>
<ul>
<li><p class="first">The optparse module exposes the internals of its parsing algorithm.
In particular, <tt class="docutils literal">parser.largs</tt> and <tt class="docutils literal">parser.rargs</tt> are guaranteed
to be available to callbacks <a class="footnote-reference" href="#id29" id="id12">[11]</a>. This makes it extremely
difficult to improve the parsing algorithm as was necessary in
argparse for proper handling of positional arguments and variable
length arguments. For example, <tt class="docutils literal"><span class="pre">nargs='+'</span></tt> in argparse is matched
using regular expressions and thus has no notion of things like
<tt class="docutils literal">parser.largs</tt>.</p>
</li>
<li><p class="first">The optparse extension APIs are extremely complex. For example,
just to use a simple custom string-to-object conversion function,
you have to subclass <tt class="docutils literal">Option</tt>, hack class attributes, and then
specify your custom option type to the parser, like this:</p>
<pre class="literal-block">
class MyOption(Option):
    TYPES = Option.TYPES + (&quot;mytype&quot;,)
    TYPE_CHECKER = copy(Option.TYPE_CHECKER)
    TYPE_CHECKER[&quot;mytype&quot;] = check_mytype
parser = optparse.OptionParser(option_class=MyOption)
parser.add_option(&quot;-m&quot;, type=&quot;mytype&quot;)
</pre>
<p>For comparison, argparse simply allows conversion functions to be
used as <tt class="docutils literal">type=</tt> arguments directly, e.g.:</p>
<pre class="literal-block">
parser = argparse.ArgumentParser()
parser.add_option(&quot;-m&quot;, type=check_mytype)
</pre>
<p>But given the baroque customization APIs of optparse, it is unclear
how such a feature should interact with those APIs, and it is
quite possible that introducing the simple argparse API would break
existing custom Option code.</p>
</li>
<li><p class="first">Both optparse and argparse parse command line arguments and assign
them as attributes to an object returned by <tt class="docutils literal">parse_args</tt>.
However, the optparse module guarantees that the <tt class="docutils literal">take_action</tt>
method of custom actions will always be passed a <tt class="docutils literal">values</tt> object
which provides an <tt class="docutils literal">ensure_value</tt> method <a class="footnote-reference" href="#id30" id="id13">[12]</a>, while the argparse
module allows attributes to be assigned to any object, e.g.:</p>
<pre class="literal-block">
foo_object = ...
parser.parse_args(namespace=foo_object)
foo_object.some_attribute_parsed_from_command_line
</pre>
<p>Modifying optparse to allow any object to be passed in would be
difficult because simply passing the <tt class="docutils literal">foo_object</tt> around instead
of a <tt class="docutils literal">Values</tt> instance will break existing custom actions that
depend on the <tt class="docutils literal">ensure_value</tt> method.</p>
</li>
</ul>
<p>Because of issues like these, which made it unreasonably difficult
for argparse to stay compatible with the optparse APIs, argparse was
developed as an independent module. Given these issues, merging all
the argparse features into optparse with no backwards
incompatibilities seems unlikely.</p>
</div>
<div class="section" id="deprecation-of-optparse">
<h1><a class="toc-backref" href="#id41">Deprecation of optparse</a></h1>
<p>Because all of optparse's features are available in argparse, the
optparse module will be deprecated. However, because of the
widespread use of optparse, the deprecation strategy contains only
documentation changes and warnings that will not be visible by
default:</p>
<ul>
<li><p class="first">Python 2.7+ and 3.2+ -- The following note will be added to the
optparse documentation:</p>
<blockquote>
<p>The optparse module is deprecated and will not be developed
further; development will continue with the argparse module.</p>
</blockquote>
</li>
<li><p class="first">Python 2.7+ -- If the Python 3 compatibility flag, <tt class="docutils literal"><span class="pre">-3</span></tt>, is
provided at the command line, then importing optparse will issue a
DeprecationWarning. Otherwise no warnings will be issued.</p>
</li>
<li><p class="first">Python 3.2+ -- Importing optparse will issue a
PendingDeprecationWarning, which is not displayed by default.</p>
</li>
</ul>
<p>Note that no removal date is proposed for optparse.</p>
</div>
<div class="section" id="updates-to-getopt-documentation">
<h1><a class="toc-backref" href="#id42">Updates to getopt documentation</a></h1>
<p>The getopt module will not be deprecated. However, its documentation
will be updated to point to argparse in a couple of places. At the
top of the module, the following note will be added:</p>
<blockquote>
The getopt module is a parser for command line options whose API
is designed to be familiar to users of the C getopt function.
Users who are unfamiliar with the C getopt function or who would
like to write less code and get better help and error messages
should consider using the argparse module instead.</blockquote>
<p>Additionally, after the final getopt example, the following note will
be added:</p>
<blockquote>
<p>Note that an equivalent command line interface could be produced
with less code by using the argparse module:</p>
<pre class="literal-block">
import argparse

if __name__ == '__main__':
    parser = argparse.ArgumentParser()
    parser.add_argument('-o', '--output')
    parser.add_argument('-v', dest='verbose', action='store_true')
    args = parser.parse_args()
    # ... do something with args.output ...
    # ... do something with args.verbose ..
</pre>
</blockquote>
</div>
<div class="section" id="deferred-string-formatting">
<h1><a class="toc-backref" href="#id43">Deferred: string formatting</a></h1>
<p>The argparse module supports Python from 2.3 up through 3.2 and as a
result relies on traditional <tt class="docutils literal">%(foo)s</tt> style string formatting. It
has been suggested that it might be better to use the new style
<tt class="docutils literal">{foo}</tt> string formatting <a class="footnote-reference" href="#id31" id="id14">[13]</a>. There was some discussion about
how best to do this for modules in the standard library <a class="footnote-reference" href="#id32" id="id15">[14]</a> and
several people are developing functions for automatically converting
%-formatting to {}-formatting <a class="footnote-reference" href="#id33" id="id16">[15]</a> <a class="footnote-reference" href="#id34" id="id17">[16]</a>. When one of these is added
to the standard library, argparse will use them to support both
formatting styles.</p>
</div>
<div class="section" id="rejected-getopt-compatibility-methods">
<h1><a class="toc-backref" href="#id44">Rejected: getopt compatibility methods</a></h1>
<p>Previously, when this PEP was suggesting the deprecation of getopt
as well as optparse, there was some talk of adding a method like:</p>
<pre class="literal-block">
ArgumentParser.add_getopt_arguments(options[, long_options])
</pre>
<p>However, this method will not be added for a number of reasons:</p>
<ul class="simple">
<li>The getopt module is not being deprecated, so there is less need.</li>
<li>This method would not actually ease the transition for any getopt
users who were already maintaining usage messages, because the API
above gives no way of adding help messages to the arguments.</li>
<li>Some users of getopt consider it very important that only a single
function call is necessary. The API above does not satisfy this
requirement because both <tt class="docutils literal">ArgumentParser()</tt> and <tt class="docutils literal">parse_args()</tt>
must also be called.</li>
</ul>
</div>
<div class="section" id="out-of-scope-various-feature-requests">
<h1><a class="toc-backref" href="#id45">Out of Scope: Various Feature Requests</a></h1>
<p>Several feature requests for argparse were made in the discussion of
this PEP:</p>
<ul class="simple">
<li>Support argument defaults from environment variables</li>
<li>Support argument defaults from configuration files</li>
<li>Support &quot;foo --help subcommand&quot; in addition to the currently
supported &quot;foo subcommand --help&quot;</li>
</ul>
<p>These are all reasonable feature requests for the argparse module,
but are out of the scope of this PEP, and have been redirected to
the argparse issue tracker.</p>
</div>
<div class="section" id="discussion-sys-stderr-and-sys-exit">
<h1><a class="toc-backref" href="#id46">Discussion: sys.stderr and sys.exit</a></h1>
<p>There were some concerns that argparse by default always writes to
<tt class="docutils literal">sys.stderr</tt> and always calls <tt class="docutils literal">sys.exit</tt> when invalid arguments
are provided. This is the desired behavior for the vast majority of
argparse use cases which revolve around simple command line
interfaces. However, in some cases, it may be desirable to keep
argparse from exiting, or to have it write its messages to something
other than <tt class="docutils literal">sys.stderr</tt>. These use cases can be supported by
subclassing <tt class="docutils literal">ArgumentParser</tt> and overriding the <tt class="docutils literal">exit</tt> or
<tt class="docutils literal">_print_message</tt> methods. The latter is an undocumented
implementation detail, but could be officially exposed if this turns
out to be a common need.</p>
</div>
<div class="section" id="references">
<h1><a class="toc-backref" href="#id47">References</a></h1>
<table class="docutils footnote" frame="void" id="id18" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[1]</a></td><td>argparse
(<a class="reference external" href="http://code.google.com/p/argparse/">http://code.google.com/p/argparse/</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id19" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[2]</a></td><td>getopt
(<a class="reference external" href="http://docs.python.org/library/getopt.html">http://docs.python.org/library/getopt.html</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id20" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[3]</a></td><td>optparse
(<a class="reference external" href="http://docs.python.org/library/optparse.html">http://docs.python.org/library/optparse.html</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id21" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[4]</a></td><td>argparse in IPython
(<a class="reference external" href="http://mail.scipy.org/pipermail/ipython-dev/2009-April/005102.html">http://mail.scipy.org/pipermail/ipython-dev/2009-April/005102.html</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id22" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[5]</a></td><td>argparse in Debian
(<a class="reference external" href="http://packages.debian.org/search?keywords=argparse">http://packages.debian.org/search?keywords=argparse</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id23" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[6]</td><td><em>(<a class="fn-backref" href="#id7">1</a>, <a class="fn-backref" href="#id27">2</a>)</em> 2007-01-03 request for argparse in the standard library
(<a class="reference external" href="https://mail.python.org/pipermail/python-list/2007-January/472276.html">https://mail.python.org/pipermail/python-list/2007-January/472276.html</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id24" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id8">[7]</a></td><td>2009-06-09 request for argparse in the standard library
(<a class="reference external" href="http://bugs.python.org/issue6247">http://bugs.python.org/issue6247</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id25" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id9">[8]</a></td><td>2009-09-10 request for argparse in the standard library
(<a class="reference external" href="https://mail.python.org/pipermail/stdlib-sig/2009-September/000342.html">https://mail.python.org/pipermail/stdlib-sig/2009-September/000342.html</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id26" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id10">[9]</a></td><td>Fredrik Lundh response to <a class="footnote-reference" href="#id23" id="id27">[6]</a>
(<a class="reference external" href="https://mail.python.org/pipermail/python-list/2007-January/1086892.html">https://mail.python.org/pipermail/python-list/2007-January/1086892.html</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id28" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id11">[10]</a></td><td>optparse variable args
(<a class="reference external" href="http://docs.python.org/library/optparse.html#callback-example-6-variable-arguments">http://docs.python.org/library/optparse.html#callback-example-6-variable-arguments</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id29" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id12">[11]</a></td><td>parser.largs and parser.rargs
(<a class="reference external" href="http://docs.python.org/library/optparse.html#how-callbacks-are-called">http://docs.python.org/library/optparse.html#how-callbacks-are-called</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id30" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id13">[12]</a></td><td>take_action values argument
(<a class="reference external" href="http://docs.python.org/library/optparse.html#adding-new-actions">http://docs.python.org/library/optparse.html#adding-new-actions</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id31" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id14">[13]</a></td><td>use {}-formatting instead of %-formatting
(<a class="reference external" href="http://bugs.python.org/msg89279">http://bugs.python.org/msg89279</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id32" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id15">[14]</a></td><td>transitioning from % to {} formatting
(<a class="reference external" href="https://mail.python.org/pipermail/python-dev/2009-September/092326.html">https://mail.python.org/pipermail/python-dev/2009-September/092326.html</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id33" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id16">[15]</a></td><td>Vinay Sajip's %-to-{} converter
(<a class="reference external" href="http://gist.github.com/200936">http://gist.github.com/200936</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id34" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id17">[16]</a></td><td>Benjamin Peterson's %-to-{} converter
(<a class="reference external" href="http://bazaar.launchpad.net/~gutworth/+junk/mod2format/files">http://bazaar.launchpad.net/~gutworth/+junk/mod2format/files</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id35" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[17]</a></td><td>Guido's approval
(<a class="reference external" href="https://mail.python.org/pipermail/python-dev/2010-February/097839.html">https://mail.python.org/pipermail/python-dev/2010-February/097839.html</a>)</td></tr>
</tbody>
</table>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id48">Copyright</a></h1>
<p>This document has been placed in the public domain.</p>
<!-- Local Variables:
mode: indented-text
indent-tabs-mode: nil
sentence-end-double-space: t
fill-column: 70
coding: utf-8
End: -->
</div>

