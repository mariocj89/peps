<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">PEP:</th><td class="field-body">317</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">Eliminate Implicit Exception Instantiation</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">$Revision$</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference external" href="https://hg.python.org/peps/file/tip/pep-0317.txt">$Date$</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">Steven Taschuk &lt;staschuk&#32;&#97;t&#32;telusplanet.net&gt;</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Rejected</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Standards Track</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference external" href="/dev/peps/pep-0012">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">06-May-2003</td>
</tr>
<tr class="field"><th class="field-name">Python-Version:</th><td class="field-body">2.4</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body">09-Jun-2003</td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#abstract" id="id15">Abstract</a></li>
<li><a class="reference internal" href="#motivation" id="id16">Motivation</a><ul>
<li><a class="reference internal" href="#string-exceptions" id="id17">String Exceptions</a></li>
<li><a class="reference internal" href="#implicit-instantiation" id="id18">Implicit Instantiation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#specification" id="id19">Specification</a></li>
<li><a class="reference internal" href="#backwards-compatibility" id="id20">Backwards Compatibility</a><ul>
<li><a class="reference internal" href="#migration-plan" id="id21">Migration Plan</a><ul>
<li><a class="reference internal" href="#future-statement" id="id22">Future Statement</a></li>
<li><a class="reference internal" href="#warnings" id="id23">Warnings</a></li>
</ul>
</li>
<li><a class="reference internal" href="#examples" id="id24">Examples</a><ul>
<li><a class="reference internal" href="#code-using-implicit-instantiation" id="id25">Code Using Implicit Instantiation</a></li>
<li><a class="reference internal" href="#code-using-string-exceptions" id="id26">Code Using String Exceptions</a></li>
<li><a class="reference internal" href="#code-supplying-a-traceback-object" id="id27">Code Supplying a Traceback Object</a></li>
<li><a class="reference internal" href="#a-failure-of-the-plan" id="id28">A Failure of the Plan</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#rejection" id="id29">Rejection</a></li>
<li><a class="reference internal" href="#summary-of-discussion" id="id30">Summary of Discussion</a><ul>
<li><a class="reference internal" href="#new-style-exceptions" id="id31">New-Style Exceptions</a></li>
<li><a class="reference internal" href="#ugliness-of-explicit-instantiation" id="id32">Ugliness of Explicit Instantiation</a></li>
<li><a class="reference internal" href="#performance-penalty-of-warnings" id="id33">Performance Penalty of Warnings</a></li>
<li><a class="reference internal" href="#traceback-argument" id="id34">Traceback Argument</a></li>
</ul>
</li>
<li><a class="reference internal" href="#references" id="id35">References</a></li>
<li><a class="reference internal" href="#copyright" id="id36">Copyright</a></li>
</ul>
</div>
<div class="section" id="abstract">
<h1><a class="toc-backref" href="#id15">Abstract</a></h1>
<blockquote>
<p>&quot;For clarity in new code, the form <tt class="docutils literal">raise class(argument, <span class="pre">...)</span></tt>
is recommended (i.e. make an explicit call to the constructor).&quot;</p>
<p class="attribution">&mdash;Guido van Rossum, in 1997 <a class="footnote-reference" href="#id9" id="id1">[1]</a></p>
</blockquote>
<p>This PEP proposes the formal deprecation and eventual elimination of
forms of the <tt class="docutils literal">raise</tt> statement which implicitly instantiate an
exception.  For example, statements such as</p>
<pre class="literal-block">
raise HullBreachError
raise KitchenError, 'all out of baked beans'
</pre>
<p>must under this proposal be replaced with their synonyms</p>
<pre class="literal-block">
raise HullBreachError()
raise KitchenError('all out of baked beans')
</pre>
<p>Note that these latter statements are already legal, and that this PEP
does not change their meaning.</p>
<p>Eliminating these forms of <tt class="docutils literal">raise</tt> makes it impossible to use string
exceptions; accordingly, this PEP also proposes the formal deprecation
and eventual elimination of string exceptions.</p>
<p>Adoption of this proposal breaks backwards compatibility.  Under the
proposed implementation schedule, Python 2.4 will introduce warnings
about uses of <tt class="docutils literal">raise</tt> which will eventually become incorrect, and
Python 3.0 will eliminate them entirely.  (It is assumed that this
transition period -- 2.4 to 3.0 -- will be at least one year long, to
comply with the guidelines of <a class="reference external" href="/dev/peps/pep-0005">PEP 5</a> <a class="footnote-reference" href="#id10" id="id2">[2]</a>.)</p>
</div>
<div class="section" id="motivation">
<h1><a class="toc-backref" href="#id16">Motivation</a></h1>
<div class="section" id="string-exceptions">
<h2><a class="toc-backref" href="#id17">String Exceptions</a></h2>
<p>It is assumed that removing string exceptions will be uncontroversial,
since it has been intended since at least Python 1.5, when the
standard exception types were changed to classes <a class="footnote-reference" href="#id9" id="id3">[1]</a>.</p>
<p>For the record: string exceptions should be removed because the
presence of two kinds of exception complicates the language without
any compensation.  Instance exceptions are superior because, for
example,</p>
<ul class="simple">
<li>the class-instance relationship more naturally expresses the
relationship between the exception type and value,</li>
<li>they can be organized naturally using superclass-subclass
relationships, and</li>
<li>they can encapsulate error-reporting behaviour (for example).</li>
</ul>
</div>
<div class="section" id="implicit-instantiation">
<h2><a class="toc-backref" href="#id18">Implicit Instantiation</a></h2>
<p>Guido's 1997 essay <a class="footnote-reference" href="#id9" id="id4">[1]</a> on changing the standard exceptions into
classes makes clear why <tt class="docutils literal">raise</tt> can instantiate implicitly:</p>
<blockquote>
&quot;The raise statement has been extended to allow raising a class
exception without explicit instantiation. The following forms,
called the &quot;compatibility forms&quot; of the raise statement [...]  The
motivation for introducing the compatibility forms was to allow
backward compatibility with old code that raised a standard
exception.&quot;</blockquote>
<p>For example, it was desired that pre-1.5 code which used string
exception syntax such as</p>
<pre class="literal-block">
raise TypeError, 'not an int'
</pre>
<p>would work both on versions of Python in which <tt class="docutils literal">TypeError</tt> was a
string, and on versions in which it was a class.</p>
<p>When no such consideration obtains -- that is, when the desired
exception type is not a string in any version of the software which
the code must support -- there is no good reason to instantiate
implicitly, and it is clearer not to.  For example:</p>
<ol class="arabic">
<li><p class="first">In the code</p>
<pre class="literal-block">
try:
    raise MyError, raised
except MyError, caught:
    pass
</pre>
<p>the syntactic parallel between the <tt class="docutils literal">raise</tt> and <tt class="docutils literal">except</tt>
statements strongly suggests that <tt class="docutils literal">raised</tt> and <tt class="docutils literal">caught</tt> refer
to the same object.  For string exceptions this actually is the
case, but for instance exceptions it is not.</p>
</li>
<li><p class="first">When instantiation is implicit, it is not obvious when it occurs,
for example, whether it occurs when the exception is raised or when
it is caught.  Since it actually happens at the <tt class="docutils literal">raise</tt>, the code
should say so.</p>
<p>(Note that at the level of the C API, an exception can be &quot;raised&quot;
and &quot;caught&quot; without being instantiated; this is used as an
optimization by, for example, <tt class="docutils literal">PyIter_Next</tt>.  But in Python, no
such optimization is or should be available.)</p>
</li>
<li><p class="first">An implicitly instantiating <tt class="docutils literal">raise</tt> statement with no arguments,
such as</p>
<pre class="literal-block">
raise MyError
</pre>
<p>simply does not do what it says: it does not raise the named
object.</p>
</li>
<li><p class="first">The equivalence of</p>
<pre class="literal-block">
raise MyError
raise MyError()
</pre>
<p>conflates classes and instances, creating a possible source of
confusion for beginners.  (Moreover, it is not clear that the
interpreter could distinguish between a new-style class and an
instance of such a class, so implicit instantiation may be an
obstacle to any future plan to let exceptions be new-style
objects.)</p>
</li>
</ol>
<p>In short, implicit instantiation has no advantages other than
backwards compatibility, and so should be phased out along with what
it exists to ensure compatibility with, namely, string exceptions.</p>
</div>
</div>
<div class="section" id="specification">
<h1><a class="toc-backref" href="#id19">Specification</a></h1>
<p>The syntax of <tt class="docutils literal">raise_stmt</tt> <a class="footnote-reference" href="#id11" id="id5">[3]</a> is to be changed from</p>
<pre class="literal-block">
raise_stmt ::= &quot;raise&quot; [expression [&quot;,&quot; expression [&quot;,&quot; expression]]]
</pre>
<p>to</p>
<pre class="literal-block">
raise_stmt ::= &quot;raise&quot; [expression [&quot;,&quot; expression]]
</pre>
<p>If no expressions are present, the <tt class="docutils literal">raise</tt> statement behaves as it
does presently: it re-raises the last exception that was active in the
current scope, and if no exception has been active in the current
scope, a <tt class="docutils literal">TypeError</tt> is raised indicating that this is the problem.</p>
<p>Otherwise, the first expression is evaluated, producing the <em>raised
object</em>.  Then the second expression is evaluated, if present,
producing the <em>substituted traceback</em>.  If no second expression is
present, the substituted traceback is <tt class="docutils literal">None</tt>.</p>
<p>The raised object must be an instance.  The class of the instance is
the exception type, and the instance itself is the exception value.
If the raised object is not an instance -- for example, if it is a
class or string -- a <tt class="docutils literal">TypeError</tt> is raised.</p>
<p>If the substituted traceback is not <tt class="docutils literal">None</tt>, it must be a traceback
object, and it is substituted instead of the current location as the
place where the exception occurred.  If it is neither a traceback
object nor <tt class="docutils literal">None</tt>, a <tt class="docutils literal">TypeError</tt> is raised.</p>
</div>
<div class="section" id="backwards-compatibility">
<h1><a class="toc-backref" href="#id20">Backwards Compatibility</a></h1>
<div class="section" id="migration-plan">
<h2><a class="toc-backref" href="#id21">Migration Plan</a></h2>
<div class="section" id="future-statement">
<h3><a class="toc-backref" href="#id22">Future Statement</a></h3>
<p>Under the future statement <a class="footnote-reference" href="#id12" id="id6">[4]</a></p>
<pre class="literal-block">
from __future__ import raise_with_two_args
</pre>
<p>the syntax and semantics of the <tt class="docutils literal">raise</tt> statement will be as
described above.  This future feature is to appear in Python 2.4; its
effect is to become standard in Python 3.0.</p>
<p>As the examples below illustrate, this future statement is only needed
for code which uses the substituted traceback argument to <tt class="docutils literal">raise</tt>;
simple exception raising does not require it.</p>
</div>
<div class="section" id="warnings">
<h3><a class="toc-backref" href="#id23">Warnings</a></h3>
<p>Three new warnings <a class="footnote-reference" href="#id13" id="id7">[5]</a>, all of category <tt class="docutils literal">DeprecationWarning</tt>, are
to be issued to point out uses of <tt class="docutils literal">raise</tt> which will become
incorrect under the proposed changes.</p>
<p>The first warning is issued when a <tt class="docutils literal">raise</tt> statement is executed in
which the first expression evaluates to a string.  The message for
this warning is:</p>
<pre class="literal-block">
raising strings will be impossible in the future
</pre>
<p>The second warning is issued when a <tt class="docutils literal">raise</tt> statement is executed in
which the first expression evaluates to a class.  The message for this
warning is:</p>
<pre class="literal-block">
raising classes will be impossible in the future
</pre>
<p>The third warning is issued when a <tt class="docutils literal">raise</tt> statement with three
expressions is compiled.  (Not, note, when it is executed; this is
important because the <tt class="docutils literal">SyntaxError</tt> which this warning presages will
occur at compile-time.)  The message for this warning is:</p>
<pre class="literal-block">
raising with three arguments will be impossible in the future
</pre>
<p>These warnings are to appear in Python 2.4, and disappear in Python
3.0, when the conditions which cause them are simply errors.</p>
</div>
</div>
<div class="section" id="examples">
<h2><a class="toc-backref" href="#id24">Examples</a></h2>
<div class="section" id="code-using-implicit-instantiation">
<h3><a class="toc-backref" href="#id25">Code Using Implicit Instantiation</a></h3>
<p>Code such as</p>
<pre class="literal-block">
class MyError(Exception):
    pass

raise MyError, 'spam'
</pre>
<p>will issue a warning when the <tt class="docutils literal">raise</tt> statement is executed.  The
<tt class="docutils literal">raise</tt> statement should be changed to instantiate explicitly:</p>
<pre class="literal-block">
raise MyError('spam')
</pre>
</div>
<div class="section" id="code-using-string-exceptions">
<h3><a class="toc-backref" href="#id26">Code Using String Exceptions</a></h3>
<p>Code such as</p>
<pre class="literal-block">
MyError = 'spam'
raise MyError, 'eggs'
</pre>
<p>will issue a warning when the <tt class="docutils literal">raise</tt> statement is executed.  The
exception type should be changed to a class:</p>
<pre class="literal-block">
class MyError(Exception):
    pass
</pre>
<p>and, as in the previous example, the <tt class="docutils literal">raise</tt> statement should be
changed to instantiate explicitly</p>
<pre class="literal-block">
raise MyError('eggs')
</pre>
</div>
<div class="section" id="code-supplying-a-traceback-object">
<h3><a class="toc-backref" href="#id27">Code Supplying a Traceback Object</a></h3>
<p>Code such as</p>
<pre class="literal-block">
raise MyError, 'spam', mytraceback
</pre>
<p>will issue a warning when compiled.  The statement should be changed
to</p>
<pre class="literal-block">
raise MyError('spam'), mytraceback
</pre>
<p>and the future statement</p>
<pre class="literal-block">
from __future__ import raise_with_two_args
</pre>
<p>should be added at the top of the module.  Note that adding this
future statement also turns the other two warnings into errors, so the
changes described in the previous examples must also be applied.</p>
<p>The special case</p>
<pre class="literal-block">
raise sys.exc_type, sys.exc_info, sys.exc_traceback
</pre>
<p>(which is intended to re-raise a previous exception) should be changed
simply to</p>
<pre class="literal-block">
raise
</pre>
</div>
<div class="section" id="a-failure-of-the-plan">
<h3><a class="toc-backref" href="#id28">A Failure of the Plan</a></h3>
<p>It may occur that a <tt class="docutils literal">raise</tt> statement which raises a string or
implicitly instantiates is not executed in production or testing
during the phase-in period for this PEP.  In that case, it will not
issue any warnings, but will instead suddenly fail one day in Python
3.0 or a subsequent version.  (The failure is that the wrong exception
gets raised, namely a <tt class="docutils literal">TypeError</tt> complaining about the arguments to
<tt class="docutils literal">raise</tt>, instead of the exception intended.)</p>
<p>Such cases can be made rarer by prolonging the phase-in period; they
cannot be made impossible short of issuing at compile-time a warning
for every <tt class="docutils literal">raise</tt> statement.</p>
</div>
</div>
</div>
<div class="section" id="rejection">
<h1><a class="toc-backref" href="#id29">Rejection</a></h1>
<p>If this PEP were accepted, nearly all existing Python code would need
to be reviewed and probably revised; even if all the above arguments
in favour of explicit instantiation are accepted, the improvement in
clarity is too minor to justify the cost of doing the revision and the
risk of new bugs introduced thereby.</p>
<p>This proposal has therefore been rejected <a class="footnote-reference" href="#id14" id="id8">[6]</a>.</p>
<p>Note that string exceptions are slated for removal independently of
this proposal; what is rejected is the removal of implicit exception
instantiation.</p>
</div>
<div class="section" id="summary-of-discussion">
<h1><a class="toc-backref" href="#id30">Summary of Discussion</a></h1>
<p>A small minority of respondents were in favour of the proposal, but
the dominant response was that any such migration would be costly
out of proportion to the putative benefit.  As noted above, this
point is sufficient in itself to reject the PEP.</p>
<div class="section" id="new-style-exceptions">
<h2><a class="toc-backref" href="#id31">New-Style Exceptions</a></h2>
<p>Implicit instantiation might conflict with future plans to allow
instances of new-style classes to be used as exceptions.  In order to
decide whether to instantiate implicitly, the <tt class="docutils literal">raise</tt> machinery must
determine whether the first argument is a class or an instance -- but
with new-style classes there is no clear and strong distinction.</p>
<p>Under this proposal, the problem would be avoided because the
exception would already have been instantiated.  However, there are
two plausible alternative solutions:</p>
<ol class="arabic">
<li><p class="first">Require exception types to be subclasses of <tt class="docutils literal">Exception</tt>, and
instantiate implicitly if and only if</p>
<pre class="literal-block">
issubclass(firstarg, Exception)
</pre>
</li>
<li><p class="first">Instantiate implicitly if and only if</p>
<pre class="literal-block">
isinstance(firstarg, type)
</pre>
</li>
</ol>
<p>Thus eliminating implicit instantiation entirely is not necessary to
solve this problem.</p>
</div>
<div class="section" id="ugliness-of-explicit-instantiation">
<h2><a class="toc-backref" href="#id32">Ugliness of Explicit Instantiation</a></h2>
<p>Some respondents felt that the explicitly instantiating syntax is
uglier, especially in cases when no arguments are supplied to the
exception constructor:</p>
<pre class="literal-block">
raise TypeError()
</pre>
<p>The problem is particularly acute when the exception instance itself
is not of interest, that is, when the only relevant point is the
exception type:</p>
<pre class="literal-block">
try:
    # ... deeply nested search loop ...
        raise Found
except Found:
    # ...
</pre>
<p>In such cases the symmetry between <tt class="docutils literal">raise</tt> and <tt class="docutils literal">except</tt> can be
more expressive of the intent of the code.</p>
<p>Guido opined that the implicitly instantiating syntax is &quot;a tad
prettier&quot; even for cases with a single argument, since it has less
punctuation.</p>
</div>
<div class="section" id="performance-penalty-of-warnings">
<h2><a class="toc-backref" href="#id33">Performance Penalty of Warnings</a></h2>
<p>Experience with deprecating <tt class="docutils literal">apply()</tt> shows that use of the warning
framework can incur a significant performance penalty.</p>
<p>Code which instantiates explicitly would not be affected, since the
run-time checks necessary to determine whether to issue a warning are
exactly those which are needed to determine whether to instantiate
implicitly in the first place.  That is, such statements are already
incurring the cost of these checks.</p>
<p>Code which instantiates implicitly would incur a large cost: timing
trials indicate that issuing a warning (whether it is suppressed or
not) takes about five times more time than simply instantiating,
raising, and catching an exception.</p>
<p>This penalty is mitigated by the fact that <tt class="docutils literal">raise</tt> statements are
rarely on performance-critical execution paths.</p>
</div>
<div class="section" id="traceback-argument">
<h2><a class="toc-backref" href="#id34">Traceback Argument</a></h2>
<p>As the proposal stands, it would be impossible to use the traceback
argument to <tt class="docutils literal">raise</tt> conveniently with all 2.x versions of Python.</p>
<p>For compatibility with versions &lt; 2.4, the three-argument form must be
used; but this form would produce warnings with versions &gt;= 2.4.
Those warnings could be suppressed, but doing so is awkward because
the relevant type of warning is issued at compile-time.</p>
<p>If this PEP were still under consideration, this objection would be
met by extending the phase-in period.  For example, warnings could
first be issued in 3.0, and become errors in some later release.</p>
</div>
</div>
<div class="section" id="references">
<h1><a class="toc-backref" href="#id35">References</a></h1>
<table class="docutils footnote" frame="void" id="id9" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[1]</td><td><em>(<a class="fn-backref" href="#id1">1</a>, <a class="fn-backref" href="#id3">2</a>, <a class="fn-backref" href="#id4">3</a>)</em> &quot;Standard Exception Classes in Python 1.5&quot;, Guido van Rossum.
<a class="reference external" href="http://www.python.org/doc/essays/stdexceptions.html">http://www.python.org/doc/essays/stdexceptions.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id10" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>&quot;Guidelines for Language Evolution&quot;, Paul Prescod.
<a class="reference external" href="http://www.python.org/dev/peps/pep-0005/">http://www.python.org/dev/peps/pep-0005/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id11" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[3]</a></td><td>&quot;Python Language Reference&quot;, Guido van Rossum.
<a class="reference external" href="http://docs.python.org/reference/simple_stmts.html#raise">http://docs.python.org/reference/simple_stmts.html#raise</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id12" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[4]</a></td><td><a class="reference external" href="/dev/peps/pep-0236">PEP 236</a> &quot;Back to the __future__&quot;, Tim Peters.
<a class="reference external" href="http://www.python.org/dev/peps/pep-0236/">http://www.python.org/dev/peps/pep-0236/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id13" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[5]</a></td><td><a class="reference external" href="/dev/peps/pep-0230">PEP 230</a> &quot;Warning Framework&quot;, Guido van Rossum.
<a class="reference external" href="http://www.python.org/dev/peps/pep-0230/">http://www.python.org/dev/peps/pep-0230/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id14" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id8">[6]</a></td><td>Guido van Rossum, 11 June 2003 post to <tt class="docutils literal"><span class="pre">python-dev</span></tt>.
<a class="reference external" href="https://mail.python.org/pipermail/python-dev/2003-June/036176.html">https://mail.python.org/pipermail/python-dev/2003-June/036176.html</a></td></tr>
</tbody>
</table>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id36">Copyright</a></h1>
<p>This document has been placed in the public domain.</p>
<!-- Local Variables:
mode: indented-text
indent-tabs-mode: nil
sentence-end-double-space: t
fill-column: 70
End: -->
</div>

