<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">PEP:</th><td class="field-body">259</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">Omit printing newline after newline</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">$Revision$</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference external" href="https://hg.python.org/peps/file/tip/pep-0259.txt">$Date$</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">guido&#32;&#97;t&#32;python.org (Guido van Rossum)</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Rejected</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Standards Track</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference external" href="/dev/peps/pep-0012">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">11-Jun-2001</td>
</tr>
<tr class="field"><th class="field-name">Python-Version:</th><td class="field-body">2.2</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body">11-Jun-2001</td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#abstract" id="id2">Abstract</a></li>
<li><a class="reference internal" href="#problem" id="id3">Problem</a></li>
<li><a class="reference internal" href="#proposed-solution" id="id4">Proposed Solution</a></li>
<li><a class="reference internal" href="#scope" id="id5">Scope</a></li>
<li><a class="reference internal" href="#risks" id="id6">Risks</a></li>
<li><a class="reference internal" href="#implementation" id="id7">Implementation</a></li>
<li><a class="reference internal" href="#rejected" id="id8">Rejected</a></li>
<li><a class="reference internal" href="#copyright" id="id9">Copyright</a></li>
</ul>
</div>
<div class="section" id="abstract">
<h1><a class="toc-backref" href="#id2">Abstract</a></h1>
<p>Currently, the <tt class="docutils literal">print</tt> statement always appends a newline, unless a
trailing comma is used.  This means that if we want to print data
that already ends in a newline, we get two newlines, unless
special precautions are taken.</p>
<p>I propose to skip printing the newline when it follows a newline
that came from data.</p>
<p>In order to avoid having to add yet another magic variable to file
objects, I propose to give the existing 'softspace' variable an
extra meaning: a negative value will mean &quot;the last data written
ended in a newline so no space <em>or</em> newline is required.&quot;</p>
</div>
<div class="section" id="problem">
<h1><a class="toc-backref" href="#id3">Problem</a></h1>
<p>When printing data that resembles the lines read from a file using
a simple loop, double-spacing occurs unless special care is taken:</p>
<pre class="literal-block">
&gt;&gt;&gt; for line in open(&quot;/etc/passwd&quot;).readlines():
... print line
...
root:x:0:0:root:/root:/bin/bash

bin:x:1:1:bin:/bin:

daemon:x:2:2:daemon:/sbin:

(etc.)

&gt;&gt;&gt;
</pre>
<p>While there are easy work-arounds, this is often noticed only
during testing and requires an extra edit-test roundtrip; the
fixed code is uglier and harder to maintain.</p>
</div>
<div class="section" id="proposed-solution">
<h1><a class="toc-backref" href="#id4">Proposed Solution</a></h1>
<p>In the <tt class="docutils literal">PRINT_ITEM</tt> opcode in <tt class="docutils literal">ceval.c</tt>, when a string object is
printed, a check is already made that looks at the last character
of that string.  Currently, if that last character is a whitespace
character other than space, the softspace flag is reset to zero;
this suppresses the space between two items if the first item is a
string ending in newline, tab, etc. (but not when it ends in a
space).  Otherwise the softspace flag is set to one.</p>
<p>The proposal changes this test slightly so that softspace is set
to:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">-1</span></tt> -- if the last object written is a string ending in a
newline</li>
<li><tt class="docutils literal">0</tt> -- if the last object written is a string ending in a
whitespace character that's neither space nor newline</li>
<li><tt class="docutils literal">1</tt> -- in all other cases (including the case when the last
object written is an empty string or not a string)</li>
</ul>
<p>Then, the <tt class="docutils literal">PRINT_NEWLINE</tt> opcode, printing of the newline is
suppressed if the value of softspace is negative; in any case the
softspace flag is reset to zero.</p>
</div>
<div class="section" id="scope">
<h1><a class="toc-backref" href="#id5">Scope</a></h1>
<p>This only affects printing of 8-bit strings.  It doesn't affect
Unicode, although that could be considered a bug in the Unicode
implementation.  It doesn't affect other objects whose string
representation happens to end in a newline character.</p>
</div>
<div class="section" id="risks">
<h1><a class="toc-backref" href="#id6">Risks</a></h1>
<p>This change breaks some existing code.  For example:</p>
<pre class="literal-block">
print &quot;Subject: PEP 259\n&quot;
print message_body
</pre>
<p>In current Python, this produces a blank line separating the
subject from the message body; with the proposed change, the body
begins immediately below the subject.  This is not very robust
code anyway; it is better written as:</p>
<pre class="literal-block">
print &quot;Subject: PEP 259&quot;
print
print message_body
</pre>
<p>In the test suite, only <tt class="docutils literal">test_StringIO</tt> (which explicitly tests for
this feature) breaks.</p>
</div>
<div class="section" id="implementation">
<h1><a class="toc-backref" href="#id7">Implementation</a></h1>
<p>A patch relative to current CVS is here:</p>
<pre class="literal-block">
http://sourceforge.net/tracker/index.php?func=detail&amp;aid=432183&amp;group_id=5470&amp;atid=305470
</pre>
</div>
<div class="section" id="rejected">
<h1><a class="toc-backref" href="#id8">Rejected</a></h1>
<p>The user community unanimously rejected this, so I won't pursue
this idea any further.  Frequently heard arguments against
included:</p>
<ul class="simple">
<li>It is likely to break thousands of CGI scripts.</li>
<li>Enough magic already (also: no more tinkering with 'print'
please).</li>
</ul>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id9">Copyright</a></h1>
<p>This document has been placed in the public domain.</p>
<!-- Local Variables:
mode: indented-text
indent-tabs-mode: nil
End: -->
</div>

