<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">PEP:</th><td class="field-body">461</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">Adding % formatting to bytes and bytearray</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">$Revision$</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference external" href="https://hg.python.org/peps/file/tip/pep-0461.txt">$Date$</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">Ethan Furman &lt;ethan&#32;&#97;t&#32;stoneleaf.us&gt;</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Final</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Standards Track</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference external" href="/dev/peps/pep-0012">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">2014-01-13</td>
</tr>
<tr class="field"><th class="field-name">Python-Version:</th><td class="field-body">3.5</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body">2014-01-14, 2014-01-15, 2014-01-17, 2014-02-22, 2014-03-25,
2014-03-27</td>
</tr>
<tr class="field"><th class="field-name">Resolution:</th><td class="field-body"><a class="reference external" href="https://mail.python.org/pipermail/python-dev/2014-March/133621.html">https://mail.python.org/pipermail/python-dev/2014-March/133621.html</a></td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#abstract" id="id19">Abstract</a></li>
<li><a class="reference internal" href="#rationale" id="id20">Rationale</a></li>
<li><a class="reference internal" href="#motivation" id="id21">Motivation</a></li>
<li><a class="reference internal" href="#proposed-semantics-for-bytes-and-bytearray-formatting" id="id22">Proposed semantics for <tt class="docutils literal">bytes</tt> and <tt class="docutils literal">bytearray</tt> formatting</a><ul>
<li><a class="reference internal" href="#interpolation" id="id23">%-interpolation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#compatibility-with-python-2" id="id24">Compatibility with Python 2</a></li>
<li><a class="reference internal" href="#proposed-variations" id="id25">Proposed variations</a></li>
<li><a class="reference internal" href="#objections" id="id26">Objections</a></li>
<li><a class="reference internal" href="#footnotes" id="id27">Footnotes</a></li>
<li><a class="reference internal" href="#copyright" id="id28">Copyright</a></li>
</ul>
</div>
<div class="section" id="abstract">
<h1><a class="toc-backref" href="#id19">Abstract</a></h1>
<p>This PEP proposes adding % formatting operations similar to Python 2's <tt class="docutils literal">str</tt>
type to <tt class="docutils literal">bytes</tt> and <tt class="docutils literal">bytearray</tt> <a class="footnote-reference" href="#id10" id="id1">[1]</a> <a class="footnote-reference" href="#id11" id="id2">[2]</a>.</p>
</div>
<div class="section" id="rationale">
<h1><a class="toc-backref" href="#id20">Rationale</a></h1>
<p>While interpolation is usually thought of as a string operation, there are
cases where interpolation on <tt class="docutils literal">bytes</tt> or <tt class="docutils literal">bytearrays</tt> make sense, and the
work needed to make up for this missing functionality detracts from the overall
readability of the code.</p>
</div>
<div class="section" id="motivation">
<h1><a class="toc-backref" href="#id21">Motivation</a></h1>
<p>With Python 3 and the split between <tt class="docutils literal">str</tt> and <tt class="docutils literal">bytes</tt>, one small but
important area of programming became slightly more difficult, and much more
painful -- wire format protocols <a class="footnote-reference" href="#id12" id="id3">[3]</a>.</p>
<p>This area of programming is characterized by a mixture of binary data and
ASCII compatible segments of text (aka ASCII-encoded text).  Bringing back a
restricted %-interpolation for <tt class="docutils literal">bytes</tt> and <tt class="docutils literal">bytearray</tt> will aid both in
writing new wire format code, and in porting Python 2 wire format code.</p>
<p>Common use-cases include <tt class="docutils literal">dbf</tt> and <tt class="docutils literal">pdf</tt> file formats, <tt class="docutils literal">email</tt>
formats, and <tt class="docutils literal">FTP</tt> and <tt class="docutils literal">HTTP</tt> communications, among many others.</p>
</div>
<div class="section" id="proposed-semantics-for-bytes-and-bytearray-formatting">
<h1><a class="toc-backref" href="#id22">Proposed semantics for <tt class="docutils literal">bytes</tt> and <tt class="docutils literal">bytearray</tt> formatting</a></h1>
<div class="section" id="interpolation">
<h2><a class="toc-backref" href="#id23">%-interpolation</a></h2>
<p>All the numeric formatting codes (<tt class="docutils literal">d</tt>, <tt class="docutils literal">i</tt>, <tt class="docutils literal">o</tt>, <tt class="docutils literal">u</tt>, <tt class="docutils literal">x</tt>, <tt class="docutils literal">X</tt>,
<tt class="docutils literal">e</tt>, <tt class="docutils literal">E</tt>, <tt class="docutils literal">f</tt>, <tt class="docutils literal">F</tt>, <tt class="docutils literal">g</tt>, <tt class="docutils literal">G</tt>, and any that are subsequently added
to Python 3) will be supported, and will work as they do for str, including
the padding, justification and other related modifiers (currently <tt class="docutils literal">#</tt>, <tt class="docutils literal">0</tt>,
<tt class="docutils literal">-</tt>, `` `` (space), and <tt class="docutils literal">+</tt> (plus any added to Python 3)).  The only
non-numeric codes allowed are <tt class="docutils literal">c</tt>, <tt class="docutils literal">b</tt>, <tt class="docutils literal">a</tt>, and <tt class="docutils literal">s</tt> (which is a
synonym for b).</p>
<p>For the numeric codes, the only difference between <tt class="docutils literal">str</tt> and <tt class="docutils literal">bytes</tt> (or
<tt class="docutils literal">bytearray</tt>) interpolation is that the results from these codes will be
ASCII-encoded text, not unicode.  In other words, for any numeric formatting
code <cite>%x</cite>:</p>
<pre class="literal-block">
b&quot;%x&quot; % val
</pre>
<p>is equivalent to:</p>
<pre class="literal-block">
(&quot;%x&quot; % val).encode(&quot;ascii&quot;)
</pre>
<p>Examples:</p>
<pre class="literal-block">
&gt;&gt;&gt; b'%4x' % 10
b'   a'

&gt;&gt;&gt; b'%#4x' % 10
' 0xa'

&gt;&gt;&gt; b'%04X' % 10
'000A'
</pre>
<p><tt class="docutils literal">%c</tt> will insert a single byte, either from an <tt class="docutils literal">int</tt> in range(256), or from
a <tt class="docutils literal">bytes</tt> argument of length 1, not from a <tt class="docutils literal">str</tt>.</p>
<p>Examples:</p>
<pre class="literal-block">
&gt;&gt;&gt; b'%c' % 48
b'0'

&gt;&gt;&gt; b'%c' % b'a'
b'a'
</pre>
<p><tt class="docutils literal">%b</tt> will insert a series of bytes.  These bytes are collected in one of two
ways:</p>
<ul class="simple">
<li>input type supports <tt class="docutils literal">Py_buffer</tt> <a class="footnote-reference" href="#id13" id="id4">[4]</a>?
use it to collect the necessary bytes</li>
<li>input type is something else?
use its <tt class="docutils literal">__bytes__</tt> method <a class="footnote-reference" href="#id14" id="id5">[5]</a> ; if there isn't one, raise a <tt class="docutils literal">TypeError</tt></li>
</ul>
<p>In particular, <tt class="docutils literal">%b</tt> will not accept numbers nor <tt class="docutils literal">str</tt>.  <tt class="docutils literal">str</tt> is rejected
as the string to bytes conversion requires an encoding, and we are refusing to
guess; numbers are rejected because:</p>
<ul class="simple">
<li>what makes a number is fuzzy (float? Decimal? Fraction? some user type?)</li>
<li>allowing numbers would lead to ambiguity between numbers and textual
representations of numbers (3.14 vs '3.14')</li>
<li>given the nature of wire formats, explicit is definitely better than implicit</li>
</ul>
<p><tt class="docutils literal">%s</tt> is included as a synonym for <tt class="docutils literal">%b</tt> for the sole purpose of making 2/3 code
bases easier to maintain.  Python 3 only code should use <tt class="docutils literal">%b</tt>.</p>
<p>Examples:</p>
<pre class="literal-block">
&gt;&gt;&gt; b'%b' % b'abc'
b'abc'

&gt;&gt;&gt; b'%b' % 'some string'.encode('utf8')
b'some string'

&gt;&gt;&gt; b'%b' % 3.14
Traceback (most recent call last):
...
TypeError: b'%b' does not accept 'float'

&gt;&gt;&gt; b'%b' % 'hello world!'
Traceback (most recent call last):
...
TypeError: b'%b' does not accept 'str'
</pre>
<p><tt class="docutils literal">%a</tt> will give the equivalent of
<tt class="docutils literal"><span class="pre">repr(some_obj).encode('ascii',</span> 'backslashreplace')</tt> on the interpolated
value.  Use cases include developing a new protocol and writing landmarks
into the stream; debugging data going into an existing protocol to see if
the problem is the protocol itself or bad data; a fall-back for a serialization
format; or any situation where defining <tt class="docutils literal">__bytes__</tt> would not be appropriate
but a readable/informative representation is needed <a class="footnote-reference" href="#id15" id="id6">[6]</a>.</p>
<p><tt class="docutils literal">%r</tt> is included as a synonym for <tt class="docutils literal">%a</tt> for the sole purpose of making 2/3
code bases easier to maintain.  Python 3 only code use <tt class="docutils literal">%a</tt> <a class="footnote-reference" href="#id16" id="id7">[7]</a>.</p>
<p>Examples:</p>
<pre class="literal-block">
&gt;&gt;&gt; b'%a' % 3.14
b'3.14'

&gt;&gt;&gt; b'%a' % b'abc'
b&quot;b'abc'&quot;

&gt;&gt;&gt; b'%a' % 'def'
b&quot;'def'&quot;
</pre>
</div>
</div>
<div class="section" id="compatibility-with-python-2">
<h1><a class="toc-backref" href="#id24">Compatibility with Python 2</a></h1>
<p>As noted above, <tt class="docutils literal">%s</tt> and <tt class="docutils literal">%r</tt> are being included solely to help ease
migration from, and/or have a single code base with, Python 2.  This is
important as there are modules both in the wild and behind closed doors that
currently use the Python 2 <tt class="docutils literal">str</tt> type as a <tt class="docutils literal">bytes</tt> container, and hence
are using <tt class="docutils literal">%s</tt> as a bytes interpolator.</p>
<p>However, <tt class="docutils literal">%b</tt> and <tt class="docutils literal">%a</tt> should be used in new, Python 3 only code, so <tt class="docutils literal">%s</tt>
and <tt class="docutils literal">%r</tt> will immediately be deprecated, but not removed from the 3.x series
<a class="footnote-reference" href="#id16" id="id8">[7]</a>.</p>
</div>
<div class="section" id="proposed-variations">
<h1><a class="toc-backref" href="#id25">Proposed variations</a></h1>
<p>It has been proposed to automatically use <tt class="docutils literal"><span class="pre">.encode('ascii','strict')</span></tt> for
<tt class="docutils literal">str</tt> arguments to <tt class="docutils literal">%b</tt>.</p>
<ul class="simple">
<li>Rejected as this would lead to intermittent failures.  Better to have the
operation always fail so the trouble-spot can be correctly fixed.</li>
</ul>
<p>It has been proposed to have <tt class="docutils literal">%b</tt> return the ascii-encoded repr when the
value is a <tt class="docutils literal">str</tt> (b'%b' % 'abc'  --&gt; b&quot;'abc'&quot;).</p>
<ul class="simple">
<li>Rejected as this would lead to hard to debug failures far from the problem
site.  Better to have the operation always fail so the trouble-spot can be
easily fixed.</li>
</ul>
<p>Originally this PEP also proposed adding format-style formatting, but it was
decided that format and its related machinery were all strictly text (aka
<tt class="docutils literal">str</tt>) based, and it was dropped.</p>
<p>Various new special methods were proposed, such as <tt class="docutils literal">__ascii__</tt>,
<tt class="docutils literal">__format_bytes__</tt>, etc.; such methods are not needed at this time, but can
be visited again later if real-world use shows deficiencies with this solution.</p>
<p>A competing PEP, <tt class="docutils literal">PEP 460 Add binary interpolation and formatting</tt> <a class="footnote-reference" href="#id17" id="id9">[8]</a>,
also exists.</p>
</div>
<div class="section" id="objections">
<h1><a class="toc-backref" href="#id26">Objections</a></h1>
<p>The objections raised against this PEP were mainly variations on two themes:</p>
<ul class="simple">
<li>the <tt class="docutils literal">bytes</tt> and <tt class="docutils literal">bytearray</tt> types are for pure binary data, with no
assumptions about encodings</li>
<li>offering %-interpolation that assumes an ASCII encoding will be an
attractive nuisance and lead us back to the problems of the Python 2
<tt class="docutils literal">str</tt>/<tt class="docutils literal">unicode</tt> text model</li>
</ul>
<p>As was seen during the discussion, <tt class="docutils literal">bytes</tt> and <tt class="docutils literal">bytearray</tt> are also used
for mixed binary data and ASCII-compatible segments: file formats such as
<tt class="docutils literal">dbf</tt> and <tt class="docutils literal">pdf</tt>, network protocols such as <tt class="docutils literal">ftp</tt> and <tt class="docutils literal">email</tt>, etc.</p>
<p><tt class="docutils literal">bytes</tt> and <tt class="docutils literal">bytearray</tt> already have several methods which assume an ASCII
compatible encoding.  <tt class="docutils literal">upper()</tt>, <tt class="docutils literal">isalpha()</tt>, and <tt class="docutils literal">expandtabs()</tt> to name
just a few.  %-interpolation, with its very restricted mini-language, will not
be any more of a nuisance than the already existing methods.</p>
<p>Some have objected to allowing the full range of numeric formatting codes with
the claim that decimal alone would be sufficient.  However, at least two
formats (dbf and pdf) make use of non-decimal numbers.</p>
</div>
<div class="section" id="footnotes">
<h1><a class="toc-backref" href="#id27">Footnotes</a></h1>
<table class="docutils footnote" frame="void" id="id10" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="http://docs.python.org/2/library/stdtypes.html#string-formatting">http://docs.python.org/2/library/stdtypes.html#string-formatting</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id11" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>neither string.Template, format, nor str.format are under consideration</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id12" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td><a class="reference external" href="https://mail.python.org/pipermail/python-dev/2014-January/131518.html">https://mail.python.org/pipermail/python-dev/2014-January/131518.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id13" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[4]</a></td><td><a class="reference external" href="http://docs.python.org/3/c-api/buffer.html">http://docs.python.org/3/c-api/buffer.html</a>
examples:  <tt class="docutils literal">memoryview</tt>, <tt class="docutils literal">array.array</tt>, <tt class="docutils literal">bytearray</tt>, <tt class="docutils literal">bytes</tt></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id14" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[5]</a></td><td><a class="reference external" href="http://docs.python.org/3/reference/datamodel.html#object.__bytes__">http://docs.python.org/3/reference/datamodel.html#object.__bytes__</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id15" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[6]</a></td><td><a class="reference external" href="https://mail.python.org/pipermail/python-dev/2014-February/132750.html">https://mail.python.org/pipermail/python-dev/2014-February/132750.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id16" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[7]</td><td><em>(<a class="fn-backref" href="#id7">1</a>, <a class="fn-backref" href="#id8">2</a>)</em> <a class="reference external" href="http://bugs.python.org/issue23467">http://bugs.python.org/issue23467</a> -- originally <tt class="docutils literal">%r</tt> was not allowed,
but was added for consistency during the 3.5 alpha stage.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id17" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id9">[8]</a></td><td><a class="reference external" href="http://python.org/dev/peps/pep-0460/">http://python.org/dev/peps/pep-0460/</a></td></tr>
</tbody>
</table>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id28">Copyright</a></h1>
<p>This document has been placed in the public domain.</p>
<!-- Local Variables:
mode: indented-text
indent-tabs-mode: nil
sentence-end-double-space: t
fill-column: 70
coding: utf-8
End: -->
</div>

