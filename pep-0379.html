<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">PEP:</th><td class="field-body">379</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">Adding an Assignment Expression</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">$Revision$</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference external" href="https://hg.python.org/peps/file/tip/pep-0379.txt">$Date$</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">Jervis Whitley &lt;jervisau&#32;&#97;t&#32;gmail.com&gt;</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Withdrawn</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Standards Track</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference external" href="/dev/peps/pep-0012">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">14-Mar-2009</td>
</tr>
<tr class="field"><th class="field-name">Python-Version:</th><td class="field-body">2.7, 3.2</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#abstract" id="id3">Abstract</a></li>
<li><a class="reference internal" href="#motivation-and-summary" id="id4">Motivation and Summary</a></li>
<li><a class="reference internal" href="#use-cases" id="id5">Use Cases</a></li>
<li><a class="reference internal" href="#specification" id="id6">Specification</a></li>
<li><a class="reference internal" href="#examples-from-the-standard-library" id="id7">Examples from the Standard Library</a></li>
<li><a class="reference internal" href="#examples" id="id8">Examples</a></li>
<li><a class="reference internal" href="#references" id="id9">References</a></li>
<li><a class="reference internal" href="#copyright" id="id10">Copyright</a></li>
</ul>
</div>
<div class="section" id="abstract">
<h1><a class="toc-backref" href="#id3">Abstract</a></h1>
<p>This PEP adds a new assignment expression to the Python language
to make it possible to assign the result of an expression in
almost any place.  The new expression will allow the assignment of
the result of an expression at first use (in a comparison for
example).</p>
</div>
<div class="section" id="motivation-and-summary">
<h1><a class="toc-backref" href="#id4">Motivation and Summary</a></h1>
<p>Issue1714448 &quot;if something as x:&quot; <a class="footnote-reference" href="#id2" id="id1">[1]</a> describes a feature to allow
assignment of the result of an expression in an if statement to a
name.  It supposed that the <tt class="docutils literal">as</tt> syntax could be borrowed for this
purpose.  Many times it is not the expression itself that is
interesting, rather one of the terms that make up the
expression. To be clear, something like this:</p>
<pre class="literal-block">
if (f_result() == [1, 2, 3]) as res:
</pre>
<p>seems awfully limited, when this:</p>
<pre class="literal-block">
if (f_result() as res) == [1, 2, 3]:
</pre>
<p>is probably the desired result.</p>
</div>
<div class="section" id="use-cases">
<h1><a class="toc-backref" href="#id5">Use Cases</a></h1>
<p>See the Examples section near the end.</p>
</div>
<div class="section" id="specification">
<h1><a class="toc-backref" href="#id6">Specification</a></h1>
<p>A new expression is proposed with the (nominal) syntax:</p>
<pre class="literal-block">
EXPR -&gt; VAR
</pre>
<p>This single expression does the following:</p>
<ul class="simple">
<li>Evaluate the value of <tt class="docutils literal">EXPR</tt>, an arbitrary expression;</li>
<li>Assign the result to <tt class="docutils literal">VAR</tt>, a single assignment target; and</li>
<li>Leave the result of <tt class="docutils literal">EXPR</tt> on the Top of Stack (TOS)</li>
</ul>
<p>Here <tt class="docutils literal"><span class="pre">-&gt;</span></tt> or (<tt class="docutils literal">RARROW</tt>) has been used to illustrate the concept that
the result of <tt class="docutils literal">EXPR</tt> is assigned to <tt class="docutils literal">VAR</tt>.</p>
<p>The translation of the proposed syntax is:</p>
<pre class="literal-block">
VAR = (EXPR)
(EXPR)
</pre>
<p>The assignment target can be either an attribute, a subscript or
name:</p>
<pre class="literal-block">
f() -&gt; name[0]      # where 'name' exists previously.

f() -&gt; name.attr    # again 'name' exists prior to this expression.

f() -&gt; name
</pre>
<p>This expression should be available anywhere that an expression is
currently accepted.</p>
<p>All exceptions that are currently raised during invalid
assignments will continue to be raised when using the assignment
expression.  For example, a <tt class="docutils literal">NameError</tt> will be raised when in
example 1 and 2 above if <tt class="docutils literal">name</tt> is not previously defined, or an
<tt class="docutils literal">IndexError</tt> if index 0 was out of range.</p>
</div>
<div class="section" id="examples-from-the-standard-library">
<h1><a class="toc-backref" href="#id7">Examples from the Standard Library</a></h1>
<p>The following two examples were chosen after a brief search
through the standard library, specifically both are from ast.py
which happened to be open at the time of the search.</p>
<p>Original:</p>
<pre class="literal-block">
def walk(node):
    from collections import deque
    todo = deque([node])
    while todo:
        node = todo.popleft()
        todo.extend(iter_child_nodes(node))
        yield node
</pre>
<p>Using assignment expression:</p>
<pre class="literal-block">
def walk(node):
    from collections import deque
    todo = deque([node])
    while todo:
        todo.extend(iter_child_nodes(todo.popleft() -&gt; node))
        yield node
</pre>
<p>Original:</p>
<pre class="literal-block">
def get_docstring(node, clean=True):
    if not isinstance(node, (FunctionDef, ClassDef, Module)):
        raise TypeError(&quot;%r can't have docstrings&quot;
                            % node.__class__.__name__)
    if node.body and isinstance(node.body[0], Expr) and \
    isinstance(node.body[0].value, Str):
        if clean:
            import inspect
            return inspect.cleandoc(node.body[0].value.s)
        return node.body[0].value.s
</pre>
<p>Using assignment expression:</p>
<pre class="literal-block">
def get_docstring(node, clean=True):
    if not isinstance(node, (FunctionDef, ClassDef, Module)):
        raise TypeError(&quot;%r can't have docstrings&quot;
                            % node.__class__.__name__)
    if node.body -&gt; body and isinstance(body[0] -&gt; elem, Expr) and \
    isinstance(elem.value -&gt; value, Str):
        if clean:
            import inspect
            return inspect.cleandoc(value.s)
        return value.s
</pre>
</div>
<div class="section" id="examples">
<h1><a class="toc-backref" href="#id8">Examples</a></h1>
<p>The examples shown below highlight some of the desirable features
of the assignment expression, and some of the possible corner
cases.</p>
<ol class="arabic">
<li><p class="first">Assignment in an if statement for use later:</p>
<pre class="literal-block">
def expensive():
    import time; time.sleep(1)
    return 'spam'

if expensive() -&gt; res in ('spam', 'eggs'):
    dosomething(res)
</pre>
</li>
<li><p class="first">Assignment in a while loop clause:</p>
<pre class="literal-block">
while len(expensive() -&gt; res) == 4:
    dosomething(res)
</pre>
</li>
<li><p class="first">Keep the iterator object from the for loop:</p>
<pre class="literal-block">
for ch in expensive() -&gt; res:
    sell_on_internet(res)
</pre>
</li>
<li><p class="first">Corner case:</p>
<pre class="literal-block">
for ch -&gt; please_dont in expensive():
    pass
# who would want to do this? Not I.
</pre>
</li>
</ol>
</div>
<div class="section" id="references">
<h1><a class="toc-backref" href="#id9">References</a></h1>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Issue1714448 &quot;if something as x:&quot;, k0wax
<a class="reference external" href="http://bugs.python.org/issue1714448">http://bugs.python.org/issue1714448</a></td></tr>
</tbody>
</table>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id10">Copyright</a></h1>
<p>This document has been placed in the public domain.</p>
<!-- Local Variables:
mode: indented-text
indent-tabs-mode: nil
sentence-end-double-space: t
fill-column: 70
coding: utf-8
End: -->
</div>

