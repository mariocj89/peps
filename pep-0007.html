<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">PEP:</th><td class="field-body">7</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">Style Guide for C Code</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">$Revision$</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference external" href="https://hg.python.org/peps/file/tip/pep-0007.txt">$Date$</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">Guido van Rossum &lt;guido&#32;&#97;t&#32;python.org&gt;, Barry Warsaw &lt;barry&#32;&#97;t&#32;python.org&gt;</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Active</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Process</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference external" href="/dev/peps/pep-0012">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">05-Jul-2001</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id3">Introduction</a></li>
<li><a class="reference internal" href="#c-dialect" id="id4">C dialect</a></li>
<li><a class="reference internal" href="#code-lay-out" id="id5">Code lay-out</a></li>
<li><a class="reference internal" href="#naming-conventions" id="id6">Naming conventions</a></li>
<li><a class="reference internal" href="#documentation-strings" id="id7">Documentation Strings</a></li>
<li><a class="reference internal" href="#references" id="id8">References</a></li>
<li><a class="reference internal" href="#copyright" id="id9">Copyright</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h1><a class="toc-backref" href="#id3">Introduction</a></h1>
<p>This document gives coding conventions for the C code comprising the C
implementation of Python.  Please see the companion informational PEP
describing style guidelines for Python code <a class="footnote-reference" href="#id2" id="id1">[1]</a>.</p>
<p>Note, rules are there to be broken.  Two good reasons to break a
particular rule:</p>
<ol class="arabic simple">
<li>When applying the rule would make the code less readable, even for
someone who is used to reading code that follows the rules.</li>
<li>To be consistent with surrounding code that also breaks it (maybe
for historic reasons) -- although this is also an opportunity to
clean up someone else's mess (in true XP style).</li>
</ol>
</div>
<div class="section" id="c-dialect">
<h1><a class="toc-backref" href="#id4">C dialect</a></h1>
<ul>
<li><p class="first">Python versions before 3.6 use ANSI/ISO standard C (the 1989 version
of the standard).  This means (amongst many other things) that all
declarations must be at the top of a block (not necessarily at the
top of function).</p>
</li>
<li><p class="first">Python versions greater than or equal to 3.6 use C89 with several
select C99 features:</p>
<ul class="simple">
<li>Standard integer types in <tt class="docutils literal">&lt;stdint.h&gt;</tt> and <tt class="docutils literal">&lt;inttypes.h&gt;</tt>. We
require the fixed width integer types.</li>
<li><tt class="docutils literal">static inline</tt> functions</li>
<li>designated initializers (especially nice for type declarations)</li>
<li>intermingled declarations</li>
<li>booleans</li>
<li>C++-style line comments</li>
</ul>
<p>Future C99 features may be added to this list in the future
depending on compiler support (mostly significantly MSVC).</p>
</li>
<li><p class="first">Don't use GCC extensions (e.g. don't write multi-line strings
without trailing backslashes).</p>
</li>
<li><p class="first">All function declarations and definitions must use full prototypes
(i.e. specify the types of all arguments).</p>
</li>
<li><p class="first">Only use C++ style // one-line comments in Python 3.6 or later.</p>
</li>
<li><p class="first">No compiler warnings with major compilers (gcc, VC++, a few others).</p>
</li>
</ul>
</div>
<div class="section" id="code-lay-out">
<h1><a class="toc-backref" href="#id5">Code lay-out</a></h1>
<ul>
<li><p class="first">Use 4-space indents and no tabs at all.</p>
</li>
<li><p class="first">No line should be longer than 79 characters.  If this and the
previous rule together don't give you enough room to code, your code
is too complicated -- consider using subroutines.</p>
</li>
<li><p class="first">No line should end in whitespace.  If you think you need significant
trailing whitespace, think again -- somebody's editor might delete
it as a matter of routine.</p>
</li>
<li><p class="first">Function definition style: function name in column 1, outermost
curly braces in column 1, blank line after local variable
declarations.</p>
<pre class="literal-block">
static int
extra_ivars(PyTypeObject *type, PyTypeObject *base)
{
    int t_size = PyType_BASICSIZE(type);
    int b_size = PyType_BASICSIZE(base);

    assert(t_size &gt;= b_size); /* type smaller than base! */
    ...
    return 1;
}
</pre>
</li>
<li><p class="first">Code structure: one space between keywords like <tt class="docutils literal">if</tt>, <tt class="docutils literal">for</tt> and
the following left paren; no spaces inside the paren; braces are
required everywhere, even where C permits them to be omitted, but do
not add them to code you are not otherwise modifying.  All new C
code requires braces.  Braces should be formatted as shown:</p>
<pre class="literal-block">
if (mro != NULL) {
    ...
}
else {
    ...
}
</pre>
</li>
<li><p class="first">The return statement should <em>not</em> get redundant parentheses:</p>
<pre class="literal-block">
return albatross; /* correct */
return(albatross); /* incorrect */
</pre>
</li>
<li><p class="first">Function and macro call style: <tt class="docutils literal">foo(a, b, c)</tt> -- no space before
the open paren, no spaces inside the parens, no spaces before
commas, one space after each comma.</p>
</li>
<li><p class="first">Always put spaces around assignment, Boolean and comparison
operators.  In expressions using a lot of operators, add spaces
around the outermost (lowest-priority) operators.</p>
</li>
<li><p class="first">Breaking long lines: if you can, break after commas in the outermost
argument list.  Always indent continuation lines appropriately,
e.g.:</p>
<pre class="literal-block">
PyErr_Format(PyExc_TypeError,
             &quot;cannot create '%.100s' instances&quot;,
             type-&gt;tp_name);
</pre>
</li>
<li><p class="first">When you break a long expression at a binary operator, the
operator goes at the end of the previous line, and braces should be
formatted as shown.  E.g.:</p>
<pre class="literal-block">
if (type-&gt;tp_dictoffset != 0 &amp;&amp; base-&gt;tp_dictoffset == 0 &amp;&amp;
    type-&gt;tp_dictoffset == b_size &amp;&amp;
    (size_t)t_size == b_size + sizeof(PyObject *))
{
    return 0; /* &quot;Forgive&quot; adding a __dict__ only */
}
</pre>
</li>
<li><p class="first">Put blank lines around functions, structure definitions, and major
sections inside functions.</p>
</li>
<li><p class="first">Comments go before the code they describe.</p>
</li>
<li><p class="first">All functions and global variables should be declared static unless
they are to be part of a published interface</p>
</li>
<li><p class="first">For external functions and variables, we always have a declaration
in an appropriate header file in the &quot;Include&quot; directory, which uses
the <tt class="docutils literal">PyAPI_FUNC()</tt> macro, like this:</p>
<pre class="literal-block">
PyAPI_FUNC(PyObject *) PyObject_Repr(PyObject *);
</pre>
</li>
</ul>
</div>
<div class="section" id="naming-conventions">
<h1><a class="toc-backref" href="#id6">Naming conventions</a></h1>
<ul class="simple">
<li>Use a <tt class="docutils literal">Py</tt> prefix for public functions; never for static
functions.  The <tt class="docutils literal">Py_</tt> prefix is reserved for global service
routines like <tt class="docutils literal">Py_FatalError</tt>; specific groups of routines
(e.g. specific object type APIs) use a longer prefix,
e.g. <tt class="docutils literal">PyString_</tt> for string functions.</li>
<li>Public functions and variables use MixedCase with underscores, like
this: <tt class="docutils literal">PyObject_GetAttr</tt>, <tt class="docutils literal">Py_BuildValue</tt>, <tt class="docutils literal">PyExc_TypeError</tt>.</li>
<li>Occasionally an &quot;internal&quot; function has to be visible to the loader;
we use the <tt class="docutils literal">_Py</tt> prefix for this, e.g.: <tt class="docutils literal">_PyObject_Dump</tt>.</li>
<li>Macros should have a MixedCase prefix and then use upper case, for
example: <tt class="docutils literal">PyString_AS_STRING</tt>, <tt class="docutils literal">Py_PRINT_RAW</tt>.</li>
</ul>
</div>
<div class="section" id="documentation-strings">
<h1><a class="toc-backref" href="#id7">Documentation Strings</a></h1>
<ul>
<li><p class="first">Use the <tt class="docutils literal">PyDoc_STR()</tt> or <tt class="docutils literal">PyDoc_STRVAR()</tt> macro for docstrings
to support building Python without docstrings (<tt class="docutils literal">./configure
<span class="pre">--without-doc-strings</span></tt>).</p>
<p>For C code that needs to support versions of Python older than 2.3,
you can include this after including <tt class="docutils literal">Python.h</tt>:</p>
<pre class="literal-block">
#ifndef PyDoc_STR
#define PyDoc_VAR(name)         static char name[]
#define PyDoc_STR(str)          (str)
#define PyDoc_STRVAR(name, str) PyDoc_VAR(name) = PyDoc_STR(str)
#endif
</pre>
</li>
<li><p class="first">The first line of each function docstring should be a &quot;signature
line&quot; that gives a brief synopsis of the arguments and return value.
For example:</p>
<pre class="literal-block">
PyDoc_STRVAR(myfunction__doc__,
&quot;myfunction(name, value) -&gt; bool\n\n\
Determine whether name and value make a valid pair.&quot;);
</pre>
<p>Always include a blank line between the signature line and the text
of the description.</p>
<p>If the return value for the function is always None (because there
is no meaningful return value), do not include the indication of the
return type.</p>
</li>
<li><p class="first">When writing multi-line docstrings, be sure to always use backslash
continuations, as in the example above, or string literal
concatenation:</p>
<pre class="literal-block">
PyDoc_STRVAR(myfunction__doc__,
&quot;myfunction(name, value) -&gt; bool\n\n&quot;
&quot;Determine whether name and value make a valid pair.&quot;);
</pre>
<p>Though some C compilers accept string literals without either:</p>
<pre class="literal-block">
/* BAD -- don't do this! */
PyDoc_STRVAR(myfunction__doc__,
&quot;myfunction(name, value) -&gt; bool\n\n
Determine whether name and value make a valid pair.&quot;);
</pre>
<p>not all do; the MSVC compiler is known to complain about this.</p>
</li>
</ul>
</div>
<div class="section" id="references">
<h1><a class="toc-backref" href="#id8">References</a></h1>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="/dev/peps/pep-0008">PEP 8</a>, &quot;Style Guide for Python Code&quot;, van Rossum, Warsaw
(<a class="reference external" href="http://www.python.org/dev/peps/pep-0008">http://www.python.org/dev/peps/pep-0008</a>)</td></tr>
</tbody>
</table>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id9">Copyright</a></h1>
<p>This document has been placed in the public domain.</p>
<!-- Local Variables:
mode: indented-text
indent-tabs-mode: nil
sentence-end-double-space: t
fill-column: 70
coding: utf-8
End: -->
</div>

