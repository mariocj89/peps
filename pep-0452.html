<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">PEP:</th><td class="field-body">452</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">API for Cryptographic Hash Functions v2.0</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">$Revision$</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference external" href="https://hg.python.org/peps/file/tip/pep-0452.txt">$Date$</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">A.M. Kuchling &lt;amk&#32;&#97;t&#32;amk.ca&gt;, Christian Heimes &lt;christian&#32;&#97;t&#32;python.org&gt;</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Draft</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Informational</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference external" href="/dev/peps/pep-0012">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">15-Aug-2013</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body"></td>
</tr>
<tr class="field"><th class="field-name">Replaces:</th><td class="field-body"><a class="reference external" href="/dev/peps/pep-0247">247</a></td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#abstract" id="id4">Abstract</a></li>
<li><a class="reference internal" href="#specification" id="id5">Specification</a></li>
<li><a class="reference internal" href="#rationale" id="id6">Rationale</a></li>
<li><a class="reference internal" href="#changes-from-version-1-0-to-version-2-0" id="id7">Changes from Version 1.0 to Version 2.0</a></li>
<li><a class="reference internal" href="#recommended-names-for-common-hashing-algorithms" id="id8">Recommended names for common hashing algorithms</a></li>
<li><a class="reference internal" href="#changes" id="id9">Changes</a></li>
<li><a class="reference internal" href="#acknowledgements" id="id10">Acknowledgements</a></li>
<li><a class="reference internal" href="#id1" id="id11">References</a></li>
<li><a class="reference internal" href="#copyright" id="id12">Copyright</a></li>
</ul>
</div>
<div class="section" id="abstract">
<h1><a class="toc-backref" href="#id4">Abstract</a></h1>
<p>There are several different modules available that implement
cryptographic hashing algorithms such as MD5 or SHA.  This
document specifies a standard API for such algorithms, to make it
easier to switch between different implementations.</p>
</div>
<div class="section" id="specification">
<h1><a class="toc-backref" href="#id5">Specification</a></h1>
<p>All hashing modules should present the same interface.  Additional
methods or variables can be added, but those described in this
document should always be present.</p>
<p>Hash function modules define one function:</p>
<p><tt class="docutils literal"><span class="pre">new([string])</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (unkeyed hashes)</tt></p>
<dl class="docutils">
<dt><tt class="docutils literal">new(key, [string], [digestmod])&nbsp;&nbsp;&nbsp; (keyed hashes)</tt></dt>
<dd><p class="first">Create a new hashing object and return it.  The first form is
for hashes that are unkeyed, such as MD5 or SHA.  For keyed
hashes such as HMAC, 'key' is a required parameter containing
a string giving the key to use.  In both cases, the optional
'string' parameter, if supplied, will be immediately hashed
into the object's starting state, as if <tt class="docutils literal">obj.update(string)</tt> was
called.</p>
<p>After creating a hashing object, arbitrary bytes can be fed
into the object using its <tt class="docutils literal">update()</tt> method, and the hash value
can be obtained at any time by calling the object's <tt class="docutils literal">digest()</tt>
method.</p>
<p>Although the parameter is called 'string', hashing objects operate
on 8-bit data only. Both 'key' and 'string' must be a bytes-like
object (bytes, bytearray...). A hashing object may support
one-dimensional, contiguous buffers as argument, too. Text
(unicode) is no longer supported in Python 3.x. Python 2.x
implementations may take ASCII-only unicode as argument, but
portable code should not rely on the feature.</p>
<p class="last">Arbitrary additional keyword arguments can be added to this
function, but if they're not supplied, sensible default values
should be used.  For example, 'rounds' and 'digest_size'
keywords could be added for a hash function which supports a
variable number of rounds and several different output sizes,
and they should default to values believed to be secure.</p>
</dd>
</dl>
<p>Hash function modules define one variable:</p>
<dl class="docutils">
<dt><tt class="docutils literal">digest_size</tt></dt>
<dd>An integer value; the size of the digest produced by the
hashing objects created by this module, measured in bytes.
You could also obtain this value by creating a sample object
and accessing its 'digest_size' attribute, but it can be
convenient to have this value available from the module.
Hashes with a variable output size will set this variable to
None.</dd>
</dl>
<p>Hashing objects require the following attribute:</p>
<dl class="docutils">
<dt><tt class="docutils literal">digest_size</tt></dt>
<dd>This attribute is identical to the module-level digest_size
variable, measuring the size of the digest produced by the
hashing object, measured in bytes.  If the hash has a variable
output size, this output size must be chosen when the hashing
object is created, and this attribute must contain the
selected size.  Therefore, <tt class="docutils literal">None</tt> is <strong>not</strong> a legal value for this
attribute.</dd>
<dt><tt class="docutils literal">block_size</tt></dt>
<dd>An integer value or <tt class="docutils literal">NotImplemented</tt>; the internal block size
of the hash algorithm in bytes. The block size is used by the
HMAC module to pad the secret key to <tt class="docutils literal">digest_size</tt> or to hash the
secret key if it is longer than <tt class="docutils literal">digest_size</tt>. If no HMAC
algorithm is standardized for the hash algorithm, return
<tt class="docutils literal">NotImplemented</tt> instead.</dd>
<dt><tt class="docutils literal">name</tt></dt>
<dd>A text string value; the canonical, lowercase name of the hashing
algorithm. The name should be a suitable parameter for
<tt class="docutils literal">hashlib.new</tt>.</dd>
</dl>
<p>Hashing objects require the following methods:</p>
<dl class="docutils">
<dt><tt class="docutils literal">copy()</tt></dt>
<dd>Return a separate copy of this hashing object.  An update to
this copy won't affect the original object.</dd>
<dt><tt class="docutils literal">digest()</tt></dt>
<dd>Return the hash value of this hashing object as a bytes
containing 8-bit data.  The object is not altered in any way
by this function; you can continue updating the object after
calling this function.</dd>
<dt><tt class="docutils literal">hexdigest()</tt></dt>
<dd>Return the hash value of this hashing object as a string
containing hexadecimal digits.  Lowercase letters should be used
for the digits 'a' through 'f'.  Like the <tt class="docutils literal">.digest()</tt> method, this
method mustn't alter the object.</dd>
<dt><tt class="docutils literal">update(string)</tt></dt>
<dd>Hash bytes-like 'string' into the current state of the hashing
object. <tt class="docutils literal">update()</tt> can be called any number of times during a
hashing object's lifetime.</dd>
</dl>
<p>Hashing modules can define additional module-level functions or
object methods and still be compliant with this specification.</p>
<p>Here's an example, using a module named 'MD5':</p>
<pre class="literal-block">
&gt;&gt;&gt; import hashlib
&gt;&gt;&gt; from Crypto.Hash import MD5
&gt;&gt;&gt; m = MD5.new()
&gt;&gt;&gt; isinstance(m, hashlib.CryptoHash)
True
&gt;&gt;&gt; m.name
'md5'
&gt;&gt;&gt; m.digest_size
16
&gt;&gt;&gt; m.block_size
64
&gt;&gt;&gt; m.update(b'abc')
&gt;&gt;&gt; m.digest()
b'\x90\x01P\x98&lt;\xd2O\xb0\xd6\x96?}(\xe1\x7fr'
&gt;&gt;&gt; m.hexdigest()
'900150983cd24fb0d6963f7d28e17f72'
&gt;&gt;&gt; MD5.new(b'abc').digest()
b'\x90\x01P\x98&lt;\xd2O\xb0\xd6\x96?}(\xe1\x7fr'
</pre>
</div>
<div class="section" id="rationale">
<h1><a class="toc-backref" href="#id6">Rationale</a></h1>
<p>The digest size is measured in bytes, not bits, even though hash
algorithm sizes are usually quoted in bits; MD5 is a 128-bit
algorithm and not a 16-byte one, for example.  This is because, in
the sample code I looked at, the length in bytes is often needed
(to seek ahead or behind in a file; to compute the length of an
output string) while the length in bits is rarely used.
Therefore, the burden will fall on the few people actually needing
the size in bits, who will have to multiply digest_size by 8.</p>
<p>It's been suggested that the <tt class="docutils literal">update()</tt> method would be better named
<tt class="docutils literal">append()</tt>.  However, that method is really causing the current
state of the hashing object to be updated, and <tt class="docutils literal">update()</tt> is already
used by the md5 and sha modules included with Python, so it seems
simplest to leave the name <tt class="docutils literal">update()</tt> alone.</p>
<p>The order of the constructor's arguments for keyed hashes was a
sticky issue.  It wasn't clear whether the key should come first
or second.  It's a required parameter, and the usual convention is
to place required parameters first, but that also means that the
'string' parameter moves from the first position to the second.
It would be possible to get confused and pass a single argument to
a keyed hash, thinking that you're passing an initial string to an
unkeyed hash, but it doesn't seem worth making the interface
for keyed hashes more obscure to avoid this potential error.</p>
</div>
<div class="section" id="changes-from-version-1-0-to-version-2-0">
<h1><a class="toc-backref" href="#id7">Changes from Version 1.0 to Version 2.0</a></h1>
<p>Version 2.0 of API for Cryptographic Hash Functions clarifies some
aspects of the API and brings it up-to-date. It also formalized aspects
that were already de facto standards and provided by most
implementations.</p>
<p>Version 2.0 introduces the following new attributes:</p>
<dl class="docutils">
<dt><tt class="docutils literal">name</tt></dt>
<dd>The name property was made mandatory by <a class="reference external" href="http://bugs.python.org/issue18532">issue 18532</a> <a class="footnote-reference" href="#id2" id="id3">[1]</a>.</dd>
<dt><tt class="docutils literal">block_size</tt></dt>
<dd>The new version also specifies that the return value
<tt class="docutils literal">NotImplemented</tt> prevents HMAC support.</dd>
</dl>
<p>Version 2.0 takes the separation of binary and text data in Python
3.0 into account. The 'string' argument to <tt class="docutils literal">new()</tt> and <tt class="docutils literal">update()</tt> as
well as the 'key' argument must be bytes-like objects. On Python
2.x a hashing object may also support ASCII-only unicode. The actual
name of argument is not changed as it is part of the public API.
Code may depend on the fact that the argument is called 'string'.</p>
</div>
<div class="section" id="recommended-names-for-common-hashing-algorithms">
<h1><a class="toc-backref" href="#id8">Recommended names for common hashing algorithms</a></h1>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="28%" />
<col width="44%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">algorithm</th>
<th class="head">variant</th>
<th class="head">recommended name</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>MD5</td>
<td>&nbsp;</td>
<td>md5</td>
</tr>
<tr><td>RIPEMD-160</td>
<td>&nbsp;</td>
<td>ripemd160</td>
</tr>
<tr><td>SHA-1</td>
<td>&nbsp;</td>
<td>sha1</td>
</tr>
<tr><td rowspan="4">SHA-2</td>
<td>SHA-224</td>
<td>sha224</td>
</tr>
<tr><td>SHA-256</td>
<td>sha256</td>
</tr>
<tr><td>SHA-384</td>
<td>sha384</td>
</tr>
<tr><td>SHA-512</td>
<td>sha512</td>
</tr>
<tr><td rowspan="4">SHA-3</td>
<td>SHA-3-224</td>
<td>sha3_224</td>
</tr>
<tr><td>SHA-3-256</td>
<td>sha3_256</td>
</tr>
<tr><td>SHA-3-384</td>
<td>sha3_384</td>
</tr>
<tr><td>SHA-3-512</td>
<td>sha3_512</td>
</tr>
<tr><td>WHIRLPOOL</td>
<td>&nbsp;</td>
<td>whirlpool</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="changes">
<h1><a class="toc-backref" href="#id9">Changes</a></h1>
<ul class="simple">
<li>2001-09-17: Renamed <tt class="docutils literal">clear()</tt> to <tt class="docutils literal">reset()</tt>; added <tt class="docutils literal">digest_size</tt> attribute
to objects; added <tt class="docutils literal">.hexdigest()</tt> method.</li>
<li>2001-09-20: Removed <tt class="docutils literal">reset()</tt> method completely.</li>
<li>2001-09-28: Set <tt class="docutils literal">digest_size</tt> to <tt class="docutils literal">None</tt> for variable-size hashes.</li>
<li>2013-08-15: Added <tt class="docutils literal">block_size</tt> and <tt class="docutils literal">name</tt> attributes; clarified that
'string' actually referes to bytes-like objects.</li>
</ul>
</div>
<div class="section" id="acknowledgements">
<h1><a class="toc-backref" href="#id10">Acknowledgements</a></h1>
<p>Thanks to Aahz, Andrew Archibald, Rich Salz, Itamar
Shtull-Trauring, and the readers of the python-crypto list for
their comments on this PEP.</p>
</div>
<div class="section" id="id1">
<h1><a class="toc-backref" href="#id11">References</a></h1>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[1]</a></td><td><a class="reference external" href="http://bugs.python.org/issue18532">http://bugs.python.org/issue18532</a></td></tr>
</tbody>
</table>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id12">Copyright</a></h1>
<p>This document has been placed in the public domain.</p>
<!-- Local Variables:
mode: indented-text
indent-tabs-mode: nil
End: -->
</div>

