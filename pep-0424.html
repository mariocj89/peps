<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">PEP:</th><td class="field-body">424</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">A method for exposing a length hint</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">$Revision$</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference external" href="https://hg.python.org/peps/file/tip/pep-0424.txt">$Date$</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">Alex Gaynor &lt;alex.gaynor&#32;&#97;t&#32;gmail.com&gt;</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Final</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Standards Track</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference external" href="/dev/peps/pep-0012">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">14-July-2012</td>
</tr>
<tr class="field"><th class="field-name">Python-Version:</th><td class="field-body">3.4</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body"><a class="reference external" href="https://mail.python.org/pipermail/python-dev/2012-July/120920.html">https://mail.python.org/pipermail/python-dev/2012-July/120920.html</a></td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#abstract" id="id2">Abstract</a></li>
<li><a class="reference internal" href="#specification" id="id3">Specification</a></li>
<li><a class="reference internal" href="#rationale" id="id4">Rationale</a></li>
<li><a class="reference internal" href="#copyright" id="id5">Copyright</a></li>
</ul>
</div>
<div class="section" id="abstract">
<h1><a class="toc-backref" href="#id2">Abstract</a></h1>
<p>CPython currently defines a <tt class="docutils literal">__length_hint__</tt> method on several
types, such as various iterators.  This method is then used by various
other functions (such as <tt class="docutils literal">list</tt>) to presize lists based on the
estimate returned by <tt class="docutils literal">__length_hint__</tt>.  Types which are not sized,
and thus should not define <tt class="docutils literal">__len__</tt>, can then define
<tt class="docutils literal">__length_hint__</tt>, to allow estimating or computing a size (such as
many iterators).</p>
</div>
<div class="section" id="specification">
<h1><a class="toc-backref" href="#id3">Specification</a></h1>
<p>This PEP formally documents <tt class="docutils literal">__length_hint__</tt> for other interpreters
and non-standard-library Python modules to implement.</p>
<p><tt class="docutils literal">__length_hint__</tt> must return an integer (else a <tt class="docutils literal">TypeError</tt> is
raised) or <tt class="docutils literal">NotImplemented</tt>, and is not required to be accurate.  It
may return a value that is either larger or smaller than the actual
size of the container.  A return value of <tt class="docutils literal">NotImplemented</tt> indicates
that there is no finite length estimate.  It may not return a negative
value (else a ValueError is raised).</p>
<p>In addition, a new function <tt class="docutils literal">operator.length_hint</tt> hint is added,
with the following semantics (which define how <tt class="docutils literal">__length_hint__</tt>
should be used):</p>
<pre class="literal-block">
def length_hint(obj, default=0):
    &quot;&quot;&quot;Return an estimate of the number of items in obj.

    This is useful for presizing containers when building from an
    iterable.

    If the object supports len(), the result will be
    exact. Otherwise, it may over- or under-estimate by an
    arbitrary amount. The result will be an integer &gt;= 0.
    &quot;&quot;&quot;
    try:
        return len(obj)
    except TypeError:
        try:
            get_hint = type(obj).__length_hint__
        except AttributeError:
            return default
        try:
            hint = get_hint(obj)
        except TypeError:
            return default
        if hint is NotImplemented:
            return default
        if not isinstance(hint, int):
            raise TypeError(&quot;Length hint must be an integer, not %r&quot; %
                            type(hint))
        if hint &lt; 0:
            raise ValueError(&quot;__length_hint__() should return &gt;= 0&quot;)
        return hint
</pre>
</div>
<div class="section" id="rationale">
<h1><a class="toc-backref" href="#id4">Rationale</a></h1>
<p>Being able to pre-allocate lists based on the expected size, as
estimated by <tt class="docutils literal">__length_hint__</tt>, can be a significant optimization.
CPython has been observed to run some code faster than PyPy, purely
because of this optimization being present.</p>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id5">Copyright</a></h1>
<p>This document has been placed into the public domain.</p>
<!-- Local Variables:
mode: indented-text
indent-tabs-mode: nil
sentence-end-double-space: t
fill-column: 70
coding: utf-8
End: -->
</div>

