<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">PEP:</th><td class="field-body">460</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">Add binary interpolation and formatting</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">$Revision$</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference external" href="https://hg.python.org/peps/file/tip/pep-0460.txt">$Date$</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">Antoine Pitrou &lt;solipsis&#32;&#97;t&#32;pitrou.net&gt;</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Withdrawn</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Standards Track</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference external" href="/dev/peps/pep-0012">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">6-Jan-2014</td>
</tr>
<tr class="field"><th class="field-name">Python-Version:</th><td class="field-body">3.5</td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#abstract" id="id1">Abstract</a></li>
<li><a class="reference internal" href="#rationale" id="id2">Rationale</a></li>
<li><a class="reference internal" href="#binary-formatting-features" id="id3">Binary formatting features</a><ul>
<li><a class="reference internal" href="#supported-features" id="id4">Supported features</a></li>
<li><a class="reference internal" href="#unsupported-features" id="id5">Unsupported features</a></li>
</ul>
</li>
<li><a class="reference internal" href="#criticisms" id="id6">Criticisms</a></li>
<li><a class="reference internal" href="#other-proposals" id="id7">Other proposals</a><ul>
<li><a class="reference internal" href="#a-new-type-datatype" id="id8">A new type datatype</a></li>
</ul>
</li>
<li><a class="reference internal" href="#resolution" id="id9">Resolution</a></li>
<li><a class="reference internal" href="#references" id="id10">References</a></li>
<li><a class="reference internal" href="#copyright" id="id11">Copyright</a></li>
</ul>
</div>
<div class="section" id="abstract">
<h1><a class="toc-backref" href="#id1">Abstract</a></h1>
<p>This PEP proposes to add minimal formatting operations to bytes and
bytearray objects.  The proposed additions are:</p>
<ul class="simple">
<li><tt class="docutils literal">bytes % ...</tt> and <tt class="docutils literal">bytearray % ...</tt> for percent-formatting,
similar in syntax to percent-formatting on <tt class="docutils literal">str</tt> objects
(accepting a single object, a tuple or a dict).</li>
<li><tt class="docutils literal"><span class="pre">bytes.format(...)</span></tt> and <tt class="docutils literal"><span class="pre">bytearray.format(...)</span></tt> for a formatting
similar in syntax to <tt class="docutils literal">str.format()</tt> (accepting positional as well as
keyword arguments).</li>
<li><tt class="docutils literal"><span class="pre">bytes.format_map(...)</span></tt> and <tt class="docutils literal"><span class="pre">bytearray.format_map(...)</span></tt> for an
API similar to <tt class="docutils literal"><span class="pre">str.format_map(...)</span></tt>, with the same formatting
syntax and semantics as <tt class="docutils literal">bytes.format()</tt> and <tt class="docutils literal">bytearray.format()</tt>.</li>
</ul>
</div>
<div class="section" id="rationale">
<h1><a class="toc-backref" href="#id2">Rationale</a></h1>
<p>In Python 2, <tt class="docutils literal">str % args</tt> and <tt class="docutils literal">str.format(args)</tt> allow the formatting
and interpolation of bytestrings.  This feature has commonly been used
for the assembling of protocol messages when protocols are known to use
a fixed encoding.</p>
<p>Python 3 generally mandates that text be stored and manipulated as unicode
(i.e. <tt class="docutils literal">str</tt> objects, not <tt class="docutils literal">bytes</tt>).  In some cases, though, it makes
sense to manipulate <tt class="docutils literal">bytes</tt> objects directly.  Typical usage is binary
network protocols, where you can want to interpolate and assemble several
bytes object (some of them literals, some of them compute) to produce
complete protocol messages.  For example, protocols such as HTTP or SIP
have headers with ASCII names and opaque &quot;textual&quot; values using a varying
and/or sometimes ill-defined encoding.  Moreover, those headers can be
followed by a binary body... which can be chunked and decorated with ASCII
headers and trailers!</p>
<p>While there are reasonably efficient ways to accumulate binary data
(such as using a <tt class="docutils literal">bytearray</tt> object, the <tt class="docutils literal">bytes.join</tt> method or
even <tt class="docutils literal">io.BytesIO</tt>), none of them leads to the kind of readable and
intuitive code that is produced by a %-formatted or {}-formatted template
and a formatting operation.</p>
</div>
<div class="section" id="binary-formatting-features">
<h1><a class="toc-backref" href="#id3">Binary formatting features</a></h1>
<div class="section" id="supported-features">
<h2><a class="toc-backref" href="#id4">Supported features</a></h2>
<p>In this proposal, percent-formatting for <tt class="docutils literal">bytes</tt> and <tt class="docutils literal">bytearray</tt>
supports the following features:</p>
<ul class="simple">
<li>Looking up formatting arguments by position as well as by name (i.e.,
<tt class="docutils literal">%s</tt> as well as <tt class="docutils literal">%(name)s</tt>).</li>
<li><tt class="docutils literal">%s</tt> will try to get a <tt class="docutils literal">Py_buffer</tt> on the given value, and fallback
on calling <tt class="docutils literal">__bytes__</tt>.  The resulting binary data is inserted at
the given point in the string.  This is expected to work with bytes,
bytearray and memoryview objects (as well as a couple others such
as pathlib's path objects).</li>
<li><tt class="docutils literal">%c</tt> will accept an integer between 0 and 255, and insert a byte of the
given value.</li>
</ul>
<p>Braces-formatting for <tt class="docutils literal">bytes</tt> and <tt class="docutils literal">bytearray</tt> supports the following
features:</p>
<ul class="simple">
<li>All the kinds of argument lookup supported by <tt class="docutils literal">str.format()</tt> (explicit
positional lookup, auto-incremented positional lookup, keyword lookup,
attribute lookup, etc.)</li>
<li>Insertion of binary data when no modifier or layout is specified
(e.g. <tt class="docutils literal">{}</tt>, <tt class="docutils literal">{0}</tt>, <tt class="docutils literal">{name}</tt>).  This has the same semantics as
<tt class="docutils literal">%s</tt> for percent-formatting (see above).</li>
<li>The <tt class="docutils literal">c</tt> modifier will accept an integer between 0 and 255, and insert a
byte of the given value (same as <tt class="docutils literal">%c</tt> above).</li>
</ul>
</div>
<div class="section" id="unsupported-features">
<h2><a class="toc-backref" href="#id5">Unsupported features</a></h2>
<p>All other features present in formatting of <tt class="docutils literal">str</tt> objects (either
through the percent operator or the <tt class="docutils literal">str.format()</tt> method) are
unsupported.  Those features imply treating the recipient of the
operator or method as text, which goes counter to the text / bytes
separation (for example, accepting <tt class="docutils literal">%d</tt> as a format code would imply
that the bytes object really is an ASCII-compatible text string).</p>
<p>Amongst those unsupported features are not only most type-specific
format codes, but also the various layout specifiers such as padding
or alignment.  Besides, <tt class="docutils literal">str</tt> objects are not acceptable as arguments
to the formatting operations, even when using e.g. the <tt class="docutils literal">%s</tt> format code.</p>
<p><tt class="docutils literal">__format__</tt> isn't called.</p>
</div>
</div>
<div class="section" id="criticisms">
<h1><a class="toc-backref" href="#id6">Criticisms</a></h1>
<ul class="simple">
<li>The development cost and maintenance cost.</li>
<li>In 3.3 encoding to ASCII or latin-1 is as fast as memcpy (but it still
creates a separate object).</li>
<li>Developers will have to work around the lack of binary formatting anyway,
if they want to support Python 3.4 and earlier.</li>
<li>bytes.join() is consistently faster than format to join bytes strings
(XXX <em>is it?</em>).</li>
<li>Formatting functions could be implemented in a third party module,
rather than added to builtin types.</li>
</ul>
</div>
<div class="section" id="other-proposals">
<h1><a class="toc-backref" href="#id7">Other proposals</a></h1>
<div class="section" id="a-new-type-datatype">
<h2><a class="toc-backref" href="#id8">A new type datatype</a></h2>
<p>It was proposed to create a new datatype specialized for &quot;network
programming&quot;.  The authors of this PEP believe this is counter-productive.
Python 3 already has several major types dedicated to manipulation of
binary data: <tt class="docutils literal">bytes</tt>, <tt class="docutils literal">bytearray</tt>, <tt class="docutils literal">memoryview</tt>, <tt class="docutils literal">io.BytesIO</tt>.</p>
<p>Adding yet another type would make things more confusing for users, and
interoperability between libraries more painful (also potentially
sub-optimal, due to the necessary conversions).</p>
<p>Moreover, not one type would be needed, but two: one immutable type (to
allow for hashing), and one mutable type (as efficient accumulation is
often necessary when working with network messages).</p>
</div>
</div>
<div class="section" id="resolution">
<h1><a class="toc-backref" href="#id9">Resolution</a></h1>
<p>This PEP is made obsolete by the <a class="reference external" href="https://mail.python.org/pipermail/python-dev/2014-March/133621.html">acceptance</a>
of <a class="reference external" href="/dev/peps/pep-0461">PEP 461</a>, which introduces a more extended formatting language for
bytes objects in conjunction with the modulo operator.</p>
</div>
<div class="section" id="references">
<h1><a class="toc-backref" href="#id10">References</a></h1>
<ul class="simple">
<li><a class="reference external" href="http://bugs.python.org/issue3982">Issue #3982: support .format for bytes</a></li>
<li><a class="reference external" href="http://mercurial.selenic.com/">Mercurial project</a></li>
<li><a class="reference external" href="http://twistedmatrix.com/trac/">Twisted project</a></li>
<li><a class="reference external" href="http://docs.python.org/2/library/stdtypes.html#string-formatting">Documentation of Python 2 formatting (str % args)</a></li>
<li><a class="reference external" href="http://docs.python.org/2/library/string.html#formatstrings">Documentation of Python 2 formatting (str.format)</a></li>
</ul>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id11">Copyright</a></h1>
<p>This document has been placed in the public domain.</p>
<!-- Local Variables:
mode: indented-text
indent-tabs-mode: nil
sentence-end-double-space: t
fill-column: 70
coding: utf-8
End: -->
</div>

