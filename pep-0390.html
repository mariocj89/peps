<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">PEP:</th><td class="field-body">390</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">Static metadata for Distutils</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">$Revision$</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference external" href="https://hg.python.org/peps/file/tip/pep-0390.txt">$Date$</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">Tarek Ziad√© &lt;tarek&#32;&#97;t&#32;ziade.org&gt;</td>
</tr>
<tr class="field"><th class="field-name">BDFL-Delegate:</th><td class="field-body">Nick Coghlan</td>
</tr>
<tr class="field"><th class="field-name">Discussions-To:</th><td class="field-body">&lt;<a class="reference external" href="mailto:distutils-sig&#64;python.org?subject=PEP%20390">distutils-sig&#32;&#97;t&#32;python.org</a>&gt;</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Rejected</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Standards Track</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference external" href="/dev/peps/pep-0012">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">10-October-2009</td>
</tr>
<tr class="field"><th class="field-name">Python-Version:</th><td class="field-body">2.7 and 3.2</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body"></td>
</tr>
<tr class="field"><th class="field-name">Resolution:</th><td class="field-body"><a class="reference external" href="https://mail.python.org/pipermail/distutils-sig/2013-April/020597.html">https://mail.python.org/pipermail/distutils-sig/2013-April/020597.html</a></td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#abstract" id="id2">Abstract</a></li>
<li><a class="reference internal" href="#rejection-notice" id="id3">Rejection Notice</a></li>
<li><a class="reference internal" href="#rationale" id="id4">Rationale</a></li>
<li><a class="reference internal" href="#adding-a-metadata-section-in-setup-cfg" id="id5">Adding a <tt class="docutils literal">metadata</tt> section in <tt class="docutils literal">setup.cfg</tt></a></li>
<li><a class="reference internal" href="#multi-lines-values" id="id6">Multi-lines values</a></li>
<li><a class="reference internal" href="#context-dependant-sections" id="id7">Context-dependant sections</a></li>
<li><a class="reference internal" href="#impact-on-pkg-info-generation-and-pep-314" id="id8">Impact on PKG-INFO generation and PEP 314</a></li>
<li><a class="reference internal" href="#compatibility" id="id9">Compatibility</a></li>
<li><a class="reference internal" href="#limitations" id="id10">Limitations</a></li>
<li><a class="reference internal" href="#acknowledgments" id="id11">Acknowledgments</a></li>
<li><a class="reference internal" href="#copyright" id="id12">Copyright</a></li>
</ul>
</div>
<div class="section" id="abstract">
<h1><a class="toc-backref" href="#id2">Abstract</a></h1>
<p>This PEP describes a new section and a new format for the <tt class="docutils literal">setup.cfg</tt> file,
that allows describing the Metadata of a package without using <tt class="docutils literal">setup.py</tt>.</p>
</div>
<div class="section" id="rejection-notice">
<h1><a class="toc-backref" href="#id3">Rejection Notice</a></h1>
<p>As distutils2 is no longer going to be incorporated into the standard
library, this PEP was rejected by Nick Coghlan in late April, 2013.</p>
<p>A replacement PEP based on <a class="reference external" href="/dev/peps/pep-0426">PEP 426</a> (metadata 2.0) will be created that
defines the minimum amount of information needed to generate an sdist
archive given a source tarball or VCS checkout.</p>
</div>
<div class="section" id="rationale">
<h1><a class="toc-backref" href="#id4">Rationale</a></h1>
<p>Today, if you want to list all the Metadata of a distribution (see <a class="reference external" href="/dev/peps/pep-0314">PEP 314</a>)
that is not installed, you need to use the <tt class="docutils literal">setup.py</tt> command line interface.</p>
<p>So, basically, you download it, and run:</p>
<pre class="literal-block">
$ python setup.py --name
Distribute

$ python setup.py --version
0.6.4
</pre>
<p>Where <tt class="docutils literal">name</tt> and <tt class="docutils literal">version</tt> are metadata fields. This is working fine but
as soon as the developers add more code in <tt class="docutils literal">setup.py</tt>, this feature might
break or in worst cases might do unwanted things on the target system.</p>
<p>Moreover, when an OS packager wants to get the metadata of a distribution
he is re-packaging, he might encounter some problems to understand
the <tt class="docutils literal">setup.py</tt> file he's working with.</p>
<p>So the rationale of this PEP is to provide a way to declare the metadata
in a static configuration file alongside <tt class="docutils literal">setup.py</tt> that doesn't require
any third party code to run.</p>
</div>
<div class="section" id="adding-a-metadata-section-in-setup-cfg">
<h1><a class="toc-backref" href="#id5">Adding a <tt class="docutils literal">metadata</tt> section in <tt class="docutils literal">setup.cfg</tt></a></h1>
<p>The first thing we want to introduce is a <tt class="docutils literal">[metadata]</tt> section, in the
<tt class="docutils literal">setup.cfg</tt> file, that may contain any field from the Metadata:</p>
<pre class="literal-block">
[metadata]
name = Distribute
version = 0.6.4
</pre>
<p>The <tt class="docutils literal">setup.cfg</tt> file is used to avoid adding yet another configuration
file to work with in Distutils.</p>
<p>This file is already read by Distutils when a command is executed, and
if the <tt class="docutils literal">metadata</tt> section is found, it will be used to fill the metadata
fields. If an option that corresponds to a Metadata field is given to
<tt class="docutils literal">setup()</tt>, it will override the value that was possibly present in
<tt class="docutils literal">setup.cfg</tt>.</p>
<p>Notice that <tt class="docutils literal">setup.py</tt> is still used and can be required to define some
options that are not part of the Metadata fields. For instance, the
<tt class="docutils literal">sdist</tt> command can use options like <tt class="docutils literal">packages</tt> or <tt class="docutils literal">scripts</tt>.</p>
</div>
<div class="section" id="multi-lines-values">
<h1><a class="toc-backref" href="#id6">Multi-lines values</a></h1>
<p>Some Metadata fields can have multiple values. To keep <tt class="docutils literal">setup.cfg</tt> compatible
with <tt class="docutils literal">ConfigParser</tt> and the <a class="reference external" href="http://tools.ietf.org/html/rfc822.html">RFC 822</a> <tt class="docutils literal">LONG HEADER FIELDS</tt> (see section 3.1.1),
these are expressed with <tt class="docutils literal">,</tt>-separated values:</p>
<pre class="literal-block">
requires = pywin32, bar &gt; 1.0, foo
</pre>
<p>When this variable is read, the values are parsed and transformed into a list:
<tt class="docutils literal">['pywin32', 'bar &gt; 1.0', 'foo']</tt>.</p>
</div>
<div class="section" id="context-dependant-sections">
<h1><a class="toc-backref" href="#id7">Context-dependant sections</a></h1>
<p>The <tt class="docutils literal">metadata</tt> section will also be able to use context-dependant sections.</p>
<p>A context-dependant section is a section with a condition about the execution
environment. Here's some examples:</p>
<pre class="literal-block">
[metadata]
name = Distribute
version = 0.6.4

[metadata:sys_platform == 'win32']
requires = pywin32, bar &gt; 1.0
obsoletes = pywin31

[metadata:os_machine == 'i386']
requires = foo

[metadata:python_version == '2.4' or python_version == '2.5']
requires = bar

[metadata:'linux' in sys_platform]
requires = baz
</pre>
<p>Every <tt class="docutils literal">[metadata:condition]</tt> section will be used only if the condition
is met when the file is read. The background motivation for these
context-dependant sections is to be able to define requirements that varies
depending on the platform the distribution might be installed on.
(see <a class="reference external" href="/dev/peps/pep-0314">PEP 314</a>).</p>
<p>The micro-language behind this is the simplest possible: it compares only
strings, with the <tt class="docutils literal">==</tt> and <tt class="docutils literal">in</tt> operators (and their opposites), and
with the ability to combine expressions. It makes it also easy to understand
to non-pythoneers.</p>
<p>The pseudo-grammar is</p>
<pre class="literal-block">
EXPR [in|==|!=|not in]&nbsp;EXPR [or|and] ...
</pre>
<p>where <tt class="docutils literal">EXPR</tt> belongs to any of those:</p>
<ul class="simple">
<li>python_version = '%s.%s' % (sys.version_info[0], sys.version_info[1])</li>
<li>os_name = os.name</li>
<li>sys_platform = sys.platform</li>
<li>platform_version = platform.version()</li>
<li>platform_machine = platform.machine()</li>
<li>a free string, like <tt class="docutils literal">2.4</tt>, or <tt class="docutils literal">win32</tt></li>
</ul>
<p>Notice that <tt class="docutils literal">in</tt> is restricted to strings, meaning that it is not possible
to use other sequences like tuples or lists on the right side.</p>
<p>Distutils will provide a function that is able to generate the metadata
of a distribution, given a <tt class="docutils literal">setup.cfg</tt> file, for the execution environment:</p>
<pre class="literal-block">
&gt;&gt;&gt; from distutils.util import local_metadata
&gt;&gt;&gt; local_metadata('setup.cfg')
&lt;DistributionMetadata instance&gt;
</pre>
<p>This means that a vanilla Python will be able to read the metadata of a
package without running any third party code.</p>
<p>Notice that this feature is not restricted to the <tt class="docutils literal">metadata</tt> namespace.
Consequently, any other section can be extended with such context-dependant
sections.</p>
</div>
<div class="section" id="impact-on-pkg-info-generation-and-pep-314">
<h1>Impact on PKG-INFO generation and <a class="reference external" href="/dev/peps/pep-0314">PEP 314</a></h1>
<p>When <tt class="docutils literal"><span class="pre">PKG-INFO</span></tt> is generated by Distutils, every field that relies on a
condition will have that condition written at the end of the line, after a <cite>;</cite>
separator:</p>
<pre class="literal-block">
Metadata-Version: 1.2
Name: distribute
Version: 0.6.4
...
Requires: pywin32, bar &gt; 1.0; sys_platform == 'win32'
Requires: foo; os_machine == 'i386'
Requires: bar; python_version == '2.4' or python_version == '2.5'
Requires: baz; 'linux' in sys_platform
Obsoletes = pywin31; sys_platform == 'win32'
...
Classifier: Development Status :: 5 - Production/Stable
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: Python Software Foundation License
</pre>
<p>Notice that this file can be opened with the <tt class="docutils literal">DistributionMetadata</tt> class.
This class will be able to use the micro-language using the execution
environment.</p>
<p>Let's run in on a <tt class="docutils literal">Python 2.5 i386 Linux</tt>:</p>
<pre class="literal-block">
&gt;&gt;&gt; from distutils.dist import DistributionMetadata
&gt;&gt;&gt; metadata = DistributionMetadata('PKG_INFO')
&gt;&gt;&gt; metadata.get_requires()
['foo', 'bar', 'baz']
</pre>
<p>The execution environment can be overridden in case we want to get the metadata
for another environment:</p>
<pre class="literal-block">
&gt;&gt;&gt; env = {'python_version': '2.4',
...        'os_name': 'nt',
...        'sys_platform': 'win32',
...        'platform_version': 'MVCC++ 6.0'
...        'platform_machine': 'i386'}
...
&gt;&gt;&gt; metadata = DistributionMetadata('PKG_INFO', environment=env)
&gt;&gt;&gt; metadata.get_requires()
['bar &gt; 1.0', 'foo', 'bar']
</pre>
<p><a class="reference external" href="/dev/peps/pep-0314">PEP 314</a> is changed accordingly, meaning that each field will be able to
have that extra condition marker.</p>
</div>
<div class="section" id="compatibility">
<h1><a class="toc-backref" href="#id9">Compatibility</a></h1>
<p>This change is based on a new metadata <tt class="docutils literal">1.2</tt> format meaning that
Distutils will be able to distinguish old PKG-INFO files from new ones.</p>
<p>The <tt class="docutils literal">setup.cfg</tt> file change will stay <tt class="docutils literal">ConfigParser</tt>-compatible and
will not break existing <tt class="docutils literal">setup.cfg</tt> files.</p>
</div>
<div class="section" id="limitations">
<h1><a class="toc-backref" href="#id10">Limitations</a></h1>
<p>We are not providing <tt class="docutils literal">&lt;</tt> and <tt class="docutils literal">&gt;</tt> operators at this time, and
<tt class="docutils literal">python_version</tt> is a regular string. This implies using <tt class="docutils literal">or</tt> operators
when a section needs to be restricted to a couple of Python versions.
Although, if <a class="reference external" href="/dev/peps/pep-0386">PEP 386</a> is accepted, <tt class="docutils literal">python_version</tt> could be changed
internally into something comparable with strings, and
<tt class="docutils literal">&lt;</tt> and <tt class="docutils literal">&gt;</tt> operators introduced.</p>
<p>Last, if a distribution is unable to set all metadata fields in <tt class="docutils literal">setup.cfg</tt>,
that's fine, the fields will be set to <tt class="docutils literal">UNKNOWN</tt> when <tt class="docutils literal">local_metadata</tt> is
called. Getting <tt class="docutils literal">UNKNOWN</tt> values will mean that it might be necessary to
run the <tt class="docutils literal">setup.py</tt> command line interface to get the whole set of metadata.</p>
</div>
<div class="section" id="acknowledgments">
<h1><a class="toc-backref" href="#id11">Acknowledgments</a></h1>
<p>The Distutils-SIG.</p>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id12">Copyright</a></h1>
<p>This document has been placed in the public domain.</p>
<!-- Local Variables:
mode: indented-text
indent-tabs-mode: nil
sentence-end-double-space: t
fill-column: 70
coding: utf-8
End: -->
</div>

