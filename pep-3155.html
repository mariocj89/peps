<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">PEP:</th><td class="field-body">3155</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">Qualified name for classes and functions</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">$Revision$</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference external" href="https://hg.python.org/peps/file/tip/pep-3155.txt">$Date$</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">Antoine Pitrou &lt;solipsis&#32;&#97;t&#32;pitrou.net&gt;</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Final</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Standards Track</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference external" href="/dev/peps/pep-0012">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">2011-10-29</td>
</tr>
<tr class="field"><th class="field-name">Python-Version:</th><td class="field-body">3.3</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body"></td>
</tr>
<tr class="field"><th class="field-name">Resolution:</th><td class="field-body"><a class="reference external" href="https://mail.python.org/pipermail/python-dev/2011-November/114545.html">https://mail.python.org/pipermail/python-dev/2011-November/114545.html</a></td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#rationale" id="id5">Rationale</a></li>
<li><a class="reference internal" href="#proposal" id="id6">Proposal</a><ul>
<li><a class="reference internal" href="#example-with-nested-classes" id="id7">Example with nested classes</a></li>
<li><a class="reference internal" href="#example-with-nested-functions" id="id8">Example with nested functions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#limitations" id="id9">Limitations</a></li>
<li><a class="reference internal" href="#discussion" id="id10">Discussion</a><ul>
<li><a class="reference internal" href="#excluding-the-module-name" id="id11">Excluding the module name</a></li>
<li><a class="reference internal" href="#reviving-unbound-methods" id="id12">Reviving unbound methods</a></li>
</ul>
</li>
<li><a class="reference internal" href="#naming-choice" id="id13">Naming choice</a></li>
<li><a class="reference internal" href="#references" id="id14">References</a></li>
<li><a class="reference internal" href="#copyright" id="id15">Copyright</a></li>
</ul>
</div>
<div class="section" id="rationale">
<h1><a class="toc-backref" href="#id5">Rationale</a></h1>
<p>Python's introspection facilities have long had poor support for
nested classes.  Given a class object, it is impossible to know
whether it was defined inside another class or at module top-level;
and, if the former, it is also impossible to know in which class it
was defined.  While use of nested classes is often considered poor
style, the only reason for them to have second class introspection
support is a lousy pun.</p>
<p>Python 3 adds insult to injury by dropping what was formerly known as
unbound methods.  In Python 2, given the following definition:</p>
<pre class="literal-block">
class C:
    def f():
        pass
</pre>
<p>you can then walk up from the <tt class="docutils literal">C.f</tt> object to its defining class:</p>
<pre class="literal-block">
&gt;&gt;&gt; C.f.im_class
&lt;class '__main__.C'&gt;
</pre>
<p>This possibility is gone in Python 3:</p>
<pre class="literal-block">
&gt;&gt;&gt; C.f.im_class
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
AttributeError: 'function' object has no attribute 'im_class'
&gt;&gt;&gt; dir(C.f)
['__annotations__', '__call__', '__class__', '__closure__', '__code__',
'__defaults__', '__delattr__', '__dict__', '__dir__', '__doc__',
'__eq__', '__format__', '__ge__', '__get__', '__getattribute__',
'__globals__', '__gt__', '__hash__', '__init__', '__kwdefaults__',
'__le__', '__lt__', '__module__', '__name__', '__ne__', '__new__',
'__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__',
'__str__', '__subclasshook__']
</pre>
<p>This limits again the introspection capabilities available to the
user.  It can produce actual issues when porting software to Python 3,
for example Twisted Core where the issue of introspecting method
objects came up several times.  It also limits pickling support <a class="footnote-reference" href="#id3" id="id1">[1]</a>.</p>
</div>
<div class="section" id="proposal">
<h1><a class="toc-backref" href="#id6">Proposal</a></h1>
<p>This PEP proposes the addition of a <tt class="docutils literal">__qualname__</tt> attribute to
functions and classes.  For top-level functions and classes, the
<tt class="docutils literal">__qualname__</tt> attribute is equal to the <tt class="docutils literal">__name__</tt> attribute.  For
nested classes, methods, and nested functions, the <tt class="docutils literal">__qualname__</tt>
attribute contains a dotted path leading to the object from the module
top-level.  A function's local namespace is represented in that dotted
path by a component named <tt class="docutils literal">&lt;locals&gt;</tt>.</p>
<p>The repr() and str() of functions and classes is modified to use
<tt class="docutils literal">__qualname__</tt> rather than <tt class="docutils literal">__name__</tt>.</p>
<div class="section" id="example-with-nested-classes">
<h2><a class="toc-backref" href="#id7">Example with nested classes</a></h2>
<pre class="doctest-block">
&gt;&gt;&gt; class C:
...   def f(): pass
...   class D:
...     def g(): pass
...
&gt;&gt;&gt; C.__qualname__
'C'
&gt;&gt;&gt; C.f.__qualname__
'C.f'
&gt;&gt;&gt; C.D.__qualname__
'C.D'
&gt;&gt;&gt; C.D.g.__qualname__
'C.D.g'
</pre>
</div>
<div class="section" id="example-with-nested-functions">
<h2><a class="toc-backref" href="#id8">Example with nested functions</a></h2>
<pre class="doctest-block">
&gt;&gt;&gt; def f():
...   def g(): pass
...   return g
...
&gt;&gt;&gt; f.__qualname__
'f'
&gt;&gt;&gt; f().__qualname__
'f.&lt;locals&gt;.g'
</pre>
</div>
</div>
<div class="section" id="limitations">
<h1><a class="toc-backref" href="#id9">Limitations</a></h1>
<p>With nested functions (and classes defined inside functions), the
dotted path will not be walkable programmatically as a function's
namespace is not available from the outside.  It will still be more
helpful to the human reader than the bare <tt class="docutils literal">__name__</tt>.</p>
<p>As the <tt class="docutils literal">__name__</tt> attribute, the <tt class="docutils literal">__qualname__</tt> attribute is computed
statically and it will not automatically follow rebinding.</p>
</div>
<div class="section" id="discussion">
<h1><a class="toc-backref" href="#id10">Discussion</a></h1>
<div class="section" id="excluding-the-module-name">
<h2><a class="toc-backref" href="#id11">Excluding the module name</a></h2>
<p>As <tt class="docutils literal">__name__</tt>, <tt class="docutils literal">__qualname__</tt> doesn't include the module name.  This
makes it independent of module aliasing and rebinding, and also allows to
compute it at compile time.</p>
</div>
<div class="section" id="reviving-unbound-methods">
<h2><a class="toc-backref" href="#id12">Reviving unbound methods</a></h2>
<p>Reviving unbound methods would only solve a fraction of the problems this
PEP solves, at a higher price (an additional object type and an additional
indirection, rather than an additional attribute).</p>
</div>
</div>
<div class="section" id="naming-choice">
<h1><a class="toc-backref" href="#id13">Naming choice</a></h1>
<p>&quot;Qualified name&quot; is the best approximation, as a short phrase, of what the
additional attribute is about.  It is not a &quot;full name&quot; or &quot;fully qualified
name&quot; since it (deliberately) does not include the module name.  Calling
it a &quot;path&quot; would risk confusion with filesystem paths and the <tt class="docutils literal">__file__</tt>
attribute.</p>
<p>The first proposal for the attribute name was to call it <tt class="docutils literal">__qname__</tt> but
many people (who are not aware of previous use of such jargon in e.g. the
XML specification <a class="footnote-reference" href="#id4" id="id2">[2]</a>) found it obscure and non-obvious, which is why the
slightly less short and more explicit <tt class="docutils literal">__qualname__</tt> was finally chosen.</p>
</div>
<div class="section" id="references">
<h1><a class="toc-backref" href="#id14">References</a></h1>
<table class="docutils footnote" frame="void" id="id3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>&quot;pickle should support methods&quot;:
<a class="reference external" href="http://bugs.python.org/issue9276">http://bugs.python.org/issue9276</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>&quot;QName&quot; entry in Wikipedia:
<a class="reference external" href="http://en.wikipedia.org/wiki/QName">http://en.wikipedia.org/wiki/QName</a></td></tr>
</tbody>
</table>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id15">Copyright</a></h1>
<p>This document has been placed in the public domain.</p>
<!-- Local Variables:
mode: indented-text
indent-tabs-mode: nil
sentence-end-double-space: t
fill-column: 70
coding: utf-8
End: -->
</div>

