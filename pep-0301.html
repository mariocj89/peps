<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">PEP:</th><td class="field-body">301</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">Package Index and Metadata for Distutils</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">$Revision$</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference external" href="https://hg.python.org/peps/file/tip/pep-0301.txt">$Date$</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">Richard Jones &lt;richard&#32;&#97;t&#32;python.org&gt;</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Final</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Standards Track</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference external" href="/dev/peps/pep-0012">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">24-Oct-2002</td>
</tr>
<tr class="field"><th class="field-name">Python-Version:</th><td class="field-body">2.3</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body">8-Nov-2002</td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#abstract" id="id17">Abstract</a></li>
<li><a class="reference internal" href="#rationale" id="id18">Rationale</a></li>
<li><a class="reference internal" href="#specification" id="id19">Specification</a><ul>
<li><a class="reference internal" href="#web-interface" id="id20">Web Interface</a></li>
<li><a class="reference internal" href="#user-roles" id="id21">User Roles</a></li>
<li><a class="reference internal" href="#index-storage-schema" id="id22">Index Storage (Schema)</a></li>
<li><a class="reference internal" href="#distutils-register-command" id="id23">Distutils <em>register</em> Command</a></li>
<li><a class="reference internal" href="#distutils-trove-classification" id="id24">Distutils Trove Classification</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementation" id="id25">Implementation</a></li>
<li><a class="reference internal" href="#rejected-proposals" id="id26">Rejected Proposals</a></li>
<li><a class="reference internal" href="#references" id="id27">References</a></li>
<li><a class="reference internal" href="#copyright" id="id28">Copyright</a></li>
<li><a class="reference internal" href="#acknowledgements" id="id29">Acknowledgements</a></li>
</ul>
</div>
<div class="section" id="abstract">
<h1><a class="toc-backref" href="#id17">Abstract</a></h1>
<p>This PEP proposes several extensions to the Distutils packaging system
<a class="footnote-reference" href="#id9" id="id1">[1]</a>.  These enhancements include a central package index server,
tools for submitting package information to the index and extensions
to the package metadata to include Trove <a class="footnote-reference" href="#id10" id="id2">[2]</a> information.</p>
<p>This PEP does not address issues of package dependency.  It also does
not address storage and download of packages as described in <a class="reference external" href="/dev/peps/pep-0243">PEP 243</a>
<a class="footnote-reference" href="#id14" id="id3">[6]</a>.  Nor is it proposing a local database of packages as described
in <a class="reference external" href="/dev/peps/pep-0262">PEP 262</a> <a class="footnote-reference" href="#id15" id="id4">[7]</a>.</p>
<p>Existing package repositories such as the Vaults of Parnassus <a class="footnote-reference" href="#id11" id="id5">[3]</a>,
CPAN <a class="footnote-reference" href="#id12" id="id6">[4]</a> and PAUSE <a class="footnote-reference" href="#id13" id="id7">[5]</a> will be investigated as prior art in this
field.</p>
</div>
<div class="section" id="rationale">
<h1><a class="toc-backref" href="#id18">Rationale</a></h1>
<p>Python programmers have long needed a simple method of discovering
existing modules and systems available for their use.  It is arguable
that the existence of these systems for other languages have been a
significant contribution to their popularity.  The existence of the
Catalog-SIG, and the many discussions there indicate that there is a
large population of users who recognise this need.</p>
<p>The introduction of the Distutils packaging system to Python
simplified the process of distributing shareable code, and included
mechanisms for the capture of package metadata, but did little with
the metadata save ship it with the package.</p>
<p>An interface to the index should be hosted in the python.org domain,
giving it an air of legitimacy that existing catalog efforts do not
have.</p>
<p>The interface for submitting information to the catalog should be as
simple as possible - hopefully just a one-line command for most users.</p>
<p>Issues of package dependency are not addressed due to the complexity
of such a system.  <a class="reference external" href="/dev/peps/pep-0262">PEP 262</a> proposes such a system, but as of this
writing the PEP is still unfinished.</p>
<p>Issues of package dissemination (storage on a central server) are
not addressed because they require assumptions about availability of
storage and bandwidth that I am not in a position to make.  <a class="reference external" href="/dev/peps/pep-0243">PEP 243</a>,
which is still being developed, is tackling these issues and many
more.  This proposal is considered compatible with, and adjunct to
the proposal in <a class="reference external" href="/dev/peps/pep-0243">PEP 243</a>.</p>
</div>
<div class="section" id="specification">
<h1><a class="toc-backref" href="#id19">Specification</a></h1>
<p>The specification takes three parts, the <a class="reference internal" href="#web-interface">web interface</a>,  the
<a class="reference internal" href="#distutils-register-command">Distutils register command</a> and the <a class="reference internal" href="#distutils-trove-classification">Distutils Trove
classification</a>.</p>
<div class="section" id="web-interface">
<h2><a class="toc-backref" href="#id20">Web Interface</a></h2>
<p>A web interface is implemented over a simple store.  The interface is
available through the python.org domain, either directly or as
packages.python.org.</p>
<p>The store has columns for all metadata fields.  The (name, version)
double is used as a uniqueness key.  Additional submissions for an
existing (name, version) will result in an <em>update</em> operation.</p>
<p>The web interface implements the following commands/interfaces:</p>
<dl class="docutils">
<dt><strong>index</strong></dt>
<dd>Lists known packages, optionally filtered.  An additional HTML page,
<strong>search</strong>, presents a form to the user which is used to customise
the index view.  The index will include a browsing interface like
that presented in the Trove interface design section 4.3.  The
results will be paginated, sorted alphabetically and only showing
the most recent version.  The most recent version information will
be determined using the Distutils LooseVersion class.</dd>
<dt><strong>display</strong></dt>
<dd>Displays information about the package.  All fields are displayed as
plain text.  The &quot;url&quot; (or &quot;home_page&quot;) field is hyperlinked.</dd>
<dt><strong>submit</strong></dt>
<dd><p class="first">Accepts a POST submission of metadata about a package.  The
&quot;name&quot; and &quot;version&quot; fields are mandatory, as they uniquely identify
an entry in the index.  <strong>Submit</strong> will automatically determine
whether to create a new entry or update an existing entry.  The
metadata is checked for correctness where appropriate - specifically
the Trove discriminators are compared with the allowed set.  An
update will update all information about the package based on the
new submitted information.</p>
<p class="last">There will also be a submit/edit form that will allow manual
submission and updating for those who do not use Distutils.</p>
</dd>
<dt><strong>submit_pkg_info</strong></dt>
<dd>Accepts a POST submission of a PKG-INFO file and performs the same
function as the <strong>submit</strong> interface.</dd>
<dt><strong>user</strong></dt>
<dd><p class="first">Registers a new user with the index.  Requires username, password
and email address.  Passwords will be stored in the index database
as SHA hashes.  If the username already exists in the database:</p>
<ol class="arabic simple">
<li>If valid HTTP Basic authentication is provided, the password and
email address are updated with the submission information, or</li>
<li>If no valid authentication is provided, the user is informed that
the login is already taken.</li>
</ol>
<p>Registration will be a three-step process, involving:</p>
<ol class="last arabic simple">
<li>User submission of details via the Distutils <em>register</em> command
or through the web,</li>
<li>Index server sending email to the user's email address with a URL
to visit to confirm registration with a random one-time key, and</li>
<li>User visits URL with the key and confirms registration.</li>
</ol>
</dd>
<dt><strong>roles</strong></dt>
<dd>An interface for changing user Role assignments.</dd>
<dt><strong>password_reset</strong></dt>
<dd>Using a supplied email address as the key, this resets a user's
password and sends an email with the new password to the user.</dd>
</dl>
<p>The <strong>submit</strong> command will require HTTP Basic authentication,
preferably over an HTTPS connection.</p>
<p>The server interface will indicate success or failure of the commands
through a subset of the standard HTTP response codes:</p>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="21%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Code</th>
<th class="head">Meaning</th>
<th class="head">Register command implications</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>200</td>
<td>OK</td>
<td>Everything worked just fine</td>
</tr>
<tr><td>400</td>
<td>Bad request</td>
<td>Data provided for submission was malformed</td>
</tr>
<tr><td>401</td>
<td>Unauthorised</td>
<td>The username or password supplied were incorrect</td>
</tr>
<tr><td>403</td>
<td>Forbidden</td>
<td>User does not have permission to update the
package information (not Owner or Maintainer)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="user-roles">
<h2><a class="toc-backref" href="#id21">User Roles</a></h2>
<p>Three user Roles will be assignable to users:</p>
<dl class="docutils">
<dt>Owner</dt>
<dd>Owns a package name, may assign Maintainer Role for that name.  The
first user to register information about a package is deemed Owner
of the package name.  The Admin user may change this if necessary.
May submit updates for the package name.</dd>
<dt>Maintainer</dt>
<dd>Can submit and update info for a particular package name.</dd>
<dt>Admin</dt>
<dd>Can assign Owner Role and edit user details. Not specific to a
package name.</dd>
</dl>
</div>
<div class="section" id="index-storage-schema">
<h2><a class="toc-backref" href="#id22">Index Storage (Schema)</a></h2>
<p>The index is stored in a set of relational database tables:</p>
<dl class="docutils">
<dt><strong>packages</strong></dt>
<dd>Lists package names and holds package-level metadata (currently
just the stable release version)</dd>
<dt><strong>releases</strong></dt>
<dd>Each package has an entry in <strong>releases</strong> for each version of the
package that is released. A row holds the bulk of the information
given in the package's PKG-INFO file. There is one row for each
package (<em>name</em>, <em>version</em>).</dd>
<dt><strong>trove_discriminators</strong></dt>
<dd>Lists the Trove discriminator text and assigns each one a unique
ID.</dd>
<dt><strong>release_discriminators</strong></dt>
<dd>Each entry maps a package (<em>name</em>, <em>version</em>) to a
<em>discriminator_id</em>.  We map to releases instead of packages because
the set of discriminators may change between releases.</dd>
<dt><strong>journals</strong></dt>
<dd>Holds information about changes to package information in the
index. Changes to the <strong>packages</strong>, <strong>releases</strong>, <strong>roles</strong>,
and <strong>release_discriminators</strong> tables are listed here by
package <em>name</em> and <em>version</em> if the change is release-specific.</dd>
<dt><strong>users</strong></dt>
<dd>Holds our user database - user name, email address and password.</dd>
<dt><strong>roles</strong></dt>
<dd>Maps <em>user_name</em> and <em>role_name</em> to a <em>package_name</em>.</dd>
</dl>
<p>An additional table, <strong>rego_otk</strong> holds the One Time Keys generated
during registration and is not interesting in the scope of the index
itself.</p>
</div>
<div class="section" id="distutils-register-command">
<h2><a class="toc-backref" href="#id23">Distutils <em>register</em> Command</a></h2>
<p>An additional Distutils command, <tt class="docutils literal">register</tt>, is implemented which
posts the package metadata to the central index.  The <em>register</em>
command automatically handles user registration; the user is presented
with three options:</p>
<ol class="arabic simple">
<li>login and submit package information</li>
<li>register as a new packager</li>
<li>send password reminder email</li>
</ol>
<p>On systems where the <tt class="docutils literal">$HOME</tt> environment variable is set, the user
will be prompted at exit to save their username/password to a file
in their <tt class="docutils literal">$HOME</tt> directory in the file <tt class="docutils literal">.pypirc</tt>.</p>
<p>Notification of changes to a package entry will be sent to all users
who have submitted information about the package.  That is, the
original submitter and any subsequent updaters.</p>
<p>The <em>register</em> command will include a <tt class="docutils literal"><span class="pre">--verify</span></tt> option which
performs a test submission to the index without actually committing
the data.  The index will perform its submission verification checks
as usual and report any errors it would have reported during a normal
submission.  This is useful for verifying correctness of Trove
discriminators.</p>
</div>
<div class="section" id="distutils-trove-classification">
<h2><a class="toc-backref" href="#id24">Distutils Trove Classification</a></h2>
<p>The Trove concept of <em>discrimination</em> will be added to the metadata
set available to package authors through the new attribute
&quot;classifiers&quot;.  The list of classifiers will be available through the
web, and added to the package like so:</p>
<pre class="literal-block">
setup(
    name = &quot;roundup&quot;,
    version = __version__,
    classifiers = [
        'Development Status :: 4 - Beta',
        'Environment :: Console',
        'Environment :: Web Environment',
        'Intended Audience :: End Users/Desktop',
        'Intended Audience :: Developers',
        'Intended Audience :: System Administrators',
        'License :: OSI Approved :: Python Software Foundation License',
        'Operating System :: MacOS :: MacOS X',
        'Operating System :: Microsoft :: Windows',
        'Operating System :: POSIX',
        'Programming Language :: Python',
        'Topic :: Communications :: Email',
        'Topic :: Office/Business',
        'Topic :: Software Development :: Bug Tracking',
    ],
    url = 'http://sourceforge.net/projects/roundup/',
    ...
)
</pre>
<p>It was decided that strings would be used for the classification
entries due to the deep nesting that would be involved in a more
formal Python structure.</p>
<p>The original Trove specification that classification namespaces be
separated by slashes (&quot;/&quot;) unfortunately collides with many of the
names having slashes in them (e.g. &quot;OS/2&quot;).  The double-colon solution
(&quot; :: &quot;) implemented by SourceForge and FreshMeat gets around this
limitation.</p>
<p>The list of classification values on the module index has been merged
from FreshMeat and SourceForge (with their permission).  This list
will be made available both through the web interface and through the
<em>register</em> command's <tt class="docutils literal"><span class="pre">--list-classifiers</span></tt> option as a text list
which may then be copied to the <tt class="docutils literal">setup.py</tt> file.  The <em>register</em>
command's <tt class="docutils literal"><span class="pre">--verify</span></tt> option will check classifiers values against
the server's list.</p>
<p>Unfortunately, the addition of the &quot;classifiers&quot; property is not
backwards-compatible.  A setup.py file using it will not work under
Python 2.1.3.  It is hoped that a bug-fix release of Python 2.2 (most
likely 2.2.3) will relax the argument checking of the setup() command
to allow new keywords, even if they're not actually used.  It is
preferable that a warning be produced, rather than a show-stopping
error. The use of the new keyword should be discouraged in situations
where the package is advertised as being compatible with python
versions earlier than 2.2.3 or 2.3.</p>
<p>In the PKG-INFO, the classifiers list items will appear as individual
<tt class="docutils literal">Classifier:</tt> entries:</p>
<pre class="literal-block">
Name: roundup
Version: 0.5.2
Classifier: Development Status :: 4 - Beta
Classifier: Environment :: Console (Text Based)
            .
            .
Classifier: Topic :: Software Development :: Bug Tracking
Url: http://sourceforge.net/projects/roundup/
</pre>
</div>
</div>
<div class="section" id="implementation">
<h1><a class="toc-backref" href="#id25">Implementation</a></h1>
<p>The server is available at:</p>
<blockquote>
<a class="reference external" href="http://www.python.org/pypi">http://www.python.org/pypi</a></blockquote>
<p>The code is available from the SourceForge project:</p>
<blockquote>
<a class="reference external" href="http://sourceforge.net/projects/pypi/">http://sourceforge.net/projects/pypi/</a></blockquote>
<p>The <em>register</em> command has been integrated into Python 2.3.</p>
</div>
<div class="section" id="rejected-proposals">
<h1><a class="toc-backref" href="#id26">Rejected Proposals</a></h1>
<p>Originally, the index server was to return custom headers (inspired by
<a class="reference external" href="/dev/peps/pep-0243">PEP 243</a>):</p>
<dl class="docutils">
<dt><strong>X-Pypi-Status</strong></dt>
<dd>Either &quot;success&quot; or &quot;fail&quot;.</dd>
<dt><strong>X-Pypi-Reason</strong></dt>
<dd>A description of the reason for failure, or additional information
in the case of a success.</dd>
</dl>
<p>However, it has been pointed out <a class="footnote-reference" href="#id16" id="id8">[8]</a> that this is a bad scheme to
use.</p>
</div>
<div class="section" id="references">
<h1><a class="toc-backref" href="#id27">References</a></h1>
<table class="docutils footnote" frame="void" id="id9" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Distutils packaging system
(<a class="reference external" href="http://docs.python.org/library/distutils.html">http://docs.python.org/library/distutils.html</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id10" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>Trove
(<a class="reference external" href="http://www.catb.org/~esr/trove/">http://www.catb.org/~esr/trove/</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id11" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[3]</a></td><td>Vaults of Parnassus
(<a class="reference external" href="http://www.vex.net/parnassus/">http://www.vex.net/parnassus/</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id12" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[4]</a></td><td>CPAN
(<a class="reference external" href="http://www.cpan.org/">http://www.cpan.org/</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id13" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[5]</a></td><td>PAUSE
(<a class="reference external" href="http://pause.cpan.org/">http://pause.cpan.org/</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id14" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[6]</a></td><td><a class="reference external" href="/dev/peps/pep-0243">PEP 243</a>, Module Repository Upload Mechanism
(<a class="reference external" href="http://www.python.org/dev/peps/pep-0243/">http://www.python.org/dev/peps/pep-0243/</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id15" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[7]</a></td><td><a class="reference external" href="/dev/peps/pep-0262">PEP 262</a>, A Database of Installed Python Packages
(<a class="reference external" href="http://www.python.org/dev/peps/pep-0262/">http://www.python.org/dev/peps/pep-0262/</a>)</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id16" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id8">[8]</a></td><td>[PEP243] upload status is bogus
(<a class="reference external" href="https://mail.python.org/pipermail/distutils-sig/2001-March/002262.html">https://mail.python.org/pipermail/distutils-sig/2001-March/002262.html</a>)</td></tr>
</tbody>
</table>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id28">Copyright</a></h1>
<p>This document has been placed in the public domain.</p>
</div>
<div class="section" id="acknowledgements">
<h1><a class="toc-backref" href="#id29">Acknowledgements</a></h1>
<p>Anthony Baxter, Martin v. Loewis and David Goodger for encouragement
and feedback during initial drafting.</p>
<p>A.M. Kuchling for support including hosting the second prototype.</p>
<p>Greg Stein for recommending that the register command interpret the
HTTP response codes rather than custom X-PyPI-* headers.</p>
<p>The many participants of the Distutils and Catalog SIGs for their
ideas over the years.</p>
<!-- Local Variables:
mode: indented-text
indent-tabs-mode: nil
sentence-end-double-space: t
fill-column: 70
End: -->
</div>

