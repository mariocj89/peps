<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">PEP:</th><td class="field-body">277</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">Unicode file name support for Windows NT</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">$Revision$</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference external" href="https://hg.python.org/peps/file/tip/pep-0277.txt">$Date$</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">neilh&#32;&#97;t&#32;scintilla.org (Neil Hodgson)</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Final</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Standards Track</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference external" href="/dev/peps/pep-0012">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">11-Jan-2002</td>
</tr>
<tr class="field"><th class="field-name">Python-Version:</th><td class="field-body">2.3</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#abstract" id="id4">Abstract</a></li>
<li><a class="reference internal" href="#rationale" id="id5">Rationale</a></li>
<li><a class="reference internal" href="#specification" id="id6">Specification</a></li>
<li><a class="reference internal" href="#restrictions" id="id7">Restrictions</a></li>
<li><a class="reference internal" href="#reference-implementation" id="id8">Reference Implementation</a></li>
<li><a class="reference internal" href="#references" id="id9">References</a></li>
<li><a class="reference internal" href="#copyright" id="id10">Copyright</a></li>
</ul>
</div>
<div class="section" id="abstract">
<h1><a class="toc-backref" href="#id4">Abstract</a></h1>
<p>This PEP discusses supporting access to all files possible on
Windows NT by passing Unicode file names directly to the system's
wide-character functions.</p>
</div>
<div class="section" id="rationale">
<h1><a class="toc-backref" href="#id5">Rationale</a></h1>
<p>Python 2.2 on Win32 platforms converts Unicode file names passed
to open and to functions in the <tt class="docutils literal">os</tt> module into the 'mbcs' encoding
before passing the result to the operating system.  This is often
successful in the common case where the script is operating with
the locale set to the same value as when the file was created.
Most machines are set up as one locale and rarely if ever changed
from this locale.  For some users, locale is changed more often
and on servers there are often files saved by users using
different locales.</p>
<p>On Windows NT and descendent operating systems, including Windows
2000 and Windows XP, wide-character APIs are available that
provide direct access to all file names, including those that are
not representable using the current locale.  The purpose of this
proposal is to provide access to these wide-character APIs through
the standard Python file object and posix module and so provide
access to all files on Windows NT.</p>
</div>
<div class="section" id="specification">
<h1><a class="toc-backref" href="#id6">Specification</a></h1>
<p>On Windows platforms which provide wide-character file APIs, when
Unicode arguments are provided to file APIs, wide-character calls
are made instead of the standard C library and posix calls.</p>
<p>The Python file object is extended to use a Unicode file name
argument directly rather than converting it.  This affects the
file object constructor <tt class="docutils literal">file(filename[, mode[, <span class="pre">bufsize]])</span></tt> and also
the <tt class="docutils literal">open</tt> function which is an alias of this constructor.  When a
Unicode filename argument is used here then the <tt class="docutils literal">name</tt> attribute of
the file object will be Unicode.  The representation of a file
object, <tt class="docutils literal">repr(f)</tt> will display Unicode file names as an escaped
string in a similar manner to the representation of Unicode
strings.</p>
<p>The <tt class="docutils literal">posix</tt> module contains functions that take file or directory
names: <tt class="docutils literal">chdir</tt>, <tt class="docutils literal">listdir</tt>, <tt class="docutils literal">mkdir</tt>, <tt class="docutils literal">open</tt>, <tt class="docutils literal">remove</tt>, <tt class="docutils literal">rename</tt>,
<tt class="docutils literal">rmdir</tt>, <tt class="docutils literal">stat</tt>, and <tt class="docutils literal">_getfullpathname</tt>.  These will use Unicode
arguments directly rather than converting them.  For the <tt class="docutils literal">rename</tt> function, this
behaviour is triggered when either of the arguments is Unicode and
the other argument converted to Unicode using the default
encoding.</p>
<p>The <tt class="docutils literal">listdir</tt> function currently returns a list of strings.  Under
this proposal, it will return a list of Unicode strings when its
path argument is Unicode.</p>
</div>
<div class="section" id="restrictions">
<h1><a class="toc-backref" href="#id7">Restrictions</a></h1>
<p>On the consumer Windows operating systems, Windows 95, Windows 98,
and Windows ME, there are no wide-character file APIs so behaviour
is unchanged under this proposal.  It may be possible in the
future to extend this proposal to cover these operating systems as
the VFAT-32 file system used by them does support Unicode file
names but access is difficult and so implementing this would
require much work.  The &quot;Microsoft Layer for Unicode&quot; could be a
starting point for implementing this.</p>
<p>Python can be compiled with the size of Unicode characters set to
4 bytes rather than 2 by defining <tt class="docutils literal">PY_UNICODE_TYPE</tt> to be a 4 byte
type and <tt class="docutils literal">Py_UNICODE_SIZE</tt> to be 4.  As the Windows API does not
accept 4 byte characters, the features described in this proposal
will not work in this mode so the implementation falls back to the
current 'mbcs' encoding technique. This restriction could be lifted
in the future by performing extra conversions using
<tt class="docutils literal">PyUnicode_AsWideChar</tt> but for now that would add too much
complexity for a very rarely used feature.</p>
</div>
<div class="section" id="reference-implementation">
<h1><a class="toc-backref" href="#id8">Reference Implementation</a></h1>
<p>The implementation is available at <a class="footnote-reference" href="#id3" id="id1">[2]</a>.</p>
</div>
<div class="section" id="references">
<h1><a class="toc-backref" href="#id9">References</a></h1>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[1]</td><td>Microsoft Windows APIs
<a class="reference external" href="http://msdn.microsoft.com/">http://msdn.microsoft.com/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[2]</a></td><td><a class="reference external" href="http://python.org/sf/594001">http://python.org/sf/594001</a></td></tr>
</tbody>
</table>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id10">Copyright</a></h1>
<p>This document has been placed in the public domain.</p>
<!-- Local Variables:
mode: indented-text
indent-tabs-mode: nil
fill-column: 70
End: -->
</div>

