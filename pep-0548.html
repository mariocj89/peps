<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">PEP:</th><td class="field-body">548</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">More Flexible Loop Control</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">$Revision$</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference external" href="https://hg.python.org/peps/file/tip/pep-0548.txt">$Date$</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">R David Murray</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Rejected</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Standards Track</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference external" href="/dev/peps/pep-0012">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">05-Sep-2017</td>
</tr>
<tr class="field"><th class="field-name">Python-Version:</th><td class="field-body">3.7</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body">05-Aug-2017</td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#rejection-note" id="id2">Rejection Note</a></li>
<li><a class="reference internal" href="#abstract" id="id3">Abstract</a></li>
<li><a class="reference internal" href="#motivation" id="id4">Motivation</a></li>
<li><a class="reference internal" href="#syntax" id="id5">Syntax</a></li>
<li><a class="reference internal" href="#semantics" id="id6">Semantics</a></li>
<li><a class="reference internal" href="#justification-and-examples" id="id7">Justification and Examples</a></li>
<li><a class="reference internal" href="#copyright" id="id8">Copyright</a></li>
</ul>
</div>
<div class="section" id="rejection-note">
<h1><a class="toc-backref" href="#id2">Rejection Note</a></h1>
<p>Rejection by Guido:
<a class="reference external" href="https://mail.python.org/pipermail/python-dev/2017-September/149232.html">https://mail.python.org/pipermail/python-dev/2017-September/149232.html</a></p>
</div>
<div class="section" id="abstract">
<h1><a class="toc-backref" href="#id3">Abstract</a></h1>
<p>This PEP proposes enhancing the <tt class="docutils literal">break</tt> and <tt class="docutils literal">continue</tt> statements
with an optional boolean expression that controls whether or not
they execute.  This allows the flow of control in loops to be
expressed more clearly and compactly.</p>
</div>
<div class="section" id="motivation">
<h1><a class="toc-backref" href="#id4">Motivation</a></h1>
<p>Quoting from the rejected <a class="reference external" href="/dev/peps/pep-0315">PEP 315</a>:</p>
<blockquote>
<p>It is often necessary for some code to be executed before each
evaluation of the while loop condition.  This code is often
duplicated outside the loop, as setup code that executes once
before entering the loop:</p>
<pre class="literal-block">
&lt;setup code&gt;
while &lt;condition&gt;:
    &lt;loop body&gt;
    &lt;setup code&gt;
</pre>
</blockquote>
<p>That PEP was rejected because no syntax was found that was superior
to the following form:</p>
<pre class="literal-block">
while True:
    &lt;setup code&gt;
    if not &lt;condition&gt;:
        break
    &lt;loop body&gt;
</pre>
<p>This PEP proposes a superior form, one that also has application to
for loops. It is superior because it makes the flow of control in
loops more explicit, while preserving Python's indentation aesthetic.</p>
</div>
<div class="section" id="syntax">
<h1><a class="toc-backref" href="#id5">Syntax</a></h1>
<p>The syntax of the break and continue statements are extended
as follows:</p>
<pre class="literal-block">
break_stmt : &quot;break&quot; [&quot;if&quot; expression]
continue_stmt : &quot;continue&quot; [&quot;if&quot; expression]
</pre>
<p>In addition, the syntax of the while statement is modified as follows:</p>
<pre class="literal-block">
while_stmt : while1_stmt|while2_stmt
while1_stmt : &quot;while&quot; expression &quot;:&quot; suite
              [&quot;else&quot; &quot;:&quot; suite]
while2_stmt : &quot;while&quot; &quot;:&quot; suite
</pre>
</div>
<div class="section" id="semantics">
<h1><a class="toc-backref" href="#id6">Semantics</a></h1>
<p>A <tt class="docutils literal">break if</tt> or <tt class="docutils literal">continue if</tt> is executed if and only if
<tt class="docutils literal">expression</tt> evaluates to true.</p>
<p>A <cite>while</cite> statement with no expression loops until a break or return
is executed (or an error is raised), as if it were a <cite>'while True`</cite>
statement.  Given that the loop can never terminate except in a
way that would not cause an <tt class="docutils literal">else</tt> suite to execute, no <tt class="docutils literal">else</tt>
suite is allowed in the expressionless form.  If practical, it
should also be an error if the body of an expressionless <tt class="docutils literal">while</tt>
does not contain at least one <tt class="docutils literal">break</tt> or <tt class="docutils literal">return</tt> statement.</p>
</div>
<div class="section" id="justification-and-examples">
<h1><a class="toc-backref" href="#id7">Justification and Examples</a></h1>
<p>The previous &quot;best possible&quot; form:</p>
<pre class="literal-block">
while True:
    &lt;setup code&gt;
    if not &lt;condition&gt;:
        break
    &lt;loop body&gt;
</pre>
<p>could be formatted as:</p>
<pre class="literal-block">
while True:
    &lt;setup code&gt;
    if not &lt;condition&gt;: break
    &lt;loop body&gt;
</pre>
<p>This is superficially almost identical to the form proposed by this
PEP:</p>
<pre class="literal-block">
while:
    &lt;setup code&gt;
    break if not &lt;condition&gt;
    &lt;loop body&gt;
</pre>
<p>The significant difference here is that the loop flow control
keyword appears <em>first</em> in the line of code.  This makes it easier
to comprehend the flow of control in the loop at a glance, especially
when reading colorized code.</p>
<p>For example, this is a common code pattern, taken in this case
from the tarfile module:</p>
<pre class="literal-block">
while True:
    buf = self._read(self.bufsize)
    if not buf:
        break
    t.append(buf)
</pre>
<p>Reading this, we either see the break and possibly need to think about
where the while is that it applies to, since the break is indented
under the if, and then track backward to read the condition that
triggers it; or, we read the condition and only afterward discover
that this condition changes the flow of the loop.</p>
<p>With the new syntax this becomes:</p>
<pre class="literal-block">
while:
    buf = self._read(self.bufsize)
    break if not buf
    t.append(buf)
</pre>
<p>Reading this we first see the``break``, which obviously applies to
the while since it is at the same level of indentation as the loop
body, and then we read the condition that causes the flow of control
to change.</p>
<p>Further, consider a more complex example from sre_parse:</p>
<pre class="literal-block">
while True:
    c = self.next
    self.__next()
    if c is None:
        if not result:
            raise self.error(&quot;missing group name&quot;)
        raise self.error(&quot;missing %s, unterminated name&quot; % terminator,
                         len(result))
    if c == terminator:
        if not result:
            raise self.error(&quot;missing group name&quot;, 1)
        break
    result += c
return result
</pre>
<p>This is the natural way to write this code given current Python
loop control syntax.  However, given <tt class="docutils literal">break if</tt>, it would be more
natural to write this as follows:</p>
<pre class="literal-block">
while:
    c = self.next
    self.__next()
    break if c is None or c == terminator
    result += c
if not result:
    raise self.error(&quot;missing group name&quot;)
elif c is None:
    raise self.error(&quot;missing %s, unterminated name&quot; % terminator,
                     len(result))
return result
</pre>
<p>This form moves the error handling out of the loop body, leaving the
loop logic much more understandable.  While it would certainly be
possible to write the code this way using the current syntax, the
proposed syntax makes it more natural to write it in the clearer form.</p>
<p>The proposed syntax also provides a natural, Pythonic spelling of
the classic  <tt class="docutils literal">repeat ... until &lt;expression&gt;</tt> construct found in
other languages, and for which no good syntax has previously been
found for Python:</p>
<pre class="literal-block">
while:
    ...
    break if &lt;expression&gt;
</pre>
<p>The tarfile module, for example, has a couple of &quot;read until&quot; loops like
the following:</p>
<pre class="literal-block">
while True:
    s = self.__read(1)
    if not s or s == NUL:
        break
</pre>
<p>With the new syntax this would read more clearly:</p>
<pre class="literal-block">
while:
    s = self.__read(1)
    break if not s or s == NUL
</pre>
<p>The case for extending this syntax to <tt class="docutils literal">continue</tt> is less strong,
but buttressed by the value of consistency.</p>
<p>It is much more common for a <tt class="docutils literal">continue</tt> statement to be at the
end of a multiline if suite, such as this example from zipfile</p>
<pre class="literal-block">
while True:
    try:
        self.fp = io.open(file, filemode)
    except OSError:
        if filemode in modeDict:
            filemode = modeDict[filemode]
            continue
        raise
    break
</pre>
<p>The only opportunity for improvement the new syntax would offer for
this loop would be the omission of the <tt class="docutils literal">True</tt> token.</p>
<p>On the other hand, consider this example from uuid.py:</p>
<pre class="literal-block">
for i in range(adapters.length):
    ncb.Reset()
    ncb.Command = netbios.NCBRESET
    ncb.Lana_num = ord(adapters.lana[i])
    if win32wnet.Netbios(ncb) != 0:
        continue
    ncb.Reset()
    ncb.Command = netbios.NCBASTAT
    ncb.Lana_num = ord(adapters.lana[i])
    ncb.Callname = '*'.ljust(16)
    ncb.Buffer = status = netbios.ADAPTER_STATUS()
    if win32wnet.Netbios(ncb) != 0:
        continue
    status._unpack()
    bytes = status.adapter_address[:6]
    if len(bytes) != 6:
        continue
    return int.from_bytes(bytes, 'big')
</pre>
<p>This becomes:</p>
<pre class="literal-block">
for i in range(adapters.length):
    ncb.Reset()
    ncb.Command = netbios.NCBRESET
    ncb.Lana_num = ord(adapters.lana[i])
    continue if win32wnet.Netbios(ncb) != 0
    ncb.Reset()
    ncb.Command = netbios.NCBASTAT
    ncb.Lana_num = ord(adapters.lana[i])
    ncb.Callname = '*'.ljust(16)
    ncb.Buffer = status = netbios.ADAPTER_STATUS()
    continue if win32wnet.Netbios(ncb) != 0
    status._unpack()
    bytes = status.adapter_address[:6]
    continue if len(bytes) != 6
    return int.from_bytes(bytes, 'big')
</pre>
<p>This example indicates that there are non-trivial use cases where
<tt class="docutils literal">continue if</tt> also improves the readability of the loop code.</p>
<p>It is probably significant to note that all of the examples selected
for this PEP were found by grepping the standard library for <tt class="docutils literal">while
True</tt> and <tt class="docutils literal">continue</tt>, and the relevant examples were found in
the first four modules inspected.</p>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id8">Copyright</a></h1>
<p>This document is placed in the public domain.</p>
</div>

