<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">PEP:</th><td class="field-body">534</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">Distributing a Subset of the Standard Library</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">$Revision$</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference external" href="https://hg.python.org/peps/file/tip/pep-0534.txt">$Date$</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">Tomáš Orsava &lt;tomas.n&#32;&#97;t&#32;orsava.cz&gt;,
Petr Viktorin &lt;encukou&#32;&#97;t&#32;gmail.com&gt;,
Nick Coghlan &lt;ncoghlan&#32;&#97;t&#32;gmail.com&gt;</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Draft</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Standards Track</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference external" href="/dev/peps/pep-0012">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">5-Sep-2016</td>
</tr>
<tr class="field"><th class="field-name">Python-Version:</th><td class="field-body">3.7</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#abstract" id="id23">Abstract</a></li>
<li><a class="reference internal" href="#motivation" id="id24">Motivation</a><ul>
<li><a class="reference internal" href="#cpython" id="id25">CPython</a></li>
<li><a class="reference internal" href="#linux-and-other-distributions" id="id26">Linux and other distributions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#specification" id="id27">Specification</a></li>
<li><a class="reference internal" href="#rationale" id="id28">Rationale</a></li>
<li><a class="reference internal" href="#recommendation-for-downstream-distributors" id="id29">Recommendation for Downstream Distributors</a></li>
<li><a class="reference internal" href="#backwards-compatibility" id="id30">Backwards Compatibility</a></li>
<li><a class="reference internal" href="#reference-and-example-implementation" id="id31">Reference and Example Implementation</a></li>
<li><a class="reference internal" href="#notes-and-references" id="id32">Notes and References</a></li>
<li><a class="reference internal" href="#copyright" id="id33">Copyright</a></li>
</ul>
</div>
<div class="section" id="abstract">
<h1><a class="toc-backref" href="#id23">Abstract</a></h1>
<p>Python is often being built or distributed without its full standard library.
However, there is as of yet no standard, user friendly way of properly informing the user about the failure to import such missing <cite>stdlib</cite> modules.  This PEP proposes a mechanism for identifying standard library modules and informing the user appropriately.</p>
</div>
<div class="section" id="motivation">
<h1><a class="toc-backref" href="#id24">Motivation</a></h1>
<p>There are several use cases for including only a subset of Python's standard
library.  However, there is so far no user-friendly mechanism for informing the user <em>why</em> a stdlib module is missing and how to remedy the situation appropriately.</p>
<div class="section" id="cpython">
<h2><a class="toc-backref" href="#id25">CPython</a></h2>
<p>When one of Python standard library modules (such as <tt class="docutils literal">_sqlite3</tt>) cannot be
compiled during a Python build because of missing dependencies (e.g. SQLite
header files), the module is simply skipped.  If you then install this compiled Python and use it to try to import one of the
missing modules, Python will fail with a <a class="reference external" href="https://docs.python.org/3.7/library/exceptions.html#ModuleNotFoundError">ModuleNotFoundError</a> <a class="footnote-reference" href="#id5" id="id6">[3]</a>.</p>
<p>This can confuse users who may not understand why a cleanly built Python is
missing standard library modules.</p>
</div>
<div class="section" id="linux-and-other-distributions">
<h2><a class="toc-backref" href="#id26">Linux and other distributions</a></h2>
<p>Many Linux and other distributions are already separating out parts of the
standard library to standalone packages.  Among the most commonly excluded
modules are the <tt class="docutils literal">tkinter</tt> module, since it draws in a dependency on the
graphical environment, and the <tt class="docutils literal">test</tt> package, as it only serves to test
Python internally and is about as big as the rest of the standard library put
together.</p>
<p>The methods of omission of these modules differ.  For example, Debian patches
the file <tt class="docutils literal">Lib/tkinter/__init__.py</tt> to envelop the line <tt class="docutils literal">import _tkinter</tt> in
a <em>try-except</em> block and upon encountering an <tt class="docutils literal">ImportError</tt> it simply adds
the following to the error message: <tt class="docutils literal">please install the <span class="pre">python3-tk</span> package</tt>
<a class="footnote-reference" href="#debian-patch" id="id1">[1]</a>.  Fedora and other distributions simply don't include the
omitted modules, potentially leaving users baffled as to where to find them.</p>
</div>
</div>
<div class="section" id="specification">
<h1><a class="toc-backref" href="#id27">Specification</a></h1>
<p>The <a class="reference external" href="https://docs.python.org/3.7/library/sysconfig.html">sysconfig</a> <a class="footnote-reference" href="#id8" id="id9">[4]</a> module will be extended by two functions: <cite>sysconfig.get_stdlib_modules()</cite>, which will provide a list of the names of all Python standard library modules, and a function <cite>sysconfig.get_optional_modules()</cite>, that will list optional <cite>stdlib</cite> module names.  The results of the latter function—<cite>sysconfig.get_optional_modules()</cite>—as well as of the existing <cite>sys.builtin_module_names</cite> will both be subsets of the full list provided by <cite>sysconfig.get_stdlib_modules()</cite>.  These added lists will be generated during the Python build process and saved in <cite>_sysconfigdata-*.py</cite> file along with other <a class="reference external" href="https://docs.python.org/3.7/library/sysconfig.html">sysconfig</a> <a class="footnote-reference" href="#id8" id="id10">[4]</a> values.</p>
<p>The default implementation of the <a class="reference external" href="https://docs.python.org/3.7/library/sys.html#sys.excepthook">sys.excepthook</a> <a class="footnote-reference" href="#id12" id="id13">[5]</a> function will then be modified to dispense an appropriate message when it detects a failure to import a module identified by one of the two new <a class="reference external" href="https://docs.python.org/3.7/library/sysconfig.html">sysconfig</a> <a class="footnote-reference" href="#id8" id="id11">[4]</a> functions as belonging to the Python standard library.</p>
</div>
<div class="section" id="rationale">
<h1><a class="toc-backref" href="#id28">Rationale</a></h1>
<p>The <a class="reference external" href="https://docs.python.org/3.7/library/sys.html#sys.excepthook">sys.excepthook</a> <a class="footnote-reference" href="#id12" id="id14">[5]</a> function gets called when a raised exception is uncaught and the program is about to exit or—in an interactive session—the control is being returned to the prompt.  This makes it a perfect place for customized error messages, as it will not influence caught errors and thus not slow down normal execution of Python scripts.</p>
<p>The inclusion of the functions <cite>sysconfig.get_stdlib_modules()</cite> and <cite>sysconfig.get_optional_modules()</cite> will also provide a long sought-after way of easily listing the names of Python standard library modules <a class="footnote-reference" href="#stackoverflow-stdlib" id="id2">[2]</a>, which will—among other benefits—make it easier for code analysis, profiling, and error reporting tools to offer runtime <cite>--ignore-stdlib</cite> flags.</p>
<p>Ideas leading up to this PEP were discussed on the <a class="reference external" href="https://mail.python.org/pipermail/python-dev/2016-July/145534.html">python-dev mailing list</a> <a class="footnote-reference" href="#id16" id="id17">[6]</a> and subsequently on <a class="reference external" href="https://mail.python.org/pipermail/python-ideas/2016-December/043907.html">python-ideas</a> <a class="footnote-reference" href="#id18" id="id19">[7]</a>.</p>
</div>
<div class="section" id="recommendation-for-downstream-distributors">
<h1><a class="toc-backref" href="#id29">Recommendation for Downstream Distributors</a></h1>
<p>By patching <a class="reference external" href="https://docs.python.org/3.7/library/site.html">site.py</a> <a class="footnote-reference" href="#id20" id="id21">[8]</a> <a class="footnote-reference" href="#id4" id="id3">[*]</a> to provide their own implementation of the <a class="reference external" href="https://docs.python.org/3.7/library/sys.html#sys.excepthook">sys.excepthook</a> <a class="footnote-reference" href="#id12" id="id15">[5]</a> function, Python distributors can display tailor-made error messages for any uncaught exceptions, including informing the user of a proper, distro-specific way to install missing standard library modules upon encountering a <a class="reference external" href="https://docs.python.org/3.7/library/exceptions.html#ModuleNotFoundError">ModuleNotFoundError</a> <a class="footnote-reference" href="#id5" id="id7">[3]</a>.  Some downstream distributors are already using this method of patching <cite>sys.excepthook</cite> to integrate with platform crash reporting mechanisms.</p>
<p>An <a class="reference internal" href="#reference-and-example-implementation">example implementation</a> is attached to this PEP.</p>
</div>
<div class="section" id="backwards-compatibility">
<h1><a class="toc-backref" href="#id30">Backwards Compatibility</a></h1>
<p>No problems with backwards compatibility are expected.  Distributions that are
already patching Python modules to provide custom handling of missing
dependencies can continue to do so unhindered.</p>
</div>
<div class="section" id="reference-and-example-implementation">
<h1><a class="toc-backref" href="#id31">Reference and Example Implementation</a></h1>
<p>TBD.  The finer details will depend on what's practical given the capabilities
of the build system.</p>
<!-- Reference implementation can be found on `GitHub`_ and is also accessible in the form of a `patch`_. -->
</div>
<div class="section" id="notes-and-references">
<h1><a class="toc-backref" href="#id32">Notes and References</a></h1>
<table class="docutils footnote" frame="void" id="id4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[*]</a></td><td>Or <a class="reference external" href="https://docs.python.org/3.7/library/site.html">sitecustomize.py</a> <a class="footnote-reference" href="#id20" id="id22">[8]</a> for organizations with their own custom
Python variant.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="debian-patch" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="http://bazaar.launchpad.net/~doko/python/pkg3.5-debian/view/head:/patches/tkinter-import.diff">http://bazaar.launchpad.net/~doko/python/pkg3.5-debian/view/head:/patches/tkinter-import.diff</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="stackoverflow-stdlib" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td><a class="reference external" href="http://stackoverflow.com/questions/6463918/how-can-i-get-a-list-of-all-the-python-standard-library-modules">http://stackoverflow.com/questions/6463918/how-can-i-get-a-list-of-all-the-python-standard-library-modules</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[3]</td><td><em>(<a class="fn-backref" href="#id6">1</a>, <a class="fn-backref" href="#id7">2</a>)</em> <a class="reference external" href="https://docs.python.org/3.7/library/exceptions.html#ModuleNotFoundError">https://docs.python.org/3.7/library/exceptions.html#ModuleNotFoundError</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[4]</td><td><em>(<a class="fn-backref" href="#id9">1</a>, <a class="fn-backref" href="#id10">2</a>, <a class="fn-backref" href="#id11">3</a>)</em> <a class="reference external" href="https://docs.python.org/3.7/library/sysconfig.html">https://docs.python.org/3.7/library/sysconfig.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id12" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[5]</td><td><em>(<a class="fn-backref" href="#id13">1</a>, <a class="fn-backref" href="#id14">2</a>, <a class="fn-backref" href="#id15">3</a>)</em> <a class="reference external" href="https://docs.python.org/3.7/library/sys.html#sys.excepthook">https://docs.python.org/3.7/library/sys.html#sys.excepthook</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id16" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id17">[6]</a></td><td><a class="reference external" href="https://mail.python.org/pipermail/python-dev/2016-July/145534.html">https://mail.python.org/pipermail/python-dev/2016-July/145534.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id18" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id19">[7]</a></td><td><a class="reference external" href="https://mail.python.org/pipermail/python-ideas/2016-December/043907.html">https://mail.python.org/pipermail/python-ideas/2016-December/043907.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id20" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[8]</td><td><em>(<a class="fn-backref" href="#id21">1</a>, <a class="fn-backref" href="#id22">2</a>)</em> <a class="reference external" href="https://docs.python.org/3.7/library/site.html">https://docs.python.org/3.7/library/site.html</a></td></tr>
</tbody>
</table>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id33">Copyright</a></h1>
<p>This document has been placed in the public domain.</p>
<!-- Local Variables:
mode: indented-text
indent-tabs-mode: nil
sentence-end-double-space: t
fill-column: 70
coding: utf-8
End: -->
</div>

